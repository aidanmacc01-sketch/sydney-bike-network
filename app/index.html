<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
  <title>Micro2Move Sydney</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#7C3AED",
            "primary-dark": "#6D28D9",
            "acc-green": "#22C55E",
            "accent-green": "#4ADE80",
            "background-light": "#f7f6f8",
            "background-dark": "#171121",
          },
          fontFamily: {
            display: ["Space Grotesk", "Inter", "sans-serif"],
          },
        },
      },
    };
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-display { font-family: 'Space Grotesk', sans-serif; }
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 1, 'wght' 700, 'GRAD' 0, 'opsz' 48;
    }
    .btn-ios-active:active {
      transform: scale(0.98);
      background-color: #7C3AED !important;
      color: white !important;
    }
    .btn-ios-active:active * {
      color: white !important;
      border-color: rgba(255,255,255,0.3) !important;
    }
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>
<body class="overflow-hidden bg-background-light">

  <!-- ============================================
       SPLASH SCREEN
       ============================================ -->
  <div id="splashScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center" style="background-color: #1a1a4e;">
    <div class="flex flex-col items-center justify-center flex-1 px-8">
      <p class="text-white text-xl mb-12 tracking-wide">Making Sydney E-bike Friendly</p>

      <div class="relative mb-16">
        <svg class="absolute -left-4 -top-2 w-8 h-12" viewBox="0 0 24 36" fill="none">
          <path d="M14 2L4 18h8l-2 16 12-20h-9l5-12h-4z" fill="#9333EA"/>
        </svg>
        <svg class="w-32 h-20" viewBox="0 0 120 80" fill="none">
          <circle cx="25" cy="55" r="18" stroke="#22C55E" stroke-width="4" fill="none"/>
          <circle cx="95" cy="55" r="18" stroke="#22C55E" stroke-width="4" fill="none"/>
          <path d="M25 55 L50 30 L75 55 L95 55" stroke="#22C55E" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M50 30 L50 20 L55 20" stroke="#22C55E" stroke-width="4" fill="none" stroke-linecap="round"/>
          <path d="M50 30 L75 30 L75 55" stroke="#22C55E" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M45 20 L55 20" stroke="#22C55E" stroke-width="4" stroke-linecap="round"/>
          <path d="M85 25 L95 25 L95 35" stroke="#22C55E" stroke-width="4" fill="none" stroke-linecap="round"/>
          <path d="M75 30 L95 25" stroke="#22C55E" stroke-width="4" stroke-linecap="round"/>
        </svg>
        <p class="text-center mt-2">
          <span class="text-primary text-xl font-bold">micro</span><span class="text-acc-green text-xl font-bold">2</span><span class="text-primary text-xl font-bold">move</span>
        </p>
      </div>

      <div class="flex gap-2 text-xl font-semibold">
        <span class="text-acc-green">Affordable</span>
        <span class="text-primary">Reliable</span>
        <span class="text-white">Safe</span>
      </div>
    </div>

    <button onclick="showSignIn()" class="mb-12 text-white/60 text-sm animate-pulse">
      Tap to continue
    </button>
  </div>

  <!-- ============================================
       SIGN IN SCREEN
       ============================================ -->
  <div id="signInScreen" class="fixed inset-0 z-50 bg-white flex flex-col hidden">
    <div class="flex-1 px-6 pt-12 pb-6 overflow-y-auto">
      <div class="flex items-center gap-2 mb-8">
        <svg class="w-16 h-12" viewBox="0 0 60 45" fill="none">
          <path d="M8 2L2 14h6l-1.5 12 9-15H9l4-9H8z" fill="#9333EA"/>
          <circle cx="22" cy="32" r="10" stroke="#22C55E" stroke-width="2.5" fill="none"/>
          <circle cx="52" cy="32" r="10" stroke="#22C55E" stroke-width="2.5" fill="none"/>
          <path d="M22 32 L34 18 L46 32 L52 32" stroke="#22C55E" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M34 18 L34 12 L38 12" stroke="#22C55E" stroke-width="2.5" fill="none" stroke-linecap="round"/>
          <path d="M34 18 L46 18 L46 32" stroke="#22C55E" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="text-primary text-2xl font-bold">micro2move</span>
      </div>

      <h1 class="text-3xl font-light text-gray-900 mb-8">Sign in to continue</h1>

      <form onsubmit="handleSignIn(event)" class="space-y-4">
        <div>
          <div class="flex justify-between items-center mb-1">
            <label class="text-gray-600 text-sm">Email</label>
            <span id="emailError" class="text-red-500 text-sm hidden">Invalid email/ Email does not exist.</span>
          </div>
          <input type="email" id="signInEmail" placeholder="johndoe@email.com"
            class="w-full px-4 py-4 rounded-xl text-gray-600 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/50"
            style="background-color: #EDE9FE;"/>
        </div>

        <div>
          <div class="flex justify-between items-center mb-1">
            <label class="text-gray-600 text-sm">Password</label>
            <span id="passwordError" class="text-red-500 text-sm hidden">Incorrect password. Try again.</span>
          </div>
          <input type="password" id="signInPassword" placeholder="********"
            class="w-full px-4 py-4 rounded-xl text-gray-600 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/50"
            style="background-color: #EDE9FE;"/>
        </div>

        <button type="submit"
          class="w-full py-4 rounded-xl text-white font-semibold text-lg mt-6 transition-colors hover:opacity-90"
          style="background-color: #A855F7;">
          Sign In
        </button>
      </form>

      <p class="text-center mt-6 text-gray-600">
        Don't have an account?
        <button onclick="showSignUp()" class="text-primary font-semibold hover:underline">Sign Up</button>
      </p>

      <button onclick="showWelcomeHub()" class="w-full text-gray-400 font-medium py-3 mt-4 hover:text-gray-600 transition-colors">
        Skip for now
      </button>
    </div>
  </div>

  <!-- ============================================
       SIGN UP SCREEN
       ============================================ -->
  <div id="signUpScreen" class="fixed inset-0 z-50 bg-white flex flex-col hidden">
    <div class="flex-1 px-6 pt-12 pb-6 overflow-y-auto">
      <div class="flex items-center gap-2 mb-6">
        <svg class="w-16 h-12" viewBox="0 0 60 45" fill="none">
          <path d="M8 2L2 14h6l-1.5 12 9-15H9l4-9H8z" fill="#9333EA"/>
          <circle cx="22" cy="32" r="10" stroke="#22C55E" stroke-width="2.5" fill="none"/>
          <circle cx="52" cy="32" r="10" stroke="#22C55E" stroke-width="2.5" fill="none"/>
          <path d="M22 32 L34 18 L46 32 L52 32" stroke="#22C55E" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="text-primary text-2xl font-bold">micro2move</span>
      </div>

      <h1 class="text-2xl font-bold text-gray-900 mb-6">Sign up</h1>

      <form onsubmit="handleSignUp(event)" class="space-y-3">
        <div>
          <label class="text-gray-600 text-sm">Full Name (as displayed on government ID)</label>
          <input type="text" placeholder="John Doe"
            class="w-full px-4 py-3 rounded-xl text-gray-600 placeholder-gray-400 focus:outline-none"
            style="background-color: #EDE9FE;"/>
        </div>

        <div>
          <label class="text-gray-600 text-sm">Date of Birth</label>
          <input type="text" placeholder="DD/MM/YYYY"
            class="w-full px-4 py-3 rounded-xl text-gray-600 placeholder-gray-400 focus:outline-none"
            style="background-color: #EDE9FE;"/>
        </div>

        <div>
          <label class="text-gray-600 text-sm">Email (for receipts and rides)</label>
          <input type="email" placeholder="john@micro2move.com"
            class="w-full px-4 py-3 rounded-xl text-gray-600 placeholder-gray-400 focus:outline-none"
            style="background-color: #EDE9FE;"/>
        </div>

        <div>
          <label class="text-gray-600 text-sm">Create Password</label>
          <input type="password" placeholder="******"
            class="w-full px-4 py-3 rounded-xl text-gray-600 placeholder-gray-400 focus:outline-none"
            style="background-color: #EDE9FE;"/>
        </div>

        <div class="flex items-start gap-2 pt-2">
          <input type="checkbox" class="mt-1 w-5 h-5 rounded border-gray-300"/>
          <label class="text-gray-600 text-sm">I accept the <span class="text-primary font-semibold">Terms & Conditions</span></label>
        </div>

        <div class="grid grid-cols-2 gap-3 pt-2">
          <div class="flex flex-col items-center justify-center p-4 rounded-xl border-2 border-dashed border-gray-300 cursor-pointer hover:border-primary transition-colors" style="background-color: #EDE9FE;">
            <span class="text-gray-500 text-xs text-center mb-2">Upload Government ID</span>
            <span class="text-2xl text-gray-400">+</span>
          </div>
          <div class="flex flex-col items-center justify-center p-4 rounded-xl border-2 border-dashed border-gray-300 cursor-pointer hover:border-primary transition-colors" style="background-color: #EDE9FE;">
            <span class="text-gray-500 text-xs text-center mb-2">Take Selfie Holding same Government ID</span>
            <span class="material-icons-round text-gray-400">photo_camera</span>
          </div>
        </div>

        <button type="submit"
          class="w-full py-4 rounded-xl text-white font-semibold text-lg mt-4 transition-colors hover:opacity-90"
          style="background-color: #A855F7;">
          Continue
        </button>
      </form>

      <p class="text-center mt-4 text-gray-600">
        Already an user?
        <button onclick="showSignIn()" class="text-primary font-semibold hover:underline">Sign in</button>
      </p>
    </div>
  </div>

  <!-- ============================================
       WELCOME HUB SCREEN
       ============================================ -->
  <div id="welcomeHub" class="fixed inset-0 z-40 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col bg-white overflow-x-hidden shadow-2xl">

      <!-- Header -->
      <div class="flex flex-col items-center pt-12 px-10">
        <h1 class="text-[#131118] tracking-tight text-[32px] font-bold leading-[1.1] text-center mb-8 font-display">
          Making Sydney E-bike Friendly
        </h1>

        <!-- Logo -->
        <div class="relative mb-10 flex items-center justify-center">
          <div class="relative flex items-center justify-center">
            <span class="material-symbols-outlined text-primary text-5xl absolute -left-8 -top-4 rotate-12">bolt</span>
            <div class="flex items-center">
              <div class="relative size-24 flex items-center justify-center">
                <span class="material-symbols-outlined text-7xl text-[#131118]">pedal_bike</span>
                <div class="absolute bottom-1 left-2 size-8 rounded-full border-4 border-accent-green bg-transparent"></div>
                <div class="absolute bottom-1 right-2 size-8 rounded-full border-4 border-accent-green bg-transparent"></div>
              </div>
            </div>
          </div>
        </div>

        <p class="text-[#706189] text-center text-xl font-medium leading-normal mb-6">
          What would you like to do today?
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col gap-4 p-6 grow">

        <!-- View Cycling Communities -->
        <button onclick="showScreen('cyclingCommunities')" class="btn-ios-active group flex items-center justify-between w-full p-6 rounded-[2rem] border-2 border-[#E5E2EA] bg-white shadow-sm hover:border-primary active:bg-primary transition-all duration-200 text-left">
          <div class="flex items-center gap-5">
            <div class="text-primary bg-primary/5 p-4 rounded-full flex items-center justify-center group-active:bg-white/20">
              <span class="material-symbols-outlined text-3xl">explore</span>
            </div>
            <div>
              <h3 class="text-[#131118] text-xl font-bold font-display leading-tight group-active:text-white">View Cycling Communities</h3>
              <p class="text-[#706189] text-sm group-active:text-white/80">Explore regional cycling groups</p>
            </div>
          </div>
          <span class="material-symbols-outlined text-[#706189] text-2xl font-bold transition-transform group-hover:translate-x-1 group-active:text-white">chevron_right</span>
        </button>

        <!-- Find an E-bike (Primary CTA) -->
        <button onclick="showScreen('findEbike')" class="btn-ios-active group flex items-center justify-between w-full p-6 rounded-[2rem] bg-primary text-white shadow-xl shadow-primary/30 hover:bg-primary-dark transition-all duration-200 text-left">
          <div class="flex items-center gap-5">
            <div class="bg-white/20 p-4 rounded-full flex items-center justify-center">
              <span class="material-symbols-outlined text-3xl">electric_bike</span>
            </div>
            <div>
              <h3 class="text-xl font-bold font-display leading-tight">Find an E-bike</h3>
              <p class="text-white/80 text-sm">Locate nearby rides in Sydney</p>
            </div>
          </div>
          <span class="material-symbols-outlined text-2xl font-bold transition-transform group-hover:translate-x-1">chevron_right</span>
        </button>

        <!-- Community -->
        <button onclick="handleCommunityClick()" class="btn-ios-active group flex items-center justify-between w-full p-6 rounded-[2rem] border-2 border-[#E5E2EA] bg-white shadow-sm hover:border-primary active:bg-primary transition-all duration-200 text-left">
          <div class="flex items-center gap-5">
            <div class="text-primary bg-primary/5 p-4 rounded-full flex items-center justify-center group-active:bg-white/20">
              <span class="material-symbols-outlined text-3xl">groups</span>
            </div>
            <div>
              <h3 class="text-[#131118] text-xl font-bold font-display leading-tight group-active:text-white">Community</h3>
              <p class="text-[#706189] text-sm group-active:text-white/80">Join local group rides</p>
            </div>
          </div>
          <span class="material-symbols-outlined text-[#706189] text-2xl font-bold transition-transform group-hover:translate-x-1 group-active:text-white">chevron_right</span>
        </button>

        <!-- Community Events -->
        <button onclick="showScreen('communityEventsScreen')" class="btn-ios-active group flex items-center justify-between w-full p-6 rounded-[2rem] border-2 border-primary/20 bg-white shadow-sm hover:border-primary active:bg-primary transition-all duration-200 text-left relative overflow-hidden">
          <div class="flex items-center gap-5 relative">
            <div class="text-primary bg-primary/5 p-4 rounded-full flex items-center justify-center group-active:bg-white/20">
              <span class="material-symbols-outlined text-3xl">groups</span>
            </div>
            <div>
              <h3 class="text-[#131118] text-xl font-bold font-display leading-tight group-active:text-white">Community Events</h3>
              <p class="text-[#706189] text-sm group-active:text-white/80">Rides &amp; workshops · earn up to $25 off</p>
            </div>
          </div>
          <span class="material-symbols-outlined text-primary text-2xl font-bold transition-transform group-hover:translate-x-1 group-active:text-white">chevron_right</span>
        </button>

        <!-- Safety Training & Earn Credits -->
        <button onclick="showScreen('safetyTrainingScreen')" class="btn-ios-active group flex items-center justify-between w-full p-6 rounded-[2rem] border-2 border-accent-green/30 bg-white shadow-sm hover:border-accent-green active:bg-accent-green transition-all duration-200 text-left relative overflow-hidden">
          <!-- subtle green glow -->
          <div class="absolute inset-0 rounded-[2rem] pointer-events-none" style="background: linear-gradient(135deg, rgba(74,222,128,0.06) 0%, transparent 60%);"></div>
          <div class="flex items-center gap-5 relative">
            <div class="text-accent-green bg-accent-green/10 p-4 rounded-full flex items-center justify-center group-active:bg-white/20 relative">
              <span class="material-symbols-outlined text-3xl">workspace_premium</span>
              <!-- credit badge -->
              <span class="absolute -top-1 -right-1 bg-accent-green text-white text-[9px] font-black rounded-full px-1.5 py-0.5 leading-none shadow-sm group-active:bg-white group-active:text-accent-green">$55</span>
            </div>
            <div>
              <h3 class="text-[#131118] text-xl font-bold font-display leading-tight group-active:text-white">Safety Quizzes</h3>
              <p class="text-[#706189] text-sm group-active:text-white/80">Pass 3 modules · earn up to $55 off</p>
            </div>
          </div>
          <span class="material-symbols-outlined text-accent-green text-2xl font-bold transition-transform group-hover:translate-x-1 group-active:text-white">chevron_right</span>
        </button>

      </div>

      <!-- Footer -->
      <div class="pb-10 pt-4 text-center">
        <p class="text-[#706189] text-sm font-medium">Micro2Move - Sydney, Australia</p>
        <!-- Demo shortcut: jump directly to ID verify -->
        <button onclick="showScreen('idVerifyScreen')"
                class="mt-4 inline-flex items-center gap-1.5 text-xs font-bold text-primary/60 hover:text-primary border border-primary/20 rounded-full px-4 py-1.5 transition-colors">
          <span class="material-symbols-outlined text-sm">verified_user</span>
          Preview: ID Verification
        </button>
      </div>

      <!-- Reset Button (for testing) -->
      <div class="absolute top-4 right-4">
        <button onclick="resetOnboarding()" class="text-xs text-gray-400 hover:text-primary">
          Reset
        </button>
      </div>

    </div>

    <!-- ============================================
         TNC MODAL OVERLAY (4 Steps)
         ============================================ -->
    <div id="tncModal" class="absolute inset-0 z-50 bg-white flex flex-col">

      <!-- TNC Step 1: Privacy -->
      <div id="tncStep1" class="flex flex-col h-full">
        <!-- Header -->
        <div class="flex items-center bg-transparent p-4 pb-2 justify-between">
          <button onclick="closeTncModal()" class="text-primary flex size-12 shrink-0 items-center justify-center">
            <span class="material-symbols-outlined text-2xl">close</span>
          </button>
          <h2 class="text-primary text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display">Privacy</h2>
          <div class="size-12"></div>
        </div>

        <!-- Progress Dots -->
        <div class="flex w-full flex-row items-center justify-center gap-3 py-4">
          <div class="h-1.5 w-8 rounded-full bg-primary"></div>
          <div class="h-1.5 w-1.5 rounded-full bg-primary/20"></div>
          <div class="h-1.5 w-1.5 rounded-full bg-primary/20"></div>
          <div class="h-1.5 w-1.5 rounded-full bg-primary/20"></div>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto pb-32">
          <div class="flex justify-center pt-10 pb-6">
            <div class="w-36 h-36 bg-primary/10 rounded-full flex items-center justify-center relative">
              <div class="absolute inset-0 rounded-full border-2 border-primary/5 animate-pulse"></div>
              <span class="material-symbols-outlined text-primary text-[72px]">shield_with_heart</span>
            </div>
          </div>

          <h1 class="text-primary tracking-tight text-[32px] font-bold leading-tight px-8 text-center pb-3 font-display">
            Your Privacy Matters
          </h1>

          <p class="text-slate-600 text-base font-normal leading-relaxed pb-8 pt-1 px-10 text-center">
            At Micro2Move, we're committed to being transparent about how we handle your data.
          </p>

          <div class="px-5 space-y-4">
            <div class="bg-white border border-primary/10 p-5 rounded-2xl flex items-start gap-4 shadow-sm">
              <div class="bg-primary/10 p-3 rounded-xl">
                <span class="material-symbols-outlined text-primary">verified_user</span>
              </div>
              <div class="flex-1">
                <h3 class="text-primary font-bold text-lg mb-1 font-display">Our Privacy Promise</h3>
                <p class="text-slate-500 text-sm leading-relaxed">We will never sell your personal data to third parties. Your trust is our foundation.</p>
              </div>
            </div>

            <div class="bg-white border border-primary/10 p-5 rounded-2xl flex items-start gap-4 shadow-sm">
              <div class="bg-primary/10 p-3 rounded-xl">
                <span class="material-symbols-outlined text-primary">gavel</span>
              </div>
              <div class="flex-1">
                <h3 class="text-primary font-bold text-lg mb-1 font-display">Your Rights at a Glance</h3>
                <p class="text-slate-500 text-sm leading-relaxed">You have full control over your information, including the right to access, edit, or delete it anytime.</p>
              </div>
            </div>
          </div>

          <div class="px-5 mt-10">
            <div class="w-full bg-primary/5 rounded-2xl min-h-[120px] border-2 border-dashed border-primary/20 flex items-center justify-center">
              <div class="flex items-center gap-2 opacity-40">
                <span class="material-symbols-outlined text-primary text-xl">hub</span>
                <span class="text-primary font-semibold tracking-wide text-sm uppercase">Secure Micro2Move Ecosystem</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Button -->
        <div class="absolute bottom-0 left-0 right-0 p-6 bg-white/80 backdrop-blur-xl border-t border-slate-100">
          <button onclick="showTncStep(2)" class="w-full bg-primary hover:bg-primary/90 text-white font-bold h-[60px] rounded-2xl transition-all active:scale-[0.98] shadow-xl shadow-primary/25 flex items-center justify-center gap-2">
            <span class="text-lg">Continue</span>
            <span class="material-symbols-outlined font-bold">arrow_forward</span>
          </button>
        </div>
      </div>

      <!-- TNC Step 2: Personal Data -->
      <div id="tncStep2" class="flex flex-col h-full hidden">
        <div class="flex items-center bg-white/80 backdrop-blur-md sticky top-0 z-20 p-4 pb-2 justify-between">
          <button onclick="showTncStep(1)" class="text-primary flex size-12 shrink-0 items-center justify-start">
            <span class="material-symbols-outlined text-2xl">arrow_back_ios</span>
          </button>
          <h2 class="text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display">Personal Data</h2>
          <div class="size-12"></div>
        </div>

        <div class="flex w-full flex-row items-center justify-center gap-3 py-4 bg-white">
          <div class="h-1.5 w-6 rounded-full bg-primary/30"></div>
          <div class="h-1.5 w-6 rounded-full bg-primary"></div>
          <div class="h-1.5 w-1.5 rounded-full bg-slate-200"></div>
          <div class="h-1.5 w-1.5 rounded-full bg-slate-200"></div>
        </div>

        <div class="flex-1 overflow-y-auto pb-32">
          <div class="px-6 pt-6 pb-2">
            <h1 class="text-slate-900 tracking-tight text-2xl font-bold leading-tight mb-2 font-display">
              Manage your data
            </h1>
            <p class="text-slate-500 text-base">
              Choose what information you'd like to share to personalize your Micro2Move experience.
            </p>
          </div>

          <div class="mt-6 px-4">
            <div class="bg-slate-50 rounded-2xl p-2">
              <!-- Profile Details Toggle -->
              <div class="flex items-center justify-between p-4 bg-white rounded-xl mb-1 shadow-sm border border-slate-100">
                <div class="flex items-center gap-4">
                  <div class="size-10 rounded-full bg-primary/10 flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary text-xl">person</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-slate-900">Profile Details</h4>
                    <p class="text-xs text-slate-500">Name, email, and avatar</p>
                  </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer">
                  <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>

              <!-- Location Access Toggle -->
              <div class="flex items-center justify-between p-4 bg-white rounded-xl mb-1 shadow-sm border border-slate-100">
                <div class="flex items-center gap-4">
                  <div class="size-10 rounded-full bg-primary/10 flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary text-xl">location_on</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-slate-900">Location Access</h4>
                    <p class="text-xs text-slate-500">Used for local ride finding</p>
                  </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer">
                  <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>

              <!-- Usage Analytics Toggle -->
              <div class="flex items-center justify-between p-4 bg-white rounded-xl shadow-sm border border-slate-100">
                <div class="flex items-center gap-4">
                  <div class="size-10 rounded-full bg-primary/10 flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary text-xl">analytics</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-slate-900">Usage Analytics</h4>
                    <p class="text-xs text-slate-500">Help us improve the app</p>
                  </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" class="sr-only peer">
                  <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
            </div>
          </div>

          <div class="px-4 mt-6">
            <div class="bg-primary p-5 rounded-2xl text-white flex items-center gap-4 shadow-lg shadow-primary/20">
              <div class="bg-white/20 p-2 rounded-lg">
                <span class="material-symbols-outlined text-white">lock</span>
              </div>
              <div>
                <h3 class="font-bold text-base leading-tight">Secure Storage</h3>
                <p class="text-purple-100 text-sm">Your data is encrypted using industry-standard protocols.</p>
              </div>
            </div>
          </div>

          <p class="px-8 mt-8 text-center text-xs text-slate-400 leading-relaxed">
            You can change these settings at any time in the Privacy section of your profile.
          </p>
        </div>

        <div class="absolute bottom-0 left-0 right-0 p-6 bg-white/90 backdrop-blur-md border-t border-slate-100">
          <div class="flex flex-col gap-3">
            <button onclick="showTncStep(3)" class="w-full bg-primary hover:bg-purple-900 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-primary/25 flex items-center justify-center gap-2 active:scale-[0.98]">
              Continue
              <span class="material-symbols-outlined">arrow_forward</span>
            </button>
            <button class="w-full bg-transparent text-slate-500 font-medium py-2 rounded-xl transition-colors flex items-center justify-center text-sm">
              Review detailed policy
            </button>
          </div>
        </div>
      </div>

      <!-- TNC Step 3: Location Data -->
      <div id="tncStep3" class="flex flex-col h-full hidden bg-[#FDFCFE]">
        <div class="flex items-center bg-transparent p-4 pb-2 justify-between">
          <button onclick="showTncStep(2)" class="text-primary flex size-12 shrink-0 items-center">
            <span class="material-symbols-outlined text-2xl">arrow_back_ios</span>
          </button>
          <h2 class="text-primary text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display">Step 3 of 4</h2>
          <div class="size-12"></div>
        </div>

        <div class="flex w-full flex-row items-center justify-center gap-3 py-4">
          <div class="h-2 w-2 rounded-full bg-primary/20"></div>
          <div class="h-2 w-2 rounded-full bg-primary/20"></div>
          <div class="h-2 w-6 rounded-full bg-primary"></div>
          <div class="h-2 w-2 rounded-full bg-primary/20"></div>
        </div>

        <div class="flex-1 overflow-y-auto pb-32">
          <div class="px-6 pt-4 pb-8">
            <div class="relative w-full aspect-square bg-primary/5 rounded-3xl overflow-hidden border border-primary/10" style="background-image: radial-gradient(circle, #7C3AED 1px, transparent 1px); background-size: 24px 24px;">
              <div class="absolute inset-0 flex items-center justify-center">
                <svg class="w-full h-full opacity-20" viewBox="0 0 100 100">
                  <path d="M10,50 Q30,20 50,50 T90,50" fill="none" stroke="#7C3AED" stroke-linecap="round" stroke-width="4"></path>
                  <path d="M20,10 Q50,40 80,10" fill="none" stroke="#7C3AED" stroke-linecap="round" stroke-width="4"></path>
                  <circle cx="50" cy="50" fill="none" r="30" stroke="#7C3AED" stroke-dasharray="4 4" stroke-width="1"></circle>
                </svg>
                <div class="relative flex items-center justify-center">
                  <div class="absolute w-24 h-24 bg-primary/20 rounded-full animate-ping"></div>
                  <div class="absolute w-16 h-16 bg-primary/30 rounded-full"></div>
                  <div class="z-10 bg-white p-3 rounded-full shadow-xl">
                    <span class="material-symbols-outlined text-primary text-4xl">location_on</span>
                  </div>
                </div>
                <div class="absolute top-4 right-4 bg-white/90 backdrop-blur p-2 rounded-lg shadow-sm border border-primary/10">
                  <span class="material-symbols-outlined text-primary">navigation</span>
                </div>
              </div>
            </div>
          </div>

          <h1 class="text-primary tracking-tight text-[28px] font-bold leading-tight px-6 text-center pb-3 font-display">
            Location Data
          </h1>

          <p class="text-primary/80 text-base font-normal leading-relaxed pb-8 px-10 text-center">
            We use your location to find nearby vehicles and calculate the most efficient routes for your journey.
          </p>

          <div class="px-6 space-y-4">
            <div class="flex items-center gap-4 p-4 bg-white rounded-2xl border border-primary/5">
              <div class="flex-shrink-0 w-10 h-10 bg-primary/10 flex items-center justify-center rounded-full">
                <span class="material-symbols-outlined text-primary text-xl">near_me</span>
              </div>
              <div>
                <h3 class="font-bold text-primary font-display">Precise Pickups</h3>
                <p class="text-sm text-primary/60">Find the exact spot of your Micro2Move ride.</p>
              </div>
            </div>

            <div class="flex items-center gap-4 p-4 bg-white rounded-2xl border border-primary/5">
              <div class="flex-shrink-0 w-10 h-10 bg-primary/10 flex items-center justify-center rounded-full">
                <span class="material-symbols-outlined text-primary text-xl">route</span>
              </div>
              <div>
                <h3 class="font-bold text-primary font-display">Live Navigation</h3>
                <p class="text-sm text-primary/60">Get real-time updates and turn-by-turn guidance.</p>
              </div>
            </div>

            <div class="flex items-center gap-4 p-4 bg-white rounded-2xl border border-primary/5">
              <div class="flex-shrink-0 w-10 h-10 bg-primary/10 flex items-center justify-center rounded-full">
                <span class="material-symbols-outlined text-primary text-xl">verified</span>
              </div>
              <div>
                <h3 class="font-bold text-primary font-display">Ride History</h3>
                <p class="text-sm text-primary/60">Securely log your trips for easy expense reporting.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="absolute bottom-0 left-0 right-0 p-6 bg-[#FDFCFE]/95 backdrop-blur-md flex flex-col gap-3">
          <button onclick="showTncStep(4)" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-primary/25 flex items-center justify-center gap-2 active:scale-[0.98]">
            Next Step
            <span class="material-symbols-outlined">arrow_forward</span>
          </button>
          <button class="w-full py-2 text-primary/60 font-medium text-sm">
            Learn more about data usage
          </button>
        </div>
      </div>

      <!-- TNC Step 4: Final Consent -->
      <div id="tncStep4" class="flex flex-col h-full hidden bg-[#FDFCFE]">
        <div class="flex items-center bg-transparent p-4 pb-2 justify-between">
          <button onclick="showTncStep(3)" class="text-primary flex size-12 shrink-0 items-center justify-start">
            <span class="material-symbols-outlined text-2xl">arrow_back_ios</span>
          </button>
          <h2 class="text-primary text-lg font-bold leading-tight tracking-tight flex-1 text-center font-display">Final Consent</h2>
          <div class="size-12"></div>
        </div>

        <div class="flex w-full flex-row items-center justify-center gap-3 py-4">
          <div class="h-2 w-2 rounded-full bg-primary"></div>
          <div class="h-2 w-2 rounded-full bg-primary"></div>
          <div class="h-2 w-2 rounded-full bg-primary"></div>
          <div class="h-2 w-10 rounded-full bg-primary transition-all duration-500"></div>
        </div>

        <div class="flex-1 overflow-y-auto pb-32">
          <div class="flex justify-center pt-8 pb-4">
            <div class="w-32 h-32 bg-primary/10 rounded-full flex items-center justify-center relative">
              <span class="material-symbols-outlined text-primary text-[64px]">task_alt</span>
              <div class="absolute -bottom-1 -right-1 bg-white p-1 rounded-full">
                <span class="material-symbols-outlined text-primary text-3xl">verified</span>
              </div>
            </div>
          </div>

          <h1 class="text-primary tracking-tight text-[28px] font-bold leading-tight px-6 text-center pb-3 font-display">
            All Set to Move Securely
          </h1>

          <p class="text-primary/80 text-base font-normal leading-normal pb-8 pt-1 px-8 text-center">
            Review your selections. You're just one step away from joining the ecosystem.
          </p>

          <div class="px-6 space-y-3">
            <!-- Essential Location Access -->
            <div class="flex items-center gap-4 p-4 bg-white border border-primary/10 rounded-2xl">
              <div class="size-10 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                <span class="material-symbols-outlined text-primary text-xl">location_on</span>
              </div>
              <div class="flex-1">
                <p class="text-primary font-semibold text-sm">Essential Location Access</p>
                <p class="text-primary/60 text-xs">Used only during active rides</p>
              </div>
              <span class="material-symbols-outlined text-primary text-xl">check_circle</span>
            </div>

            <!-- Smart Notifications -->
            <div class="flex items-center gap-4 p-4 bg-white border border-primary/10 rounded-2xl">
              <div class="size-10 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                <span class="material-symbols-outlined text-primary text-xl">notifications</span>
              </div>
              <div class="flex-1">
                <p class="text-primary font-semibold text-sm">Smart Notifications</p>
                <p class="text-primary/60 text-xs">Service updates and safety alerts</p>
              </div>
              <span class="material-symbols-outlined text-primary text-xl">check_circle</span>
            </div>

            <!-- Anonymous Analytics (Optional) -->
            <div class="flex items-center gap-4 p-4 bg-white border border-primary/10 rounded-2xl opacity-70">
              <div class="size-10 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                <span class="material-symbols-outlined text-primary text-xl">analytics</span>
              </div>
              <div class="flex-1">
                <p class="text-primary font-semibold text-sm">Anonymous Analytics</p>
                <p class="text-primary/60 text-xs">Help us improve the community</p>
              </div>
              <span class="material-symbols-outlined text-primary/30 text-xl">circle</span>
            </div>
          </div>

          <div class="px-8 mt-10">
            <p class="text-center text-xs text-primary/60 leading-relaxed">
              By tapping 'Accept All & Finish', you agree to our <span class="text-primary font-bold underline">Terms of Service</span> and <span class="text-primary font-bold underline">Privacy Policy</span>. You can update these settings anytime in your profile.
            </p>
          </div>
        </div>

        <div class="absolute bottom-0 left-0 right-0 p-6 bg-[#FDFCFE]/95 backdrop-blur-md border-t border-primary/5">
          <div class="flex flex-col gap-3">
            <button onclick="completeTnc()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-primary/25 flex items-center justify-center gap-2 active:scale-[0.98]">
              Accept All & Finish
              <span class="material-symbols-outlined">done_all</span>
            </button>
            <button class="w-full bg-transparent text-primary/70 font-medium py-3 text-sm hover:text-primary transition-colors">
              Customize Settings
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ============================================
       PLACEHOLDER SCREENS (Coming Soon)
       ============================================ -->

  <!-- Cycling Communities Screen -->
  <div id="cyclingCommunities" class="fixed inset-0 z-30 bg-background-light flex flex-col hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] mx-auto flex-col bg-background-light overflow-x-hidden shadow-2xl pb-24">

      <!-- Header -->
      <header class="sticky top-0 z-50 bg-background-light/80 backdrop-blur-md px-6 pt-12 pb-4">
        <div class="flex items-center justify-between mb-4">
          <button onclick="showWelcomeHub()" class="flex items-center gap-1 text-primary font-medium">
            <span class="material-symbols-outlined text-2xl">chevron_left</span>
            <span>Back</span>
          </button>
          <button class="bg-gray-200/50 p-2 rounded-full flex items-center justify-center">
            <span class="material-symbols-outlined text-[#706189]">search</span>
          </button>
        </div>
        <h1 class="text-3xl font-bold font-display text-center text-[#131118] mb-6">Cycling Communities</h1>

        <!-- List/Map Toggle -->
        <div class="bg-gray-200/50 p-1 rounded-full flex items-center max-w-[320px] mx-auto">
          <button id="listTabBtn" onclick="showCommunityView('list')" class="flex-1 bg-white py-2 rounded-full text-sm font-bold text-primary shadow-sm flex items-center justify-center gap-2 transition-all">
            <span class="material-symbols-outlined text-lg">format_list_bulleted</span>
            List
          </button>
          <button id="mapTabBtn" onclick="showCommunityView('map')" class="flex-1 py-2 rounded-full text-sm font-bold text-[#706189] flex items-center justify-center gap-2 transition-all">
            <span class="material-symbols-outlined text-lg text-gray-400">map</span>
            Map
          </button>
        </div>
      </header>

      <!-- MAP VIEW -->
      <div id="communityMapView" class="flex-1 flex flex-col hidden">
        <div class="flex-1 relative">
          <!-- Google My Maps Embed -->
          <iframe
            src="https://www.google.com/maps/d/embed?mid=18LrGVELKm9obR7Xh_BH6_r7sAzc&ll=-33.93341871901306,151.18499007419956&z=12"
            class="w-full h-full absolute inset-0"
            style="border:0; min-height: 600px;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>

          <!-- Floating Community Card -->
          <div class="absolute bottom-32 left-4 right-4 bg-white rounded-2xl shadow-xl border border-gray-100 p-4 z-10">
            <div class="flex gap-4">
              <div class="w-20 h-20 rounded-xl overflow-hidden flex-shrink-0">
                <img alt="Easts Cycling Club" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAGw7oCs3P-c9dLFvH4YNOZLWBaKMwLhbUXZXEYazxnv31ieb_bmxmtfOG-98ixSAF6gYBC0YENZdZBahxsLdRxYcdha9on99bNhrXl7JaO0OreBsU6Nwunt5VlAsBRVx4KOCE_1b2cdbb2ZjzLeRQx9W2aprw8Z2ag8cuzkLkf1T-vZizmlePR82NN2XI7cskgZTmfXJMvq3v7Mrxb27yvjOll2uSFgBFpeAi8SycM2xufzzgQVY2t74zEUgpx1qFHSad4NN_JKj7N"/>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <span class="bg-primary text-white text-[8px] font-bold px-2 py-0.5 rounded-full uppercase">Verified</span>
                  <div class="flex items-center gap-0.5 text-primary">
                    <span class="material-symbols-outlined text-sm">star</span>
                    <span class="font-bold text-xs">4.9</span>
                  </div>
                </div>
                <h3 class="text-base font-bold font-display text-[#131118] truncate">Easts Cycling Club</h3>
                <div class="flex items-center gap-1 text-[#706189] text-xs mt-1">
                  <span class="material-symbols-outlined text-sm">groups</span>
                  <span>1,240 Members</span>
                  <span class="mx-1">•</span>
                  <span>2.3 km away</span>
                </div>
              </div>
            </div>
            <button class="w-full bg-primary text-white font-bold py-3 rounded-xl mt-3 flex items-center justify-center gap-2 active:scale-[0.98] transition-transform">
              <span class="material-symbols-outlined text-lg">directions</span>
              Get Directions
            </button>
          </div>

          <!-- Map Controls -->
          <div class="absolute top-4 right-4 flex flex-col gap-2 z-10">
            <button class="bg-white p-3 rounded-xl shadow-lg border border-gray-100 active:bg-gray-50">
              <span class="material-symbols-outlined text-primary">my_location</span>
            </button>
            <button class="bg-white p-3 rounded-xl shadow-lg border border-gray-100 active:bg-gray-50">
              <span class="material-symbols-outlined text-primary">layers</span>
            </button>
          </div>

          <!-- Community Legend -->
          <div class="absolute top-4 left-4 bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 p-3 z-10">
            <p class="text-xs font-bold text-[#131118] mb-2">Sydney Communities</p>
            <div class="flex flex-col gap-1.5">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-primary"></div>
                <span class="text-[10px] text-[#706189]">Cycling Clubs (5)</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-accent-green"></div>
                <span class="text-[10px] text-[#706189]">E-bike Hubs (3)</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                <span class="text-[10px] text-[#706189]">Events Today (2)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- LIST VIEW - Community Cards -->
      <div id="communityListView" class="flex flex-col gap-5 px-6 pt-4 overflow-y-auto flex-1">

        <!-- Easts Cycling Club -->
        <div class="bg-white rounded-[2.5rem] overflow-hidden shadow-sm border border-gray-100 group">
          <div class="h-52 overflow-hidden relative">
            <img alt="Easts Cycling Club" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAGw7oCs3P-c9dLFvH4YNOZLWBaKMwLhbUXZXEYazxnv31ieb_bmxmtfOG-98ixSAF6gYBC0YENZdZBahxsLdRxYcdha9on99bNhrXl7JaO0OreBsU6Nwunt5VlAsBRVx4KOCE_1b2cdbb2ZjzLeRQx9W2aprw8Z2ag8cuzkLkf1T-vZizmlePR82NN2XI7cskgZTmfXJMvq3v7Mrxb27yvjOll2uSFgBFpeAi8SycM2xufzzgQVY2t74zEUgpx1qFHSad4NN_JKj7N"/>
            <div class="absolute top-4 left-4 bg-primary text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider">Verified Group</div>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-xl font-bold font-display text-[#131118]">Easts Cycling Club</h3>
              <div class="flex items-center gap-1 text-primary">
                <span class="material-symbols-outlined text-lg">star</span>
                <span class="font-bold text-sm">4.9</span>
              </div>
            </div>
            <div class="flex items-center gap-2 text-[#706189] text-xs mb-3 font-medium">
              <span class="material-symbols-outlined text-base">groups</span>
              <span>1,240 Members</span>
              <span class="mx-0.5">•</span>
              <span class="material-symbols-outlined text-base">location_on</span>
              <span>Eastern Suburbs</span>
            </div>
            <p class="text-[#706189] text-sm leading-relaxed mb-6">
              The premier cycling club for Sydney's eastern suburbs. Join us for coastal rides, sunrise training sessions, and social weekend tours through the scenic east.
            </p>
            <button class="w-full bg-[#F3E8FF] text-primary font-bold py-4 rounded-2xl hover:bg-primary hover:text-white transition-colors duration-200">
              Join Community
            </button>
          </div>
        </div>

        <!-- Parra-Bike Hub -->
        <div class="bg-white rounded-[2.5rem] overflow-hidden shadow-sm border border-gray-100 group mb-4">
          <div class="h-52 overflow-hidden relative">
            <img alt="Parra-Bike Hub" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDSu5sbPTJErkSjGOdSw7KGqbftqUbaiQz54aP5WFtsCQ94AATEYQMC-fFYzMfLV4d2K35juYMZ5ddmfXCgQq-0IhVtwG8-UprUdxQL1_A1D8bahVDWBLR4cMIIBpzmXAouCKKG9MR1QEti5t-Hh2lZOmJ8YHQ69aEoErhkxVvPPoLYZNHLcrfAglpsZQ4QnXSpUhU_c5n23NvJqlGkVmKCA6oQjlCRp9kY4wPzn_j26rpVFeusU84YFRTwQbdOsm4FnMHCmI5NWEzs"/>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-xl font-bold font-display text-[#131118]">Parra-Bike Hub</h3>
              <div class="flex items-center gap-1 text-primary">
                <span class="material-symbols-outlined text-lg">star</span>
                <span class="font-bold text-sm">4.7</span>
              </div>
            </div>
            <div class="flex items-center gap-2 text-[#706189] text-xs mb-3 font-medium">
              <span class="material-symbols-outlined text-base">groups</span>
              <span>856 Members</span>
              <span class="mx-0.5">•</span>
              <span class="material-symbols-outlined text-base">location_on</span>
              <span>Parramatta & West</span>
            </div>
            <p class="text-[#706189] text-sm leading-relaxed mb-6">
              E-bike Education: Join us for workshops, safety courses, and community rides in the heart of Parramatta.
            </p>
            <button class="w-full bg-[#F3E8FF] text-primary font-bold py-4 rounded-2xl hover:bg-primary hover:text-white transition-colors duration-200">
              Join Community
            </button>
          </div>
        </div>

        <!-- Northern Beaches Riders -->
        <div class="bg-white rounded-[2.5rem] overflow-hidden shadow-sm border border-gray-100 group mb-4">
          <div class="h-52 overflow-hidden relative bg-gradient-to-br from-primary/20 to-accent-green/20 flex items-center justify-center">
            <span class="material-symbols-outlined text-6xl text-primary/40">directions_bike</span>
          </div>
          <div class="p-6">
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-xl font-bold font-display text-[#131118]">Northern Beaches Riders</h3>
              <div class="flex items-center gap-1 text-primary">
                <span class="material-symbols-outlined text-lg">star</span>
                <span class="font-bold text-sm">4.8</span>
              </div>
            </div>
            <div class="flex items-center gap-2 text-[#706189] text-xs mb-3 font-medium">
              <span class="material-symbols-outlined text-base">groups</span>
              <span>678 Members</span>
              <span class="mx-0.5">•</span>
              <span class="material-symbols-outlined text-base">location_on</span>
              <span>Northern Beaches</span>
            </div>
            <p class="text-[#706189] text-sm leading-relaxed mb-6">
              Beach to bush rides along Sydney's stunning Northern Beaches. Perfect for weekend warriors and daily commuters alike.
            </p>
            <button class="w-full bg-[#F3E8FF] text-primary font-bold py-4 rounded-2xl hover:bg-primary hover:text-white transition-colors duration-200">
              Join Community
            </button>
          </div>
        </div>

      </div>

      <!-- Bottom Tab Bar -->
      <nav class="fixed bottom-0 w-full max-w-[430px] bg-white/95 backdrop-blur-lg border-t border-gray-100 px-8 pt-3 pb-8 flex justify-between items-center z-50" style="box-shadow: 0 -2px 10px rgba(0,0,0,0.05);">
        <button onclick="showWelcomeHub()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl">home</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Home</span>
        </button>
        <button class="flex flex-col items-center gap-1 text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl font-bold">groups</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Community</span>
        </button>
        <div class="relative -top-8">
          <button onclick="showScreen('aiRoutePlanner')" class="bg-primary px-5 py-3 rounded-full shadow-lg shadow-primary/40 text-white flex items-center justify-center gap-2 transform active:scale-95 transition-transform border-4 border-white">
            <span class="material-symbols-outlined text-xl">auto_awesome</span>
            <span class="text-sm font-bold whitespace-nowrap">Route with AI</span>
          </button>
        </div>
        <button onclick="showScreen('findEbike')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl">electric_bike</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Rides</span>
        </button>
        <button onclick="showScreen('community')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl">person</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Profile</span>
        </button>
      </nav>

    </div>
  </div>

  <!-- Find E-bike Placeholder -->
  <!-- ============================================
       SCREEN 1: E-BIKE DEMO STORE FINDER
       ============================================ -->
  <div id="findEbike" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white">
      <header class="sticky top-0 z-50 flex items-center bg-white/80 backdrop-blur-md p-4 pb-2 justify-between border-b border-[#e5e5f0]">
        <div onclick="showWelcomeHub()" class="flex size-12 shrink-0 items-center cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios_new</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center font-display">E-bike Demos Near You</h2>
        <div class="flex w-12 items-center justify-end">
          <button class="flex cursor-pointer items-center justify-center rounded-lg h-12 bg-transparent">
            <span class="material-symbols-outlined">tune</span>
          </button>
        </div>
      </header>

      <main class="flex-1 pb-24 overflow-y-auto">
        <!-- Location Bar -->
        <div class="flex items-center gap-4 bg-white mx-4 mt-4 rounded-xl p-3 shadow-sm border border-[#e5e5f0]">
          <div class="flex items-center gap-3 flex-1">
            <div class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-10">
              <span class="material-symbols-outlined">location_on</span>
            </div>
            <div>
              <p class="text-[10px] text-[#828298] font-bold uppercase tracking-wider">Your Location</p>
              <p class="text-base font-bold leading-none">Kingsford, NSW</p>
            </div>
          </div>
          <div class="shrink-0">
            <span class="material-symbols-outlined text-[#828298]">chevron_right</span>
          </div>
        </div>

        <!-- Filter Chips -->
        <div class="flex gap-2 p-4 overflow-x-auto hide-scrollbar">
          <div class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-primary text-white px-4 shadow-sm">
            <span class="material-symbols-outlined text-sm">schedule</span>
            <p class="text-sm font-medium">Open Now</p>
          </div>
          <div class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-white border border-[#e5e5f0] px-4">
            <span class="material-symbols-outlined text-sm text-primary">safety_check</span>
            <p class="text-sm font-medium">Free Helmets</p>
          </div>
          <div class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-white border border-[#e5e5f0] px-4">
            <span class="material-symbols-outlined text-sm text-primary">battery_charging_full</span>
            <p class="text-sm font-medium">Fast Charging</p>
          </div>
        </div>

        <!-- Promo Banner -->
        <div class="px-4 mb-6">
          <div class="flex flex-col overflow-hidden rounded-2xl bg-gradient-to-br from-primary via-[#6D28D9] to-[#5B21B6] text-white shadow-xl relative">
            <div class="absolute top-0 right-0 p-4 opacity-10">
              <span class="material-symbols-outlined !text-8xl">electric_bike</span>
            </div>
            <div class="p-6 relative z-10">
              <span class="bg-white/20 backdrop-blur-md px-2 py-1 rounded text-[10px] font-bold uppercase tracking-widest mb-2 inline-block">Limited Offer</span>
              <h4 class="text-2xl font-bold leading-tight mb-1 font-display">First demo free</h4>
              <p class="text-white/80 text-sm mb-4 max-w-[200px]">Start your journey with Micro2Move today at any partner store!</p>
              <button class="bg-white text-primary px-6 py-2 rounded-lg text-sm font-bold shadow-lg active:scale-95 transition-transform">Claim Offer</button>
            </div>
          </div>
        </div>

        <!-- Store Partners Header -->
        <div class="px-4 pb-2">
          <h3 class="text-xl font-bold leading-tight tracking-[-0.015em] font-display">Store Partners</h3>
          <p class="text-[#828298] text-sm">Find certified e-bike experts near you</p>
        </div>

        <!-- Store Cards -->
        <div class="px-4 space-y-4 pt-2">
          <!-- Store 1: Sydney E-bikes -->
          <div onclick="showScreen('ebikeProduct')" class="bg-white rounded-xl overflow-hidden shadow-[0_4px_16px_rgba(124,58,237,0.06)] border border-[#e5e5f0] cursor-pointer active:scale-[0.98] transition-transform">
            <div class="flex p-4 gap-4">
              <div class="w-20 h-20 rounded-lg bg-cover bg-center shrink-0 border border-[#e5e5f0]" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBjxmwb2MpT5ETcR91e7SyVN_WZhPgx6yN5MdCpnxmpC1YA376fq1WHfrSzyzdTwv4B5m-ZZ_KYk_ariBlH9CMA17Md8FURmGE9AjFRm1rXxxnn_GU1euzWOh508-8Ybdr3pL6RpWhPuWBf2Aox3jlhvqH2RE8GhzaNRMoOhRo98cvKx6zAhYmeADDm4JoMKtW8bHsO4criyCp58YukIh-zBi6LTrPyJrY8H9MHzBBppvAQfGglUXGzxEn4M8gqOuyfJR0UkOhErYAT');"></div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-bold text-lg font-display">Sydney E-bikes</h4>
                  <div class="flex items-center gap-1 bg-yellow-400/10 px-1.5 py-0.5 rounded">
                    <span class="material-symbols-outlined !text-sm text-yellow-600" style="font-variation-settings: 'FILL' 1;">star</span>
                    <span class="text-xs font-bold text-yellow-700">4.8</span>
                  </div>
                </div>
                <p class="text-sm text-[#828298] mb-3">1.2 km &bull; Botany Rd, Rosebery</p>
                <div class="flex items-center justify-between">
                  <div class="flex -space-x-2">
                    <div class="w-6 h-6 rounded-full border-2 border-white bg-primary/10 flex items-center justify-center text-primary"><span class="material-symbols-outlined !text-[12px]">electric_bike</span></div>
                    <div class="w-6 h-6 rounded-full border-2 border-white bg-primary/10 flex items-center justify-center text-primary"><span class="material-symbols-outlined !text-[12px]">pedal_bike</span></div>
                  </div>
                  <button class="bg-primary text-white px-4 py-1.5 rounded-lg text-sm font-bold shadow-md shadow-primary/20">View Bikes</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Store 2: Volt Cycles -->
          <div onclick="showScreen('ebikeProduct')" class="bg-white rounded-xl overflow-hidden shadow-[0_4px_16px_rgba(124,58,237,0.06)] border border-[#e5e5f0] cursor-pointer active:scale-[0.98] transition-transform">
            <div class="flex p-4 gap-4">
              <div class="w-20 h-20 rounded-lg bg-cover bg-center shrink-0 border border-[#e5e5f0]" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBbYVBeLeQAtGh-YkCwr_wcha8JYRVBvbRQLgxpLZNxk1vfpSpbc9TTnDZWM9H9jV7Y2hE6Xp_Ify2jrWvsK1H3UkgBJCA4a41TZOpgGjoyOfmE8FRGTMP69whK8Y5c2iSMlsBpW3p6uUF2K-3W0llHU25rekuFdZpCIFztRy4bJ6o0jsk3Z5nzbDZzX4R1OD2vXBtmrn4dV4LVjmOdrpmd6--h5fk0yD_JP7rTKlIfysQFkHAtfvzN2Ay1AgeSia-aQnuiw70KC0nF');"></div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-bold text-lg font-display">Volt Cycles</h4>
                  <div class="flex items-center gap-1 bg-yellow-400/10 px-1.5 py-0.5 rounded">
                    <span class="material-symbols-outlined !text-sm text-yellow-600" style="font-variation-settings: 'FILL' 1;">star</span>
                    <span class="text-xs font-bold text-yellow-700">4.6</span>
                  </div>
                </div>
                <p class="text-sm text-[#828298] mb-3">2.5 km &bull; Anzac Pde, Kingsford</p>
                <div class="flex items-center justify-between">
                  <div class="flex -space-x-2">
                    <div class="w-6 h-6 rounded-full border-2 border-white bg-primary/10 flex items-center justify-center text-primary"><span class="material-symbols-outlined !text-[12px]">electric_bike</span></div>
                  </div>
                  <button class="bg-primary text-white px-4 py-1.5 rounded-lg text-sm font-bold shadow-md shadow-primary/20">View Bikes</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Store 3: Urban Mobility -->
          <div onclick="showScreen('bookDemo')" class="bg-white rounded-xl overflow-hidden shadow-[0_4px_16px_rgba(124,58,237,0.06)] border border-[#e5e5f0] opacity-80 cursor-pointer active:scale-[0.98] transition-transform">
            <div class="flex p-4 gap-4">
              <div class="w-20 h-20 rounded-lg bg-cover bg-center shrink-0 border border-[#e5e5f0]" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuB5vjDElwGxM9yDU1QbePDVWFIIoZ-HMJTgsO1iXyWp7Mgx59FGfNRk_1TohDwPOuBGqVaE_U_GCfINHxoxgiJiia8uCtoyY2yGlybpleWE8atz3vzv9LPqn-lNLw6GJNEWixeckUpz3nqmSYNC8Hdy_4Eu54DadskSAu_eUeoK9r0O71sppoxQTbyPIJ5hKIESkJvAVJr4gtNhAY1wZmEdb8maF810LdvInZJnBsQy7nKYqQI-FnDUTl76uEOu-RTtJ_zhrdesvTkj');"></div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-bold text-lg font-display">Urban Mobility</h4>
                  <div class="flex items-center gap-1 bg-yellow-400/10 px-1.5 py-0.5 rounded">
                    <span class="material-symbols-outlined !text-sm text-yellow-600" style="font-variation-settings: 'FILL' 1;">star</span>
                    <span class="text-xs font-bold text-yellow-700">4.9</span>
                  </div>
                </div>
                <p class="text-sm text-[#828298] mb-3">3.1 km &bull; High St, Randwick</p>
                <div class="flex items-center justify-between">
                  <p class="text-xs text-[#828298] font-medium italic">Closing in 15 mins</p>
                  <button class="bg-primary text-white px-4 py-1.5 rounded-lg text-sm font-bold shadow-md shadow-primary/20">View Bikes</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Map FAB -->
      <div class="fixed bottom-24 right-4 z-40">
        <div class="w-14 h-14 rounded-full border-4 border-white shadow-2xl overflow-hidden bg-primary/20 flex items-center justify-center cursor-pointer hover:scale-105 transition-transform">
          <span class="material-symbols-outlined text-primary font-bold" style="font-variation-settings: 'FILL' 1;">map</span>
        </div>
      </div>

      <!-- Bottom Nav -->
      <nav class="fixed bottom-0 left-0 right-0 mx-auto max-w-[430px] bg-white/95 backdrop-blur-md border-t border-[#e5e5f0] px-6 py-3 flex justify-between items-center z-50">
        <div onclick="showWelcomeHub()" class="flex flex-col items-center gap-1 text-[#828298] cursor-pointer">
          <span class="material-symbols-outlined">home</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Explore</span>
        </div>
        <div class="flex flex-col items-center gap-1 text-primary">
          <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">pedal_bike</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Rentals</span>
        </div>
        <div class="flex flex-col items-center gap-1 text-[#828298]">
          <span class="material-symbols-outlined">bookmark</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Saved</span>
        </div>
        <div class="flex flex-col items-center gap-1 text-[#828298]">
          <span class="material-symbols-outlined">person</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Profile</span>
        </div>
      </nav>
    </div>
  </div>

  <!-- ============================================
       SCREEN 2: BOOK A DEMO - SELECT BIKE & STORE
       ============================================ -->
  <div id="bookDemo" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('findEbike')" class="text-primary flex size-12 shrink-0 items-center justify-center cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-gray-900 text-lg font-bold leading-tight tracking-tight flex-1 text-center pr-12">Book a Demo</h2>
      </div>

      <!-- Progress Bar -->
      <div class="flex flex-col gap-3 p-4 bg-white">
        <div class="flex gap-6 justify-between items-end">
          <div class="flex flex-col">
            <span class="text-xs font-semibold uppercase tracking-wider text-primary mb-1">Step 1</span>
            <p class="text-gray-900 text-base font-bold leading-normal">Select Bike &amp; Store</p>
          </div>
          <p class="text-gray-500 text-sm font-medium leading-normal">1 of 3</p>
        </div>
        <div class="rounded-full bg-gray-100 h-2 w-full">
          <div class="h-2 rounded-full bg-primary" style="width: 33%;"></div>
        </div>
      </div>

      <!-- Choose E-Bike Model -->
      <div class="px-4 pt-6 pb-2">
        <h3 class="text-gray-900 text-lg font-bold leading-tight tracking-tight">Choose E-Bike Model</h3>
        <p class="text-gray-500 text-sm">Select the bike you want to test ride</p>
      </div>

      <!-- Bike Carousel -->
      <div class="flex overflow-x-auto hide-scrollbar">
        <div class="flex items-stretch p-4 gap-4">
          <!-- Bike Card 1 -->
          <div class="flex h-full flex-1 flex-col gap-3 rounded-xl min-w-[280px] bg-white border-2 border-primary shadow-sm p-3">
            <div class="w-full bg-center bg-no-repeat aspect-video bg-cover rounded-lg flex flex-col relative" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuA1lW6GCNvwVEYdMmtZs9tJ0OPyRsDzo9cQ8iAspT7VDzqkzHu5cNHsUrOyM0PDwCY9UmAJJQ7CDWevWLvlQMrSvggiF-jeaIBHLj-mmsJef3x7SU75PVmGztmQ8RRgZ3BX_aO0g2Qnw_YtHgQ5l4BDLSnqfddmyXsWwYpHGDGtkDMlkaz4e_U-LrjrgeODYQdPDjmgcPulOmsJ9-_KoeQmglUYOEAMemrL9f-dVfFpiW2HVuCL2_etfyS7vDmbZ0Z1rWnKnLXY8w_Y");'>
              <div class="absolute top-2 right-2 bg-primary text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase">Selected</div>
            </div>
            <div>
              <p class="text-gray-900 text-base font-bold leading-normal">Tern GSD S10</p>
              <p class="text-primary text-sm font-medium leading-normal">Compact Cargo</p>
              <div class="flex gap-2 mt-2">
                <span class="text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded">Mid-Drive</span>
                <span class="text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded">60km Range</span>
              </div>
            </div>
          </div>
          <!-- Bike Card 2 -->
          <div class="flex h-full flex-1 flex-col gap-3 rounded-xl min-w-[280px] bg-white border border-gray-100 shadow-sm p-3">
            <div class="w-full bg-center bg-no-repeat aspect-video bg-cover rounded-lg flex flex-col" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuB0h8hegyTXi6NYJv1bJr6LutV0haKM9xRiUFbwd_SVfrsC-fAXd4yWWnJyauCsqbe9T_gU8tn_BnuOpXveIAfgwwe1MWWQFJYyc4d5tgHtgqL0KSo8pN1XRSt6ZrMxghI8ZvxMK8X3pXNusS-Fa1jsBcaodX0gnQivQQip3plJwLrSECUPO3TvsBvPVwIyvjh1NGuzwrLelshCxLNV-7TeMKevuTG2vttDEGq6ovDBw8Ww1GXNmLdfWolD832GHf8tuQaUw3ZC87en");'></div>
            <div>
              <p class="text-gray-900 text-base font-bold leading-normal">Riese &amp; M&uuml;ller Load 60</p>
              <p class="text-gray-500 text-sm font-medium leading-normal">Full Suspension Cargo</p>
              <div class="flex gap-2 mt-2">
                <span class="text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded">Bosch Motor</span>
                <span class="text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded">Family Ready</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Select Store -->
      <div class="px-4 pt-4 pb-2">
        <h3 class="text-gray-900 text-lg font-bold leading-tight tracking-tight">Select Participating Store</h3>
        <p class="text-gray-500 text-sm">Available near your location</p>
      </div>

      <!-- Store List -->
      <div class="flex flex-col p-4 gap-3">
        <div class="flex items-center gap-4 p-4 bg-white rounded-xl border-2 border-primary shadow-sm">
          <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
            <span class="material-symbols-outlined">storefront</span>
          </div>
          <div class="flex-1">
            <h4 class="text-gray-900 font-bold text-base">PedL Redfern</h4>
            <p class="text-gray-500 text-xs">123 Regent St, Redfern NSW</p>
            <div class="flex items-center gap-1 mt-1 text-[10px] text-green-600 font-bold uppercase">
              <span class="material-symbols-outlined text-[12px]">check_circle</span>
              Available Today
            </div>
          </div>
          <div class="flex flex-col items-end">
            <span class="text-xs font-semibold text-gray-900">0.8 km</span>
            <span class="text-[10px] text-gray-400">Walking</span>
          </div>
        </div>

        <div class="flex items-center gap-4 p-4 bg-white rounded-xl border border-gray-100 shadow-sm opacity-80">
          <div class="size-12 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500">
            <span class="material-symbols-outlined">storefront</span>
          </div>
          <div class="flex-1">
            <h4 class="text-gray-900 font-bold text-base">99 Bikes Alexandria</h4>
            <p class="text-gray-500 text-xs">45 O'Riordan St, Alexandria NSW</p>
            <div class="flex items-center gap-1 mt-1 text-[10px] text-orange-500 font-bold uppercase">
              <span class="material-symbols-outlined text-[12px]">schedule</span>
              Limited Stock
            </div>
          </div>
          <div class="flex flex-col items-end">
            <span class="text-xs font-semibold text-gray-900">2.4 km</span>
            <span class="text-[10px] text-gray-400">Cycling</span>
          </div>
        </div>

        <!-- Map Preview -->
        <div class="w-full h-32 rounded-xl mt-2 overflow-hidden relative">
          <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCj72TFkbxWQilwdtYHwVJIfMKkrMoRDzob768xyM-TzsEUefde1EAjFG76c7yb_ggCePgO14HilIjF856yRqNgoBATXE3_oyniRA1Z9QKief4LT1zJ0myUXK70KKxXcWrphkEiBdeNqQGEupVCHFLjPWufVNplPxeKbkDnFHuSSXkih-dflmeF1F_s1h5uejU3XXaq77n1VR1rVLnIg8S77-YVc_h5tyRgNHWImOud4z3ssNU9SMIlzh0P-6oDXgQn8wFRW7auoPzj');"></div>
          <div class="absolute inset-0 bg-black/5"></div>
          <button class="absolute bottom-3 right-3 bg-white px-4 py-2 rounded-full shadow-lg text-primary text-xs font-bold flex items-center gap-2">
            <span class="material-symbols-outlined text-sm">map</span>
            View Full Map
          </button>
        </div>
      </div>

      <!-- Sticky Footer -->
      <div class="mt-auto p-4 bg-white border-t border-gray-100 pb-10">
        <button onclick="showScreen('demoSelection')" class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/30 flex items-center justify-center gap-2 active:scale-[0.98] transition-transform">
          Continue to Date &amp; Time
          <span class="material-symbols-outlined">arrow_forward</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN 3: 2-WEEK DEMO SELECTION
       ============================================ -->
  <div id="demoSelection" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('bookDemo')" class="flex size-12 shrink-0 items-center justify-center cursor-pointer">
          <span class="material-symbols-outlined">close</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">2-Week Demo Selection</h2>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-5 bg-white">
        <div class="h-2 w-8 rounded-full bg-primary"></div>
        <div class="h-2 w-2 rounded-full bg-[#e2dbe6]"></div>
        <div class="h-2 w-2 rounded-full bg-[#e2dbe6]"></div>
      </div>

      <!-- Bike Image -->
      <div class="px-4 pt-2">
        <div class="relative rounded-2xl overflow-hidden aspect-[4/3] bg-gray-100 mb-6">
          <img alt="Hokus E-bike" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuD9iTUIwN-WTzSjosMYQNmAoigmb4p7wBfdIktOMsxOsfJFh4KCez3dUo0ni6A1DBPcnFu1cay43eBQLmIif5AX3y7BKPagTD2INGDPW4MP_PxSAQdATTeoTBXABNn5z-hxJjvt7eURs1NHpEzL_A8qbFvjwvtvsQCpH4YyZkR6Wec4196z_YlFckGZ75uWrjtomC3g4tKHYOXsXSVwXyMAWBzK3zHyeDvVZh9HXgNGSfJ2aF9rZ6e74sY7O5KEBpm7Dg50zhb8vndh"/>
          <div class="absolute top-3 left-3 bg-primary text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Most Popular</div>
        </div>
        <div class="mb-6">
          <h1 class="text-2xl font-bold">Hokus E-bike</h1>
          <p class="text-gray-500">Experience the city like never before.</p>
        </div>
      </div>

      <!-- Earn Credits Banner -->
      <div class="px-4 mb-4">
        <div onclick="showScreen('educationHub')" class="p-4 rounded-2xl bg-gradient-to-r from-primary/10 to-green-500/10 border border-primary/20 flex items-center gap-4 cursor-pointer active:scale-[0.98] transition-transform">
          <div class="size-12 bg-primary/20 rounded-full flex items-center justify-center shrink-0">
            <span class="material-symbols-outlined text-primary text-2xl">school</span>
          </div>
          <div class="flex-1">
            <h4 class="font-bold text-sm">Earn credits to discount your ride</h4>
            <p class="text-xs text-gray-500">Complete safety quizzes for up to $55 off</p>
          </div>
          <span class="material-symbols-outlined text-primary">chevron_right</span>
        </div>
      </div>

      <!-- Demo Options -->
      <div class="px-4 pb-6">
        <!-- 2-Week Demo (Selected) -->
        <div class="p-5 rounded-2xl border-2 border-primary bg-primary/5 mb-4">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h3 class="text-lg font-bold">2-Week Demo</h3>
              <p class="text-sm text-gray-500">Full immersion experience</p>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold text-primary">$150</p>
              <p class="text-xs text-gray-400">Fixed rate</p>
            </div>
          </div>
          <div class="h-px bg-primary/20 w-full my-4"></div>
          <div class="space-y-3">
            <div class="flex items-center gap-3">
              <span class="material-symbols-outlined text-primary text-xl">event_available</span>
              <span class="text-sm font-medium">14-day rental period</span>
            </div>
            <div class="flex items-center gap-3">
              <span class="material-symbols-outlined text-primary text-xl">ev_charger</span>
              <span class="text-sm font-medium">Full charger kit included</span>
            </div>
            <div class="flex items-center gap-3">
              <span class="material-symbols-outlined text-primary text-xl">verified_user</span>
              <span class="text-sm font-medium">Premium insurance coverage</span>
            </div>
          </div>
        </div>

        <!-- 1-Hour Free Demo -->
        <div onclick="showScreen('demoAgreement')" class="p-5 rounded-2xl border border-gray-100 flex justify-between items-center cursor-pointer hover:border-primary/30 transition-colors">
          <div>
            <h3 class="text-base font-bold text-left">1-Hour Store Demo</h3>
            <p class="text-xs text-gray-400">Free trial at our location</p>
          </div>
          <span class="material-symbols-outlined text-gray-300">chevron_right</span>
        </div>

      </div>

      <!-- Price Summary -->
      <div class="px-4 py-6 bg-background-light border-t border-gray-100">
        <h3 class="text-sm font-bold uppercase tracking-widest mb-4">Price Summary</h3>
        <div class="space-y-2">
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">Rental Fee (14 days)</span>
            <span class="font-medium">$150.00</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">Insurance &amp; Protection</span>
            <span class="text-green-500 font-medium">Included</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">Charger &amp; Kit</span>
            <span class="text-green-500 font-medium">Included</span>
          </div>
          <div class="pt-2 mt-2 border-t border-gray-200 flex justify-between">
            <span class="font-bold">Total Due Now</span>
            <span class="font-bold text-primary text-lg">$150.00</span>
          </div>
        </div>
      </div>

      <!-- Sticky Footer -->
      <div class="sticky bottom-0 mt-auto p-4 bg-white border-t border-gray-100 pb-8">
        <button onclick="showScreen('scheduleDemo')" class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 active:scale-[0.98] transition-transform">
          Select &amp; Schedule
        </button>
        <p class="text-center text-[10px] text-gray-400 mt-4 px-6 uppercase tracking-tight">
          Refundable deposit may be required at time of pickup
        </p>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN 4: SCHEDULE DEMO TIME
       ============================================ -->
  <div id="scheduleDemo" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('demoSelection')" class="flex size-12 shrink-0 items-center justify-center cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Schedule Demo Time</h2>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-5 bg-white">
        <div class="h-2 w-2 rounded-full bg-[#e2dbe6]"></div>
        <div class="h-2 w-8 rounded-full bg-primary"></div>
        <div class="h-2 w-2 rounded-full bg-[#e2dbe6]"></div>
      </div>

      <!-- Pick a Date -->
      <div class="bg-white">
        <h3 class="tracking-light text-2xl font-bold leading-tight px-4 text-left pb-2 pt-2">Pick a Date</h3>
      </div>

      <!-- Calendar -->
      <div class="flex flex-wrap items-center justify-center gap-6 p-4 bg-white">
        <div class="flex min-w-full flex-1 flex-col gap-0.5 border border-gray-100 rounded-xl p-2 bg-background-light/30">
          <div class="flex items-center p-1 justify-between">
            <button class="text-primary hover:bg-primary/10 rounded-full p-2 transition-colors">
              <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <p class="text-base font-bold leading-tight flex-1 text-center">February 2026</p>
            <button class="text-primary hover:bg-primary/10 rounded-full p-2 transition-colors">
              <span class="material-symbols-outlined">chevron_right</span>
            </button>
          </div>
          <div class="grid grid-cols-7 text-center">
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">S</p>
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">M</p>
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">T</p>
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">W</p>
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">T</p>
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">F</p>
            <p class="text-black/50 text-[13px] font-bold h-10 flex items-center justify-center">S</p>
            <div class="h-10 w-full"></div>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">2</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">3</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">4</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">5</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">6</div></button>
            <button class="h-10 w-full text-white text-sm font-medium">
              <div class="flex size-8 mx-auto items-center justify-center rounded-full bg-primary">7</div>
            </button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">8</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">9</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">10</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">11</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">12</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">13</div></button>
            <button class="h-10 w-full text-sm font-medium"><div class="flex size-full items-center justify-center rounded-full hover:bg-primary/10">14</div></button>
          </div>
        </div>
      </div>

      <!-- Select Duration -->
      <div class="bg-white">
        <h3 class="text-xl font-bold leading-tight px-4 text-left pt-4 pb-2">Select Duration</h3>
        <div class="flex gap-3 px-4 pb-4">
          <button class="flex-1 py-3 rounded-xl border-2 border-primary bg-primary/10 text-primary font-bold">30 min</button>
          <button class="flex-1 py-3 rounded-xl border-2 border-gray-100 text-gray-500 font-medium">60 min</button>
        </div>
      </div>

      <!-- Available Times -->
      <div class="bg-white px-4 pb-4">
        <h3 class="text-lg font-bold leading-tight pb-3">Available Times</h3>
        <div class="grid grid-cols-3 gap-2">
          <button class="py-2.5 rounded-lg bg-gray-100 text-sm font-medium border border-transparent hover:border-primary">09:00 AM</button>
          <button class="py-2.5 rounded-lg bg-primary text-white text-sm font-medium">09:30 AM</button>
          <button class="py-2.5 rounded-lg bg-gray-100 text-sm font-medium border border-transparent hover:border-primary">10:00 AM</button>
          <button class="py-2.5 rounded-lg bg-gray-100 text-sm font-medium border border-transparent hover:border-primary">10:30 AM</button>
          <button class="py-2.5 rounded-lg bg-gray-100 text-sm font-medium border border-transparent hover:border-primary">11:00 AM</button>
          <button class="py-2.5 rounded-lg bg-gray-100 text-sm font-medium border border-transparent hover:border-primary">11:30 AM</button>
        </div>
      </div>

      <!-- What to Expect -->
      <div class="px-4 py-6 bg-background-light mt-4">
        <h3 class="text-lg font-bold mb-4">What to Expect</h3>
        <div class="space-y-4">
          <div class="flex gap-4">
            <div class="size-10 rounded-full bg-primary/20 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-primary">pedal_bike</span>
            </div>
            <div>
              <p class="font-bold text-sm">Personalized Bike Setup</p>
              <p class="text-black/70 text-xs">Our experts will adjust the seat and handle for your comfort.</p>
            </div>
          </div>
          <div class="flex gap-4">
            <div class="size-10 rounded-full bg-primary/20 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-primary">route</span>
            </div>
            <div>
              <p class="font-bold text-sm">Guided Test Route</p>
              <p class="text-black/70 text-xs">Explore local bike paths with a recommended 2-mile circuit.</p>
            </div>
          </div>
          <div class="flex gap-4">
            <div class="size-10 rounded-full bg-primary/20 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-primary">security</span>
            </div>
            <div>
              <p class="font-bold text-sm">Safety Gear Included</p>
              <p class="text-black/70 text-xs">We provide sanitized helmets and safety vests for all demos.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Sticky Footer -->
      <div class="sticky bottom-0 mt-auto p-4 bg-white border-t border-gray-100 pb-8">
        <button onclick="showScreen('paidCheckout')" class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 active:scale-[0.98] transition-transform">
          Confirm &amp; Continue
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN 5: AGREEMENT & CONFIRMATION
       ============================================ -->
  <div id="demoAgreement" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between border-b border-gray-100 sticky top-0 z-10">
        <div onclick="showScreen('scheduleDemo')" class="text-primary flex size-12 shrink-0 items-center justify-start cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Step 3: Agreement</h2>
      </div>

      <!-- Progress -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-6 bg-white">
        <div class="h-1.5 w-12 rounded-full bg-primary/20"></div>
        <div class="h-1.5 w-12 rounded-full bg-primary/20"></div>
        <div class="h-1.5 w-12 rounded-full bg-primary"></div>
      </div>

      <!-- Hero Image -->
      <div class="px-4">
        <div class="w-full bg-center bg-no-repeat bg-cover flex flex-col justify-end overflow-hidden bg-white rounded-xl min-h-[180px] border border-gray-100 shadow-sm" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuA8AmRVQsRKd7HeYvaXTF6BcC5woWtNkjE9nikDq7BcGwBHVeTRVjtZ86wV99-AEGj4PoNRjgJWAEj0o_X9wNDkZhYPev-C_yznqV2OlErsxohCVHmisYs9uyaogsVXyhs05Mvl8zfcYBL5JfnR75KsSerckdQ1dmpUPr3CAqQtL54NQjWGUi-t8w0Scj1uOPXuZm5TYqNIF3tz8khf9sQURxcMBX0zeCZAOMnlgRKD5Hq3IkA2TLyTvqk87rtygnvCg5nyWw5vPHKY");'></div>
      </div>

      <div class="px-4">
        <!-- Store Demo Waiver -->
        <h2 class="text-[22px] font-bold leading-tight tracking-[-0.015em] pb-3 pt-6">Store Demo Waiver</h2>
        <div class="bg-white p-4 rounded-xl border border-gray-100">
          <p class="text-sm font-normal leading-relaxed text-gray-700">
            By confirming this booking, you agree to the <span class="text-primary font-semibold">Micro2Move</span> store demo terms. This includes a liability waiver, acknowledgement of risk, and adherence to safety protocols for e-bike handling. You are responsible for any damages beyond normal wear and tear during the demo period.
          </p>
        </div>

        <!-- Safety Requirements -->
        <h2 class="text-[18px] font-bold leading-tight tracking-[-0.015em] pb-3 pt-6">Safety Requirements</h2>
        <div class="space-y-3">
          <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
            <span class="material-symbols-outlined text-primary">skull</span>
            <div>
              <p class="font-semibold text-sm">Helmet Mandatory</p>
              <p class="text-xs text-gray-500">Must wear a certified helmet at all times during the test ride.</p>
            </div>
          </div>
          <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
            <span class="material-symbols-outlined text-primary">badge</span>
            <div>
              <p class="font-semibold text-sm">Valid ID Required</p>
              <p class="text-xs text-gray-500">Bring a physical government-issued ID for verification at the store.</p>
            </div>
          </div>
        </div>

        <!-- Contact Details -->
        <h2 class="text-[18px] font-bold leading-tight tracking-[-0.015em] pb-3 pt-6">Contact Details</h2>
        <div class="space-y-4">
          <div class="flex flex-col gap-1">
            <label class="text-xs font-semibold text-gray-500 uppercase px-1">Full Name</label>
            <input class="w-full p-3 rounded-lg border border-gray-200 bg-white text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all" placeholder="John Doe" type="text"/>
          </div>
          <div class="flex flex-col gap-1">
            <label class="text-xs font-semibold text-gray-500 uppercase px-1">Email Address</label>
            <input class="w-full p-3 rounded-lg border border-gray-200 bg-white text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all" placeholder="john@example.com" type="email"/>
          </div>
        </div>

        <!-- Booking Summary -->
        <div class="mt-8 mb-6 p-4 bg-primary/5 rounded-xl border border-primary/20">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-600">Demo Model</span>
            <span class="text-sm font-bold">M2M Turbo Glide X</span>
          </div>
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-600">Duration</span>
            <span class="text-sm font-bold">45 Minutes</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-600">Total Price</span>
            <span class="text-lg font-bold text-primary">FREE</span>
          </div>
        </div>

        <!-- Confirm Button -->
        <div class="pb-10">
          <button onclick="confirmDemoBooking()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/25 transition-all active:scale-[0.98] flex items-center justify-center gap-2">
            Confirm Booking
            <span class="material-symbols-outlined text-sm">arrow_forward</span>
          </button>
          <p class="text-center text-[10px] text-gray-400 mt-4 px-8">
            By clicking "Confirm Booking", you agree to receive SMS/Email reminders about your demo appointment.
          </p>
        </div>
      </div>

      <!-- Footer Logo -->
      <div class="flex justify-center pb-8 opacity-40">
        <div class="flex items-center gap-1">
          <span class="material-symbols-outlined text-primary text-xl">bolt</span>
          <span class="font-bold tracking-tight text-lg">Micro2Move</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN 6: CHECKOUT & PAYMENT (PAID DEMO)
       ============================================ -->
  <div id="paidCheckout" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('scheduleDemo')" class="flex size-12 shrink-0 items-center justify-center cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Checkout &amp; Payment</h2>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-5 bg-white">
        <div class="h-2 w-2 rounded-full bg-[#e2dbe6]"></div>
        <div class="h-2 w-2 rounded-full bg-[#e2dbe6]"></div>
        <div class="h-2 w-8 rounded-full bg-primary"></div>
      </div>

      <div class="flex-1 overflow-y-auto">
        <!-- Rental Summary -->
        <div class="p-4">
          <div class="bg-background-light rounded-2xl p-5 border border-gray-100">
            <h3 class="text-sm font-semibold uppercase tracking-wider mb-4">Rental Summary</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-black/60 text-sm">2-Week Demo Rental</span>
                <span class="font-medium">$85.00</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-black/60 text-sm">Service Fee</span>
                <span class="font-medium">$15.00</span>
              </div>
              <div class="flex justify-between items-center">
                <div class="flex items-center gap-1">
                  <span class="text-black/60 text-sm">Security Deposit</span>
                  <span class="material-symbols-outlined text-xs text-primary cursor-help">info</span>
                </div>
                <span class="font-medium">$50.00</span>
              </div>
              <p class="text-[11px] text-primary/80 font-medium italic mt-1">* Security deposit is fully refundable upon return.</p>
              <div class="pt-4 mt-1 border-t border-gray-200 flex justify-between items-center">
                <span class="text-lg font-bold">Total Due</span>
                <span class="text-primary text-2xl font-bold">$150.00</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Method -->
        <div class="px-4 py-2">
          <h3 class="text-lg font-bold mb-4">Payment Method</h3>

          <!-- Apple Pay -->
          <div class="flex items-center justify-between p-4 bg-white border border-gray-100 rounded-xl mb-4 shadow-sm">
            <div class="flex items-center gap-3">
              <div class="bg-black p-1.5 rounded h-8 w-12 flex items-center justify-center">
                <span class="text-white text-xs font-bold">Pay</span>
              </div>
              <span class="font-medium">Apple Pay</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input class="sr-only peer" type="checkbox"/>
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
            </label>
          </div>

          <!-- Card Details -->
          <div class="bg-white border border-gray-100 rounded-xl shadow-sm overflow-hidden">
            <div class="p-4 border-b border-gray-100 bg-gray-50/50">
              <span class="text-xs font-bold text-black/60 uppercase tracking-wider">Credit or Debit Card</span>
            </div>
            <div class="p-4 space-y-4">
              <div class="relative">
                <input class="w-full bg-transparent border-none focus:ring-0 p-0 placeholder:text-gray-400" placeholder="Card number" type="text"/>
                <div class="absolute right-0 top-0 flex gap-1">
                  <span class="material-symbols-outlined text-gray-400">credit_card</span>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4 pt-2 border-t border-gray-100">
                <input class="bg-transparent border-none focus:ring-0 p-0 placeholder:text-gray-400" placeholder="MM / YY" type="text"/>
                <div class="flex items-center gap-1 border-l border-gray-100 pl-4">
                  <input class="bg-transparent border-none focus:ring-0 p-0 w-full placeholder:text-gray-400" placeholder="CVC" type="text"/>
                  <span class="material-symbols-outlined text-gray-400 text-sm">lock</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Badge -->
        <div class="flex items-center justify-center gap-2 mt-6 px-4">
          <span class="material-symbols-outlined text-green-500 text-sm">verified_user</span>
          <p class="text-[12px] text-gray-500">Secure 256-bit SSL encrypted payment</p>
        </div>
      </div>

      <!-- Sticky Footer -->
      <div class="sticky bottom-0 mt-auto p-4 bg-white border-t border-gray-100 pb-8">
        <button onclick="showScreen('idVerifyScreen')" class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 active:scale-[0.98] transition-transform flex items-center justify-center gap-2">
          <span class="material-symbols-outlined text-[20px]">verified_user</span>
          Verify ID &amp; Confirm Booking
        </button>
        <p class="text-center text-[11px] text-gray-400 mt-3 px-6">
          By clicking "Pay &amp; Confirm Booking", you agree to the Rental Terms of Service.
        </p>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN: ID VERIFICATION
       Inserted between checkout and booking confirmation.
       "Continue" calls confirmDemoBooking() to proceed.
       ============================================ -->
  <div id="idVerifyScreen" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light">

      <!-- Header -->
      <div class="flex items-center justify-between px-4 py-4 bg-background-light sticky top-0 z-50 border-b border-gray-100">
        <button onclick="showScreen('paidCheckout')" class="flex size-10 items-center justify-center rounded-full hover:bg-primary/10 transition-colors">
          <span class="material-symbols-outlined">arrow_back_ios_new</span>
        </button>
        <h1 class="text-lg font-bold tracking-tight font-display">Verify Identity</h1>
        <div class="w-10"></div>
      </div>

      <div class="flex-1 overflow-y-auto px-4 pb-8">

        <!-- Required step banner -->
        <div class="bg-primary/10 border border-primary/20 rounded-xl p-4 my-5 flex items-center gap-3">
          <span class="material-symbols-outlined text-primary text-2xl">verified_user</span>
          <div>
            <p class="text-xs font-bold uppercase tracking-wider text-primary">Required Step</p>
            <p class="text-sm font-semibold text-gray-800">Government Issued ID</p>
          </div>
        </div>

        <!-- Document type selector -->
        <div class="flex p-1 bg-gray-200/50 rounded-xl mb-5">
          <button id="idv-tab-licence"
                  onclick="idvTab('licence')"
                  class="flex-1 py-2 text-sm font-bold rounded-lg bg-white shadow-sm text-primary transition-all">
            Driver's Licence
          </button>
          <button id="idv-tab-passport"
                  onclick="idvTab('passport')"
                  class="flex-1 py-2 text-sm font-medium text-[#706189] rounded-lg transition-all">
            Passport
          </button>
        </div>

        <!-- Instruction -->
        <div class="text-center mb-5">
          <h2 class="text-xl font-bold mb-1 font-display">Scan Front of ID</h2>
          <p class="text-sm text-[#706189]">Place your ID card inside the frame until the borders turn green.</p>
        </div>

        <!-- Camera viewfinder -->
        <div class="relative rounded-2xl overflow-hidden border-4 border-primary/40 bg-slate-900 shadow-xl"
             style="aspect-ratio:1.58/1; cursor:pointer;" onclick="idvScan()">

          <!-- Simulated camera background -->
          <div class="absolute inset-0 opacity-40 bg-cover bg-center"
               style="background-image:url('https://lh3.googleusercontent.com/aida-public/AB6AXuDQMZpJOUkAxv_u43rmNJJHZEKCV5H5O8AxeNolZ13DVdTxRlhBXWHq6nRxXB5eRkhIExnbFXgpxtFyVpesKVmim3gwZCCCZctfl3ig7bKm3D93_6CKO_Z-54kXx1tnPjSQS5ud-L0sEb2tpI2poBGGkzriMs91-PfsPBoqRKniS0fkSz56eJtFrZLzX4lpz3hfkXWBORvCm29qX7U7WnViaDa_dYX7o3c2G63hdH0bprNE4fjyvtpt3WJ0qBwxgfC4NPsjHHDHFLU')">
          </div>

          <!-- ID alignment guide -->
          <div class="absolute inset-0 flex items-center justify-center z-20">
            <div class="border-2 border-dashed border-white/50 rounded-lg flex flex-col items-center justify-center gap-1"
                 style="width:78%; height:62%">
              <span class="material-symbols-outlined text-white/30 text-5xl">badge</span>
              <p class="text-white/50 text-[9px] font-bold uppercase tracking-[0.2em]">Align ID Here</p>
            </div>
          </div>

          <!-- Animated scan line -->
          <div id="idv-scanline" class="absolute left-0 w-full h-0.5 z-30 transition-none"
               style="top:50%; background:#7C3AED; box-shadow:0 0 12px #7C3AED;"></div>

          <!-- Corner brackets -->
          <div class="absolute top-4 left-4 w-7 h-7 border-t-4 border-l-4 border-primary rounded-tl-lg z-30"></div>
          <div class="absolute top-4 right-4 w-7 h-7 border-t-4 border-r-4 border-primary rounded-tr-lg z-30"></div>
          <div class="absolute bottom-4 left-4 w-7 h-7 border-b-4 border-l-4 border-primary rounded-bl-lg z-30"></div>
          <div class="absolute bottom-4 right-4 w-7 h-7 border-b-4 border-r-4 border-primary rounded-br-lg z-30"></div>
        </div>

        <!-- Tips accordion -->
        <details class="mt-5 bg-white rounded-xl border border-gray-100 overflow-hidden shadow-sm" open>
          <summary class="flex items-center justify-between p-4 cursor-pointer list-none">
            <div class="flex items-center gap-2">
              <span class="material-symbols-outlined text-primary text-xl">lightbulb</span>
              <span class="text-sm font-semibold">Tips for a clear photo</span>
            </div>
            <span class="material-symbols-outlined text-gray-400 transition-transform open:rotate-180">expand_more</span>
          </summary>
          <div class="px-4 pb-4 grid grid-cols-2 gap-3">
            <div class="flex items-center gap-2 text-xs text-[#706189]">
              <span class="material-symbols-outlined text-acc-green text-base">check_circle</span>Avoid glare
            </div>
            <div class="flex items-center gap-2 text-xs text-[#706189]">
              <span class="material-symbols-outlined text-acc-green text-base">check_circle</span>Plain background
            </div>
            <div class="flex items-center gap-2 text-xs text-[#706189]">
              <span class="material-symbols-outlined text-acc-green text-base">check_circle</span>Good lighting
            </div>
            <div class="flex items-center gap-2 text-xs text-[#706189]">
              <span class="material-symbols-outlined text-acc-green text-base">check_circle</span>Not blurry
            </div>
          </div>
        </details>

      </div><!-- /scroll -->

      <!-- Footer CTA -->
      <div class="p-4 bg-background-light/90 backdrop-blur-md border-t border-gray-100 pb-8">
        <!-- Detection status -->
        <div class="flex items-center justify-center gap-2 mb-3" id="idv-status">
          <div class="w-2 h-2 bg-primary rounded-full animate-pulse"></div>
          <p class="text-[10px] font-bold uppercase tracking-widest text-[#706189]" id="idv-status-text">Tap viewfinder to scan</p>
        </div>
        <button id="idv-continue-btn"
                onclick="confirmDemoBooking()"
                class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 active:scale-[0.98] transition-transform flex items-center justify-center gap-2">
          <span class="material-symbols-outlined text-lg">arrow_forward</span>
          Continue
        </button>
        <button onclick="confirmDemoBooking()"
                class="w-full text-[#706189] font-medium text-sm py-3 mt-1">
          Enter details manually
        </button>
      </div>

    </div>
  </div>

  <script>
    /* ── ID verify scan simulation ──────────────────────────────────────── */
    var idvScanned = false;
    function idvScan() {
      if (idvScanned) return;
      idvScanned = true;
      // Animate scan line top → bottom
      var line = document.getElementById('idv-scanline');
      line.style.transition = 'top 1.5s linear';
      line.style.top = '90%';
      setTimeout(function() {
        // Flash corners green
        document.querySelectorAll('#idVerifyScreen .border-primary').forEach(function(el){
          el.classList.replace('border-primary','border-acc-green');
        });
        // Update status
        document.getElementById('idv-status-text').textContent = 'Document Recognised ✓';
        document.querySelector('#idv-status .w-2').classList.replace('bg-primary','bg-acc-green');
        document.querySelector('#idv-status .w-2').classList.remove('animate-pulse');
      }, 1600);
    }
    function idvTab(tab) {
      var tabs = ['licence','passport'];
      tabs.forEach(function(t) {
        var el = document.getElementById('idv-tab-'+t);
        if (t === tab) {
          el.className = 'flex-1 py-2 text-sm font-bold rounded-lg bg-white shadow-sm text-primary transition-all';
        } else {
          el.className = 'flex-1 py-2 text-sm font-medium text-[#706189] rounded-lg transition-all';
        }
      });
      // Reset scan state when switching doc type
      idvScanned = false;
      var line = document.getElementById('idv-scanline');
      line.style.transition = 'none';
      line.style.top = '50%';
      document.getElementById('idv-status-text').textContent = 'Tap viewfinder to scan';
    }
  </script>

  <!-- ============================================
       SCREEN 7: EDUCATION HUB
       ============================================ -->
  <div id="educationHub" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between sticky top-0 z-10">
        <div onclick="showScreen('demoSelection')" class="flex size-12 shrink-0 items-center justify-start cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12 font-display">Education Hub</h2>
      </div>

      <div class="h-2"></div>

      <!-- Profile Header -->
      <div class="flex p-4">
        <div class="flex w-full flex-col gap-4 items-center">
          <div class="flex gap-4 flex-col items-center">
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-[128px] w-32 border-4 border-primary/20 shadow-lg" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAsYpgvw-66jsFTr7e5WF9kEtwgGJc_Vs2RDhJH3l5RKc-R2MoyVXsap09ooBx6pJdh9XaGIOE2iqRtvItwTV7n2F0Yas21-nIcTqG75bOD4yqurKfEoqW2cMDZSFgsxAmYBv0MdJi5thLj015d0KkJ9ULLtbEc3JHG-LyOtEajM0d8KT2_INYQgZo5HTaxRgqycZTYq86bcnWcRCzKrcGxLgramiRpV5aE5SDZ8qPcaLDw5S33EXTor-LszGNPmJbKbk8Xg2wVsSuR");'></div>
            <div class="flex flex-col items-center justify-center">
              <p class="text-[22px] font-bold leading-tight tracking-[-0.015em] text-center font-display">Alex Rivera</p>
              <p class="text-primary font-semibold text-base leading-normal text-center">Safe Commuter</p>
              <p onclick="showScreen('rewardsCredits')" class="text-[#706189] text-sm font-normal leading-normal text-center cursor-pointer hover:text-primary transition-colors underline underline-offset-2">1,250 Points Earned &bull; $45 Credits</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Level Progress -->
      <div class="flex flex-col gap-3 p-4 mx-4 mb-4 rounded-xl bg-primary/5 border border-primary/10">
        <div class="flex gap-6 justify-between items-center">
          <p class="text-base font-medium leading-normal">Level Progress</p>
          <p class="text-primary text-sm font-bold leading-normal">650/1000 pts</p>
        </div>
        <div class="rounded-full bg-gray-200 h-2.5 overflow-hidden">
          <div class="h-full rounded-full bg-primary" style="width: 65%;"></div>
        </div>
        <p class="text-[#706189] text-xs font-normal leading-normal">Earn 350 more points to reach 'Expert Navigator'</p>
      </div>

      <!-- Learning Paths Header -->
      <div class="px-4">
        <h3 class="text-xl font-bold leading-tight tracking-[-0.015em] pt-4">Learning Paths</h3>
        <p class="text-[#706189] text-sm mb-2">Enhance your skills and unlock rewards</p>
      </div>

      <!-- Learning Path Cards -->
      <div class="flex flex-col gap-1 pb-8">
        <!-- Card 1: Online Essentials -->
        <div class="p-4">
          <div class="flex items-stretch justify-between gap-4 rounded-xl bg-white p-4 shadow-sm border border-gray-100">
            <div class="flex flex-[2_2_0px] flex-col gap-4">
              <div class="flex flex-col gap-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-xs font-bold text-green-500 uppercase tracking-wider">75% Complete</span>
                  <div class="h-1 w-12 bg-gray-200 rounded-full"><div class="h-1 bg-green-500 rounded-full" style="width: 75%"></div></div>
                </div>
                <p class="text-lg font-bold leading-tight font-display">Online Essentials</p>
                <p class="text-[#706189] text-sm font-normal leading-snug">Master the basics of urban transit with quick quizzes.</p>
              </div>
              <button onclick="showScreen('safetyTrainingScreen')" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 flex-row-reverse bg-primary text-white gap-2 text-sm font-bold leading-normal w-fit active:scale-95 shadow-md">
                <span class="material-symbols-outlined text-[20px]">play_arrow</span>
                <span class="truncate">Continue</span>
              </button>
            </div>
            <div class="w-32 bg-center bg-no-repeat aspect-square bg-cover rounded-xl shrink-0" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuA7ItPzS6kUb8fra6EAr0nxXyM75Dz8g7clYQgrePSP9zXIziecxxeKMoHHRlWwGnL6whXdv7F_1_H2TfDDp2Tzke_2yVAOSNC-FOvOyTpq8Wo94-UHw8vXqIXBmWztzfyX0dynX4S_pWhKX2DJeZxCDOrVW0HV29cXcGfDDLlhOEbZwLUsNzV5aotCkXgbWXNzAQwoU_QaKQv37HOP5PcS4vJfJZ3Y4pWmMDH-byn1fOh6M8cNNBjbdSlXt6XyLUdJwwrh_VgsBEjX");'></div>
          </div>
        </div>

        <!-- Card 2: In-Person Workshops -->
        <div class="p-4">
          <div class="flex items-stretch justify-between gap-4 rounded-xl bg-white p-4 shadow-sm border border-gray-100">
            <div class="flex flex-[2_2_0px] flex-col gap-4">
              <div class="flex flex-col gap-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-xs font-bold text-primary uppercase tracking-wider">20% Complete</span>
                  <div class="h-1 w-12 bg-gray-200 rounded-full"><div class="h-1 bg-primary rounded-full" style="width: 20%"></div></div>
                </div>
                <p class="text-lg font-bold leading-tight font-display">In-Person Workshops</p>
                <p class="text-[#706189] text-sm font-normal leading-snug">Hands-on safety training with certified instructors.</p>
              </div>
              <button onclick="showScreen('communityEventsScreen')" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 flex-row-reverse bg-primary text-white gap-2 text-sm font-bold leading-normal w-fit active:scale-95 shadow-md">
                <span class="material-symbols-outlined text-[20px]">calendar_today</span>
                <span class="truncate">Book Spot</span>
              </button>
            </div>
            <div class="w-32 bg-center bg-no-repeat aspect-square bg-cover rounded-xl shrink-0" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDVo-I8ih7rlTZZ-ndjEf9rgumZdk7KVDlR4HgAgcgOvp1QlAIS2aY64NM5xwDO5yYX75N_TMShu39OLh5lyjGQjOUxD39Ius61WQ16ot4iB6zsE3JmfsszDyjfl23wAOXY05V1WmGhkB_MzE-vniCqLQmxJ3zu7Z98FLmnopeGA-XfEzNGsaHXXB6bMJrjrNohRR252R5663AAWOaqpOn9ItVcrJo9vA_EcAubRwuGkys3Oa_TABNqRUQHL3rhl5FGOMFJeiHTx56W");'></div>
          </div>
        </div>

        <!-- Card 3: Community Mentor -->
        <div class="p-4">
          <div class="flex items-stretch justify-between gap-4 rounded-xl bg-white p-4 shadow-sm border border-gray-100">
            <div class="flex flex-[2_2_0px] flex-col gap-4">
              <div class="flex flex-col gap-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Not Started</span>
                  <div class="h-1 w-12 bg-gray-200 rounded-full"></div>
                </div>
                <p class="text-lg font-bold leading-tight font-display">Community Mentor</p>
                <p class="text-[#706189] text-sm font-normal leading-snug">Support new riders by joining group commuter trips.</p>
              </div>
              <button onclick="showScreen('rideSupportTraining')" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 flex-row-reverse bg-primary text-white gap-2 text-sm font-bold leading-normal w-fit active:scale-95 shadow-md">
                <span class="material-symbols-outlined text-[20px]">group</span>
                <span class="truncate">Learn More</span>
              </button>
            </div>
            <div class="w-32 bg-center bg-no-repeat aspect-square bg-cover rounded-xl shrink-0" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC_teftH1A-YR5KqPt_38JShaNwKMNmwcql9GLFjW1UYaGvjQLDVwqrPaXqC4govZDOeffBnRA1AZrjYjSP-etjxcNK0pZH3X6zIShYmtimj8v-3t5Pf3BKYEJVLjCVmxmW7VIXfBhrwZt5yv8J-HqJwHOLbL_6QyDu_KyiotmTUtOqHd-I1NQzphs3NPqzCe8Qo7SkL1g2nfPxJ6ZdEHb7HDcHrZGH1R2vk-X4LgpcHuhQYpf75iKtlH286J4GMHR6PBavfdFWMWr1");'></div>
          </div>
        </div>
      </div>

      <!-- Bottom Nav -->
      <div class="mt-auto border-t border-gray-100 bg-white px-8 py-4 flex justify-between items-center">
        <div onclick="showScreen('demoSelection')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined">home</span>
          <span class="text-[10px] mt-1">Home</span>
        </div>
        <div class="flex flex-col items-center text-primary">
          <span class="material-symbols-outlined">school</span>
          <span class="text-[10px] mt-1 font-bold">Learn</span>
        </div>
        <div onclick="showScreen('rewardsCredits')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined">redeem</span>
          <span class="text-[10px] mt-1">Rewards</span>
        </div>
        <div class="flex flex-col items-center text-gray-400">
          <span class="material-symbols-outlined">person</span>
          <span class="text-[10px] mt-1">Profile</span>
        </div>
      </div>
      <div class="h-8 bg-white flex justify-center items-end pb-2">
        <div class="w-32 h-1 bg-gray-300 rounded-full"></div>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN: SAFETY TRAINING HUB
       Module list — 3 states: passed / cooldown / not started
       Credits from quiz_spec.json: 150 / 200 / 200
       AUD rate: 0.10  (100 credits = $10.00)
       ============================================ -->
  <div id="safetyTrainingScreen" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light overflow-y-auto pb-24">

      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-3 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('educationHub')" class="flex size-12 shrink-0 items-center justify-start cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12 font-display">Safety Training</h2>
      </div>

      <!-- Credit balance widget -->
      <div class="mx-4 mt-4 rounded-2xl p-5 relative overflow-hidden" style="background: linear-gradient(135deg, rgba(124,58,237,0.12) 0%, rgba(34,197,94,0.08) 100%); border: 1px solid rgba(124,58,237,0.15);">
        <p class="text-xs font-bold text-[#706189] uppercase tracking-widest mb-1">Total Balance</p>
        <div class="flex items-baseline gap-2">
          <span class="text-4xl font-extrabold text-gray-900" id="st-credit-balance">150</span>
          <span class="text-lg font-bold text-primary">credits</span>
        </div>
        <div class="mt-3 inline-flex items-center gap-2 bg-white/70 backdrop-blur rounded-lg px-3 py-1.5 border border-white/50">
          <span class="material-symbols-outlined text-acc-green text-base">payments</span>
          <span class="text-sm font-bold text-gray-700" id="st-aud-value">$15.00 off your next ride</span>
        </div>
        <p class="mt-2 text-xs text-[#706189]">Complete all 3 modules to earn up to <strong class="text-gray-700">550 credits ($55.00)</strong></p>
        <!-- decorative -->
        <div class="absolute -right-6 -bottom-6 w-28 h-28 rounded-full opacity-20" style="background:radial-gradient(circle, #7C3AED, transparent)"></div>
      </div>

      <!-- Module list header -->
      <div class="flex items-center justify-between px-4 mt-6 mb-3">
        <h3 class="text-base font-bold font-display">Training Modules</h3>
        <span class="text-xs font-semibold text-[#706189]">1 / 3 Completed</span>
      </div>

      <div class="flex flex-col gap-3 px-4">

        <!-- ── Card ①: PASSED — Safety Basics (150 credits) ── -->
        <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex flex-col gap-3">
          <div class="flex justify-between items-start gap-3">
            <div class="flex-1 flex flex-col gap-1">
              <span class="self-start px-2 py-0.5 rounded-full bg-acc-green/10 text-acc-green text-[10px] font-bold uppercase tracking-widest border border-acc-green/20 flex items-center gap-1 w-fit">
                <span class="material-symbols-outlined text-xs">check_circle</span> Passed
              </span>
              <p class="text-base font-bold leading-tight font-display mt-1">Safety Basics</p>
              <p class="text-xs text-[#706189] leading-snug">Core riding skills for safe, predictable e-bike use in urban environments.</p>
            </div>
            <div class="w-16 h-16 rounded-xl bg-acc-green/10 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-acc-green text-3xl">directions_bike</span>
            </div>
          </div>
          <div class="flex items-center justify-between border-t border-gray-50 pt-3">
            <div class="flex gap-4">
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-gray-400 text-base">quiz</span>
                <span class="text-xs text-[#706189]">10 questions</span>
              </div>
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-acc-green text-base">monetization_on</span>
                <span class="text-xs font-bold text-gray-700">+150 earned</span>
              </div>
            </div>
            <button onclick="showScreen('quizDetailScreen')" class="px-4 py-1.5 rounded-lg bg-gray-100 text-gray-500 text-xs font-bold">Review</button>
          </div>
        </div>

        <!-- ── Card ②: COOLDOWN — NSW Rules & Infrastructure ── -->
        <div class="bg-white rounded-2xl p-4 shadow-sm flex flex-col gap-3 relative overflow-hidden" style="border: 1px solid #fed7aa;">
          <div class="absolute inset-0 rounded-2xl pointer-events-none" style="background:rgba(255,237,213,0.35)"></div>
          <div class="relative flex justify-between items-start gap-3">
            <div class="flex-1 flex flex-col gap-1">
              <span class="self-start px-2 py-0.5 rounded-full bg-orange-100 text-orange-600 text-[10px] font-bold uppercase tracking-widest border border-orange-200 flex items-center gap-1 w-fit">
                <span class="material-symbols-outlined text-xs">timer</span> Cooldown
              </span>
              <p class="text-base font-bold leading-tight font-display mt-1">NSW Rules &amp; Infrastructure</p>
              <p class="text-xs text-[#706189] leading-snug">Local NSW rules for where and how you can ride an e-bike legally.</p>
              <div class="flex items-center gap-1 mt-1">
                <span class="material-symbols-outlined text-orange-400 text-sm">cancel</span>
                <span class="text-xs font-semibold text-orange-600">Last attempt: 8/10 — need 10/10</span>
              </div>
            </div>
            <!-- Countdown ring -->
            <div class="w-16 h-16 relative shrink-0 flex items-center justify-center">
              <svg class="absolute inset-0 w-16 h-16" viewBox="0 0 64 64" style="transform:rotate(-90deg)">
                <circle cx="32" cy="32" r="27" fill="none" stroke="#fed7aa" stroke-width="4"/>
                <circle cx="32" cy="32" r="27" fill="none" stroke="#f97316" stroke-width="4"
                        stroke-linecap="round" stroke-dasharray="169.6"
                        stroke-dashoffset="51" id="st-ring"/>
              </svg>
              <div class="text-center relative">
                <span class="text-sm font-bold text-orange-500" id="st-timer">1:32</span>
                <p class="text-[8px] text-gray-400 leading-tight">retry in</p>
              </div>
            </div>
          </div>
          <div class="relative flex items-center justify-between border-t pt-3" style="border-color:rgba(253,186,116,0.4)">
            <div class="flex gap-4">
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-gray-400 text-base">quiz</span>
                <span class="text-xs text-[#706189]">10 questions</span>
              </div>
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-acc-green text-base">monetization_on</span>
                <span class="text-xs font-bold text-gray-700">+200</span>
              </div>
            </div>
            <button disabled class="px-4 py-1.5 rounded-lg bg-gray-100 text-gray-400 text-xs font-bold cursor-not-allowed flex items-center gap-1 opacity-60">
              <span class="material-symbols-outlined text-xs">lock_clock</span>
              <span id="st-btn-timer">Retry in 1:32</span>
            </button>
          </div>
        </div>

        <!-- ── Card ③: NOT STARTED — E-Bike Tech & Safe Ownership ── -->
        <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex flex-col gap-3">
          <div class="flex justify-between items-start gap-3">
            <div class="flex-1 flex flex-col gap-1">
              <span class="self-start px-2 py-0.5 rounded-full bg-primary/10 text-primary text-[10px] font-bold uppercase tracking-widest border border-primary/20 w-fit">Not Started</span>
              <p class="text-base font-bold leading-tight font-display mt-1">E-Bike Tech &amp; Safe Ownership</p>
              <p class="text-xs text-[#706189] leading-snug">How e-bike systems and batteries work, plus safe charging to reduce fire risk.</p>
            </div>
            <div class="w-16 h-16 rounded-xl bg-primary/10 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-primary text-3xl">bolt</span>
            </div>
          </div>
          <div class="flex items-center justify-between border-t border-gray-50 pt-3">
            <div class="flex gap-4">
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-gray-400 text-base">quiz</span>
                <span class="text-xs text-[#706189]">10 questions</span>
              </div>
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-acc-green text-base">monetization_on</span>
                <span class="text-xs font-bold text-gray-700">+200</span>
              </div>
            </div>
            <button onclick="showScreen('quizDetailScreen')" class="px-4 py-1.5 rounded-lg bg-primary text-white text-xs font-bold shadow-sm shadow-primary/30 active:scale-95 transition-transform">
              Start Quiz
            </button>
          </div>
        </div>

        <!-- How credits work info box -->
        <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mt-1">
          <h4 class="text-xs font-bold uppercase tracking-widest text-[#706189] mb-3 flex items-center gap-2">
            <span class="material-symbols-outlined text-primary text-base">info</span> How credits work
          </h4>
          <ul class="space-y-2 text-xs text-[#706189]">
            <li class="flex items-start gap-2">
              <span class="material-symbols-outlined text-acc-green text-sm mt-0.5">check_circle</span>
              <span>Score <strong class="text-gray-800">100%</strong> on every question to pass — no partial credit.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="material-symbols-outlined text-orange-400 text-sm mt-0.5">timer</span>
              <span>A <strong class="text-gray-800">5-minute cooldown</strong> applies after each failed attempt.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="material-symbols-outlined text-primary text-sm mt-0.5">monetization_on</span>
              <span>Credits awarded <strong class="text-gray-800">once per module</strong> on your first pass only.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="material-symbols-outlined text-acc-green text-sm mt-0.5">payments</span>
              <span><strong class="text-gray-800">100 credits = $10.00</strong> off your next Micro2Move ride.</span>
            </li>
          </ul>
        </div>

        <!-- Earn in person — shortcut to community events -->
        <div onclick="showScreen('communityEventsScreen')"
             class="rounded-2xl overflow-hidden shadow-sm border border-gray-100 cursor-pointer active:scale-[0.98] transition-transform relative"
             style="background: linear-gradient(135deg, #7C3AED 0%, #4f1fbf 100%);">
          <div class="p-4 flex items-center gap-4">
            <div class="size-14 rounded-xl bg-white/15 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-white text-3xl">groups</span>
            </div>
            <div class="flex-1">
              <p class="text-[10px] font-bold text-white/60 uppercase tracking-widest mb-0.5">Also earn credits</p>
              <h4 class="text-base font-bold text-white leading-tight font-display">Community Events &amp; Workshops</h4>
              <p class="text-xs text-white/70 mt-0.5">Group rides &amp; in-person sessions near Sydney</p>
            </div>
            <span class="material-symbols-outlined text-white/60 text-xl">chevron_right</span>
          </div>
          <!-- upcoming badge -->
          <div class="absolute top-3 right-10 bg-acc-green text-white text-[9px] font-black px-2 py-0.5 rounded-full">3 upcoming</div>
        </div>

      </div><!-- /module list -->
    </div><!-- /inner -->

    <!-- Bottom Nav -->
    <div class="fixed bottom-0 left-0 right-0 mx-auto max-w-[430px] border-t border-gray-100 bg-white/95 backdrop-blur-lg px-8 pt-3 pb-8 flex justify-between items-center z-50" style="box-shadow: 0 -2px 10px rgba(0,0,0,0.05);">
      <div onclick="showScreen('demoSelection')" class="flex flex-col items-center text-gray-400 cursor-pointer">
        <span class="material-symbols-outlined">home</span>
        <span class="text-[10px] mt-1">Home</span>
      </div>
      <div onclick="showScreen('educationHub')" class="flex flex-col items-center text-gray-400 cursor-pointer">
        <span class="material-symbols-outlined">school</span>
        <span class="text-[10px] mt-1">Learn</span>
      </div>
      <div class="flex flex-col items-center text-primary">
        <span class="material-symbols-outlined">security</span>
        <span class="text-[10px] mt-1 font-bold">Safety</span>
      </div>
      <div onclick="showScreen('rewardsCredits')" class="flex flex-col items-center text-gray-400 cursor-pointer">
        <span class="material-symbols-outlined">redeem</span>
        <span class="text-[10px] mt-1">Rewards</span>
      </div>
    </div>
  </div>

  <!-- Cooldown countdown script for safetyTrainingScreen -->
  <script>
    (function() {
      var TOTAL = 300, remaining = 92;
      var CIRC  = 169.6;
      var timerEl = document.getElementById('st-timer');
      var btnEl   = document.getElementById('st-btn-timer');
      var ringEl  = document.getElementById('st-ring');
      function tick() {
        if (remaining <= 0) { clearInterval(iv); return; }
        var m = Math.floor(remaining / 60), s = remaining % 60;
        var label = m + ':' + (s < 10 ? '0' : '') + s;
        if (timerEl) timerEl.textContent = label;
        if (btnEl)   btnEl.textContent   = 'Retry in ' + label;
        var elapsed = TOTAL - remaining;
        var offset  = CIRC * (1 - elapsed / TOTAL);
        if (ringEl) ringEl.setAttribute('stroke-dashoffset', offset.toFixed(1));
        remaining--;
      }
      tick();
      var iv = setInterval(tick, 1000);
    })();
  </script>

  <!-- ============================================
       SCREEN: QUIZ DETAIL (pre-start, per-module)
       Shown when user taps "Start Quiz" on a module card.
       Data here is seeded for NSW Rules & Infrastructure.
       ============================================ -->
  <div id="quizDetailScreen" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light overflow-y-auto pb-36">

      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-3 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('safetyTrainingScreen')" class="flex size-12 shrink-0 items-center justify-start cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-base font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12 font-display">NSW Rules &amp; Infrastructure</h2>
      </div>

      <!-- Hero banner -->
      <div class="mx-4 mt-4 rounded-2xl overflow-hidden relative" style="aspect-ratio:4/3; background: linear-gradient(135deg, rgba(124,58,237,0.15), rgba(124,58,237,0.05));">
        <div class="w-full h-full flex flex-col items-center justify-center gap-2">
          <span class="material-symbols-outlined text-primary opacity-20" style="font-size:96px">traffic</span>
          <p class="text-xs text-primary/40 font-bold tracking-widest uppercase">Sydney road illustration</p>
        </div>
        <div class="absolute bottom-3 left-3">
          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-white/90 text-primary text-xs font-bold uppercase tracking-wider shadow-sm">
            <span class="material-symbols-outlined text-sm">verified</span> NSW Road Rules compliant
          </span>
        </div>
      </div>

      <!-- Stats row -->
      <div class="px-4 mt-5">
        <h1 class="text-2xl font-extrabold leading-tight font-display mb-1">NSW Rules &amp; Infrastructure</h1>
        <p class="text-sm text-[#706189] mb-4 leading-snug">Local rules for where and how you can legally ride an e-bike.</p>
        <div class="flex gap-3">
          <div class="flex-1 flex flex-col items-center py-3 rounded-xl border border-gray-100 bg-white shadow-sm">
            <span class="material-symbols-outlined text-primary text-xl mb-1">quiz</span>
            <span class="text-[10px] text-[#706189] font-medium">Questions</span>
            <span class="text-lg font-bold">10</span>
          </div>
          <div class="flex-1 flex flex-col items-center py-3 rounded-xl border border-gray-100 bg-white shadow-sm">
            <span class="material-symbols-outlined text-primary text-xl mb-1">workspace_premium</span>
            <span class="text-[10px] text-[#706189] font-medium">Required</span>
            <span class="text-lg font-bold">100%</span>
          </div>
          <div class="flex-1 flex flex-col items-center py-3 rounded-xl border border-gray-100 bg-white shadow-sm">
            <span class="material-symbols-outlined text-primary text-xl mb-1">timer</span>
            <span class="text-[10px] text-[#706189] font-medium">Est. time</span>
            <span class="text-lg font-bold">~5 min</span>
          </div>
        </div>
      </div>

      <!-- Reward card -->
      <div class="mx-4 mt-4 bg-white rounded-2xl p-5 shadow-sm border border-gray-100 relative overflow-hidden">
        <div class="absolute top-0 right-0 p-2 pointer-events-none select-none">
          <span class="material-symbols-outlined opacity-10 text-6xl text-primary rotate-12">redeem</span>
        </div>
        <div class="relative">
          <div class="flex items-center gap-2 mb-2">
            <div class="size-8 rounded-full bg-primary flex items-center justify-center">
              <span class="material-symbols-outlined text-white text-base">star</span>
            </div>
            <!-- credits_on_pass = 200; 200 × 0.10 = $20.00 -->
            <h3 class="text-base font-bold">Earn 200 credits <span class="text-[#706189] font-normal text-sm">= $20.00</span></h3>
          </div>
          <p class="text-sm text-[#706189] leading-relaxed mb-3 max-w-[90%]">
            Score <span class="font-bold text-primary">100%</span> to unlock your Micro2Move credits.
            Credits are awarded on your <strong>first pass only</strong>.
          </p>
          <div class="flex items-start gap-2 p-2.5 rounded-lg bg-orange-50 border border-orange-100">
            <span class="material-symbols-outlined text-orange-400 text-base mt-0.5">timer</span>
            <p class="text-xs font-medium text-orange-700">5-minute cooldown applies after any failed attempt.</p>
          </div>
        </div>
      </div>

      <!-- Quiz coverage -->
      <div class="mx-4 mt-5">
        <h4 class="text-xs font-bold uppercase tracking-widest text-[#706189] mb-3">What this quiz covers</h4>
        <ul class="space-y-3">
          <li class="flex items-start gap-3">
            <span class="material-symbols-outlined text-acc-green text-base mt-0.5">check_circle</span>
            <p class="text-sm text-gray-700">Where adults can and <strong>cannot</strong> ride — roads, shared paths, and the footpath ban</p>
          </li>
          <li class="flex items-start gap-3">
            <span class="material-symbols-outlined text-acc-green text-base mt-0.5">check_circle</span>
            <p class="text-sm text-gray-700">Legal e-bike definition — 250 W, 25 km/h assist cut-off, no registration needed</p>
          </li>
          <li class="flex items-start gap-3">
            <span class="material-symbols-outlined text-acc-green text-base mt-0.5">check_circle</span>
            <p class="text-sm text-gray-700">Helmet laws, traffic signals, and red light obligations</p>
          </li>
          <li class="flex items-start gap-3">
            <span class="material-symbols-outlined text-acc-green text-base mt-0.5">check_circle</span>
            <p class="text-sm text-gray-700">Riding two abreast, hand-held phone ban, and giving way at bus stops</p>
          </li>
          <li class="flex items-start gap-3">
            <span class="material-symbols-outlined text-acc-green text-base mt-0.5">check_circle</span>
            <p class="text-sm text-gray-700">What to do when a bike lane is blocked by a vehicle</p>
          </li>
        </ul>
      </div>

    </div><!-- /inner -->

    <!-- Fixed Start Quiz CTA — routes to video lesson first -->
    <div class="fixed bottom-0 left-0 right-0 mx-auto max-w-[430px] p-4 bg-white/90 backdrop-blur-lg border-t border-gray-100 z-50">
      <button onclick="showScreen('videoLessonScreen')"
              class="w-full h-14 bg-primary text-white rounded-xl font-bold text-base shadow-lg shadow-primary/30 flex items-center justify-center gap-2 active:scale-[0.98] transition-transform">
        <span class="material-symbols-outlined">play_circle</span>
        Watch Lesson First
      </button>
      <p class="text-center text-[10px] text-[#706189] mt-2 uppercase tracking-tighter">Watch the video, then unlock the quiz</p>
    </div>
  </div>

  <!-- ============================================
       SCREEN: VIDEO LESSON
       Gated before the quiz. Quiz CTA unlocks once
       the user taps play (demo: after 8 s).
       To embed your real video, set data-src on
       the iframe to a YouTube embed URL, e.g.:
       https://www.youtube.com/embed/VIDEO_ID?autoplay=1
       ============================================ -->
  <div id="videoLessonScreen" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light overflow-y-auto pb-44">

      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-3 justify-between sticky top-0 z-10 border-b border-gray-100">
        <div onclick="showScreen('quizDetailScreen')" class="flex size-12 shrink-0 items-center justify-start cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-base font-bold flex-1 text-center pr-12 font-display">NSW Traffic Rules</h2>
        <button class="flex size-10 items-center justify-center rounded-full hover:bg-primary/10 transition-colors">
          <span class="material-symbols-outlined text-[#706189]">info</span>
        </button>
      </div>

      <!-- Video Player -->
      <div class="p-4">
        <div id="vl-player" class="relative rounded-2xl overflow-hidden shadow-2xl border border-primary/10 cursor-pointer group"
             style="aspect-ratio:16/9; background:#0f1623;" onclick="vlPlay()">

          <!-- Thumbnail shown before play -->
          <div id="vl-thumb" class="absolute inset-0 bg-cover bg-center transition-opacity duration-500"
               style="background-image:url('https://lh3.googleusercontent.com/aida-public/AB6AXuCu-BQg2Tp1XeFBZ2Gs3MFlMXQTJbu4YtarOOxas-orLX1mvxvmR_VHqtWUkOWsGS3bifuo93pGhBw1h-u5Z7fwAyUCLNMDDfxomyS6Glh6OB2Ov63C-PhKXJo2V0N2w1RrNngVTqNBr-AsaiKSzzdyhc6Nf2OI1PQlnOAr0ZNuRJ2BMFmBTw-gXIYY6Edb6zkTmnklsUyxyrODO3LhuIiUCRLzQ6ubC67um1eqFQtiyGItlAedpagQzDWUHu5DyzljNzzKpYW6_ds'); opacity:.65;">
          </div>

          <!-- ── REAL VIDEO: set data-src to your embed URL ── -->
          <iframe id="vl-iframe" class="absolute inset-0 w-full h-full hidden"
                  src="" data-src=""
                  allow="autoplay; fullscreen" allowfullscreen frameborder="0"></iframe>

          <!-- Play button -->
          <div id="vl-play-btn" class="absolute inset-0 flex items-center justify-center">
            <div class="size-20 rounded-full bg-primary flex items-center justify-center shadow-[0_0_30px_rgba(124,58,237,0.5)] group-hover:scale-110 transition-transform">
              <span class="material-symbols-outlined text-white text-5xl" style="padding-left:4px">play_arrow</span>
            </div>
          </div>

          <!-- Progress bar (visible while playing) -->
          <div id="vl-controls" class="absolute bottom-0 inset-x-0 p-4 hidden"
               style="background:linear-gradient(to top,rgba(0,0,0,0.8),transparent)">
            <div class="h-1.5 w-full bg-white/30 rounded-full overflow-hidden">
              <div id="vl-bar" class="h-full bg-primary rounded-full relative transition-all duration-1000" style="width:0%">
                <div class="absolute right-0 top-1/2 -translate-y-1/2 size-3 bg-white rounded-full border-2 border-primary shadow"></div>
              </div>
            </div>
            <div class="flex justify-between text-[10px] font-medium text-white/80 mt-1">
              <span id="vl-elapsed">0:00</span><span>12:45</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Module label -->
      <div class="px-6 pb-3">
        <div class="flex items-center gap-2 mb-1">
          <span class="material-symbols-outlined text-primary text-sm">visibility</span>
          <span class="text-xs font-bold text-primary uppercase tracking-widest" id="vl-status-label">Watch to unlock quiz</span>
        </div>
        <h2 class="text-xl font-bold leading-tight font-display">Module 1: E-Bike Foundations</h2>
        <p class="text-sm text-[#706189] mt-1 leading-relaxed">Learn essential NSW regulations for micro-mobility — where you can ride, helmet laws, traffic signals, and sharing the road legally.</p>
      </div>

      <!-- Key Learning Points checklist -->
      <div class="mx-4 mt-2 bg-primary/5 border border-primary/10 rounded-2xl p-5">
        <h3 class="text-xs font-bold uppercase tracking-widest text-primary mb-4 flex items-center gap-2">
          <span class="material-symbols-outlined text-base">checklist</span>Key Learning Points
        </h3>
        <div class="space-y-4">

          <!-- Point 1: pre-checked -->
          <div class="flex items-start gap-3">
            <div class="mt-0.5 size-5 rounded border-2 border-primary bg-primary/10 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-primary text-xs">check</span>
            </div>
            <div>
              <p class="text-sm font-semibold text-gray-800">Where you can and cannot ride</p>
              <p class="text-xs text-[#706189] mt-0.5">Roads, shared paths, bike lanes — footpath ban for adults.</p>
            </div>
          </div>

          <!-- Points 2–4: unlock progressively -->
          <div class="flex items-start gap-3">
            <div class="mt-0.5 size-5 rounded border-2 border-gray-200 bg-white flex items-center justify-center shrink-0 transition-all duration-500" id="vl-check-2"></div>
            <div>
              <p class="text-sm font-semibold text-gray-800">Legal e-bike definition</p>
              <p class="text-xs text-[#706189] mt-0.5">250 W motor, 25 km/h assist cut-off — no registration needed.</p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="mt-0.5 size-5 rounded border-2 border-gray-200 bg-white flex items-center justify-center shrink-0 transition-all duration-500" id="vl-check-3"></div>
            <div>
              <p class="text-sm font-semibold text-gray-800">Helmet law &amp; traffic signals</p>
              <p class="text-xs text-[#706189] mt-0.5">All riders must wear an approved helmet. Red lights apply to cyclists.</p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="mt-0.5 size-5 rounded border-2 border-gray-200 bg-white flex items-center justify-center shrink-0 transition-all duration-500" id="vl-check-4"></div>
            <div>
              <p class="text-sm font-semibold text-gray-800">Phone ban &amp; bus stop rules</p>
              <p class="text-xs text-[#706189] mt-0.5">No hand-held phones while riding; give way at stopped buses.</p>
            </div>
          </div>

        </div>
      </div>

    </div><!-- /inner scroll -->

    <!-- Fixed bottom CTA -->
    <div class="fixed bottom-0 left-0 right-0 mx-auto max-w-[430px] pt-4 pb-8 px-4 border-t border-gray-100 z-50 bg-background-light/95 backdrop-blur-lg">
      <div class="flex items-center justify-center gap-2 mb-3">
        <span class="material-symbols-outlined text-amber-500 text-sm" id="vl-lock-icon">lock</span>
        <p class="text-xs text-[#706189] font-medium" id="vl-lock-msg">Finish the video to unlock the quiz</p>
      </div>
      <button id="vl-quiz-btn" onclick="showScreen('quizScreen')" disabled
              class="w-full h-14 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all duration-500 cursor-not-allowed bg-primary/20 text-primary/40">
        Take Quiz
        <span class="material-symbols-outlined">chevron_right</span>
      </button>
      <div class="flex justify-around items-center mt-5 px-2">
        <div onclick="showScreen('demoSelection')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined text-xl">home</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Home</span>
        </div>
        <div onclick="showScreen('educationHub')" class="flex flex-col items-center text-primary cursor-pointer">
          <span class="material-symbols-outlined text-xl">school</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Learn</span>
        </div>
        <div onclick="showScreen('safetyTrainingScreen')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined text-xl">security</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Safety</span>
        </div>
        <div onclick="showScreen('rewardsCredits')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined text-xl">redeem</span>
          <span class="text-[10px] font-bold uppercase tracking-tighter">Rewards</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ── Video lesson unlock (demo mode) ─────────────────────────────────
       In production replace with real video timeupdate/ended events.
       Quiz unlocks after VL_DEMO_UNLOCK seconds of "playback".         */
    var vlPlaying=false, vlCompleted=false, vlSecs=0;
    var VL_DEMO_UNLOCK=8, vlIv=null;
    function vlPlay(){
      if(vlCompleted||vlPlaying) return;
      vlPlaying=true;
      document.getElementById('vl-thumb').style.opacity='0';
      document.getElementById('vl-play-btn').style.display='none';
      document.getElementById('vl-controls').classList.remove('hidden');
      var ifr=document.getElementById('vl-iframe');
      if(ifr.dataset.src){ ifr.src=ifr.dataset.src; ifr.classList.remove('hidden'); }
      vlIv=setInterval(function(){
        vlSecs++;
        var m=Math.floor(vlSecs/60),s=vlSecs%60;
        document.getElementById('vl-elapsed').textContent=m+':'+(s<10?'0':'')+s;
        document.getElementById('vl-bar').style.width=Math.min(100,(vlSecs/VL_DEMO_UNLOCK)*100)+'%';
        if(vlSecs>=2) vlCheck('vl-check-2');
        if(vlSecs>=4) vlCheck('vl-check-3');
        if(vlSecs>=6) vlCheck('vl-check-4');
        if(vlSecs>=VL_DEMO_UNLOCK&&!vlCompleted){ vlCompleted=true; clearInterval(vlIv); vlUnlock(); }
      },1000);
    }
    function vlCheck(id){
      var el=document.getElementById(id);
      if(el&&!el.dataset.done){
        el.dataset.done='1';
        el.classList.replace('border-gray-200','border-primary');
        el.classList.replace('bg-white','bg-primary/10');
        el.innerHTML='<span class="material-symbols-outlined text-primary text-xs">check</span>';
      }
    }
    function vlUnlock(){
      var btn=document.getElementById('vl-quiz-btn');
      btn.disabled=false;
      btn.className='w-full h-14 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all duration-500 bg-primary text-white shadow-lg shadow-primary/30 active:scale-[0.98]';
      var icon=document.getElementById('vl-lock-icon');
      icon.textContent='lock_open';
      icon.className='material-symbols-outlined text-acc-green text-sm';
      document.getElementById('vl-lock-msg').textContent='Quiz unlocked — good luck!';
      document.getElementById('vl-status-label').textContent='Lesson complete ✓';
    }
  </script>

  <!-- ============================================
       SCREEN: COMMUNITY EVENTS
       Linked from "In-Person Workshops" in educationHub.
       Shows group rides + education workshops near Sydney.
       Claim credits by QR scan at event meeting point.
       ============================================ -->
  <div id="communityEventsScreen" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light">

      <!-- Header -->
      <div class="sticky top-0 z-10 bg-background-light/90 backdrop-blur-md px-4 pt-5 pb-3 border-b border-gray-100">
        <div class="flex items-center justify-between mb-3">
          <div onclick="showScreen('educationHub')" class="flex size-10 items-center justify-center rounded-full bg-white shadow-sm border border-gray-100 cursor-pointer">
            <span class="material-symbols-outlined text-[#706189]">arrow_back_ios_new</span>
          </div>
          <div>
            <h1 class="text-xl font-bold tracking-tight text-center font-display">Earn Credits Together</h1>
            <p class="text-xs text-[#706189] text-center">Join rides &amp; workshops near you</p>
          </div>
          <div class="flex size-10 items-center justify-center rounded-full bg-white shadow-sm border border-gray-100">
            <span class="material-symbols-outlined text-primary text-lg">map</span>
          </div>
        </div>
        <!-- Segmented control -->
        <div class="flex p-1 bg-gray-200/50 rounded-xl">
          <button onclick="ceTab(this,'education')" id="ce-tab-education"
                  class="flex-1 py-2 text-sm font-bold rounded-lg bg-white shadow-sm text-primary transition-all">Education</button>
          <button onclick="ceTab(this,'social')" id="ce-tab-social"
                  class="flex-1 py-2 text-sm font-semibold text-[#706189] transition-all">Social Rides</button>
        </div>
      </div>

      <div class="overflow-y-auto pb-28 flex-1">

        <!-- Featured event hero -->
        <div class="mx-4 mt-4 relative rounded-2xl overflow-hidden shadow-xl cursor-pointer group" style="height:200px">
          <img class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
               src="https://lh3.googleusercontent.com/aida-public/AB6AXuAhoQvs3eCJK7G4LUHcvP-oL7u6JbbstGxgLBjk-Hvkf0MukJZ-wb64KNwtLvifjwaXNAb3Zw3D3j4EuYYvAWJ28_MVcH183wjCNl4lyRy8HAPKsVA-lyXehL_y9ILP59TKX3XpHs0C0v-QLSm7xNwfdZk0mSc3SEzkwvjgk-vwzx0pIbtBZtP28KHEvIJS0w-rWaV_emo7rQXS0X5XW6xgx4GvEjAGEXxkCU387x5HRZ95XMqi8Z2IAW3EdzML8ieeQZ6woEvp5nc"
               alt="Sydney Coastal Ride group"/>
          <div class="absolute inset-0" style="background:linear-gradient(to top,rgba(0,0,0,0.85) 0%,rgba(0,0,0,0.15) 60%,transparent 100%)"></div>
          <div class="absolute bottom-0 left-0 p-5 w-full flex justify-between items-end">
            <div class="space-y-1">
              <span class="bg-primary text-white text-[10px] font-black px-2.5 py-0.5 rounded-full uppercase tracking-wider">Featured Event</span>
              <h2 class="text-white text-xl font-bold leading-tight font-display">Sydney Coastal Ride</h2>
              <div class="flex items-center gap-2 text-white/75 text-xs">
                <span class="material-symbols-outlined text-sm">calendar_today</span>
                <span>Sat, 24 Oct • 08:30 AM</span>
              </div>
            </div>
            <div class="bg-white/20 backdrop-blur-md rounded-xl p-3 text-center border border-white/30 min-w-[72px]">
              <p class="text-[9px] font-bold text-white/70 uppercase">Reward</p>
              <p class="text-2xl font-black text-primary leading-none">250</p>
              <p class="text-[8px] font-bold text-white/60 uppercase">credits</p>
            </div>
          </div>
        </div>

        <!-- Category filters -->
        <div class="flex gap-2 px-4 mt-4 overflow-x-auto pb-1 hide-scrollbar">
          <button class="shrink-0 h-9 px-4 rounded-xl bg-primary text-white font-bold text-xs shadow-md shadow-primary/20">All Events</button>
          <button class="shrink-0 h-9 px-4 rounded-xl bg-white border border-gray-100 text-[#706189] font-semibold text-xs">Group Rides</button>
          <button class="shrink-0 h-9 px-4 rounded-xl bg-white border border-gray-100 text-[#706189] font-semibold text-xs">Workshops</button>
          <button class="shrink-0 h-9 px-4 rounded-xl bg-white border border-gray-100 text-[#706189] font-semibold text-xs">Safety First</button>
        </div>

        <!-- Event list -->
        <div class="px-4 mt-5 space-y-4">
          <div class="flex items-center justify-between">
            <h3 class="text-base font-bold font-display">Upcoming in Sydney</h3>
            <button class="text-primary text-xs font-bold">See all</button>
          </div>

          <!-- Card: CPCC Group Ride -->
          <div class="bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 flex flex-col">
            <div class="relative h-40 w-full">
              <img class="w-full h-full object-cover"
                   src="https://lh3.googleusercontent.com/aida-public/AB6AXuCEnRJ7Ve-rJDfOK-XdXM4ukZS3T4EtVGnyGEGIflX6lNbxlOHm1v03akdWiPyN73DPPqFrrl1yRhayGslZJnO_GFm-jDg2FnQ8DfdxJyD4X4T_G5cIN8_Jg-HQO04kA5gehSEfwjPhhjAGa_3FArPC8mj3NjMDuvz5nB8lI-hWMCvs72O-cjUn9IfT4sW47f50rx864Q_ecGzxz_3QiakAx6ygTsf4Th3yK9hkSANRVaheMlloap-qYj_hSAqwUE79GxTdF8hxeu4"
                   alt="Group cyclists"/>
              <div class="absolute top-3 right-3 bg-acc-green text-white px-3 py-1 rounded-full text-xs font-black shadow-md">Earn +100 Credits</div>
              <div class="absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white px-2 py-1 rounded-lg text-xs font-medium flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">verified</span>Parra-Bike Hub
              </div>
            </div>
            <div class="p-4">
              <h4 class="text-base font-bold mb-2 font-display">Parra-Bike Hub Community Ride</h4>
              <div class="space-y-1 mb-4">
                <div class="flex items-center gap-2 text-[#706189] text-xs">
                  <span class="material-symbols-outlined text-xs">calendar_today</span><span>Sat, Oct 12 • 09:00 AM</span>
                </div>
                <div class="flex items-center gap-2 text-[#706189] text-xs">
                  <span class="material-symbols-outlined text-xs">location_on</span><span>Parramatta, Sydney</span>
                </div>
              </div>
              <button class="w-full bg-primary text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform shadow-sm shadow-primary/20">
                Join &amp; Earn<span class="material-symbols-outlined text-sm">arrow_forward</span>
              </button>
            </div>
          </div>

          <!-- Card: E-Bike Safety 101 -->
          <div class="bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 flex flex-col">
            <div class="relative h-40 w-full">
              <img class="w-full h-full object-cover"
                   src="https://lh3.googleusercontent.com/aida-public/AB6AXuBP1DqTB5gsNZPDWB0Rq0DZtYQW2qPGzicy_d4ieUVtsEw_iVhTUlJf-SpSouzROKNMJDUun4DQJhwRsOKqMOme4FdbHT9dChbAy_D2Tg04jtH3VBw31ttb9lQAmOvlRk76hWO7qan6Pp7bpD_D6Kf3q8MGegWTd1cGESs5bjCTJqHCQ5cQxJqCZn0VF2rGjbQKTSihr4ZS7fvI5gYB5oREL0p7BPmZSdhGLbf2O_rJHno80_LS3tRslvDkr1Svh7lWc5M8_GwOz9U"
                   alt="E-bike"/>
              <div class="absolute top-3 right-3 bg-acc-green text-white px-3 py-1 rounded-full text-xs font-black shadow-md">Earn +150 Credits</div>
              <div class="absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white px-2 py-1 rounded-lg text-xs font-medium flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">school</span>Bicycle NSW
              </div>
            </div>
            <div class="p-4">
              <h4 class="text-base font-bold mb-2 font-display">Bicycle NSW Safety Course</h4>
              <div class="space-y-1 mb-4">
                <div class="flex items-center gap-2 text-[#706189] text-xs">
                  <span class="material-symbols-outlined text-xs">calendar_today</span><span>Sun, Oct 13 • 10:30 AM</span>
                </div>
                <div class="flex items-center gap-2 text-[#706189] text-xs">
                  <span class="material-symbols-outlined text-xs">location_on</span><span>Haymarket, Sydney</span>
                </div>
              </div>
              <button class="w-full bg-primary text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform shadow-sm shadow-primary/20">
                Join &amp; Earn<span class="material-symbols-outlined text-sm">arrow_forward</span>
              </button>
            </div>
          </div>

          <!-- Card: Maintenance Clinic -->
          <div class="bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 flex flex-col">
            <div class="relative h-40 w-full">
              <img class="w-full h-full object-cover"
                   src="https://lh3.googleusercontent.com/aida-public/AB6AXuCOSuAF4qUndiL29oITcnDgYRKVeMpxJgRiMT1c_MkXIS7UU2c_MjS_UKo_0oSscm7GMbhAg0kJL3b-PudYQJ--RRX3i1cpGOlIT7pKIg8y5v2Cuc1A2Dze7iCWLkE0s4xz7Uhh5cnH5nGjeU00LRE8OHE2GQpQswI2kI4s1mUw8f2EJCDn3fRye8XmWAHqkTFTaoaqeZLgV5l0VvxwGA06tS806A8046HCzmM0BnFkrPrr4LB2VkSJ4fMpWq5lAsi8SEzxUM_2ym0"
                   alt="Bike tools"/>
              <div class="absolute top-3 right-3 bg-acc-green text-white px-3 py-1 rounded-full text-xs font-black shadow-md">Earn +75 Credits</div>
              <div class="absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white px-2 py-1 rounded-lg text-xs font-medium flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">build</span>City of Sydney
              </div>
            </div>
            <div class="p-4">
              <h4 class="text-base font-bold mb-2 font-display">Basic Maintenance Clinic</h4>
              <div class="space-y-1 mb-4">
                <div class="flex items-center gap-2 text-[#706189] text-xs">
                  <span class="material-symbols-outlined text-xs">calendar_today</span><span>Wed, Oct 16 • 05:30 PM</span>
                </div>
                <div class="flex items-center gap-2 text-[#706189] text-xs">
                  <span class="material-symbols-outlined text-xs">location_on</span><span>Sydney Park Hub</span>
                </div>
              </div>
              <button class="w-full bg-primary text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform shadow-sm shadow-primary/20">
                Join &amp; Earn<span class="material-symbols-outlined text-sm">arrow_forward</span>
              </button>
            </div>
          </div>

          <!-- How to claim credits -->
          <div class="bg-white rounded-2xl p-4 flex gap-4 items-center shadow-sm border border-gray-100 mb-2">
            <div class="size-16 rounded-xl bg-primary/10 flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-primary text-3xl">qr_code_scanner</span>
            </div>
            <div>
              <h4 class="font-bold text-sm mb-1 font-display">How to claim credits</h4>
              <p class="text-xs text-[#706189]">Scan the QR code at the event meeting point to verify your attendance and auto-credit your account.</p>
            </div>
          </div>

        </div><!-- /event list -->
      </div><!-- /scroll -->

      <!-- Bottom nav -->
      <div class="fixed bottom-0 left-0 right-0 mx-auto max-w-[430px] border-t border-gray-100 bg-white/95 backdrop-blur-lg px-8 pt-3 pb-8 flex justify-between items-center z-50" style="box-shadow:0 -2px 10px rgba(0,0,0,0.05)">
        <div onclick="showScreen('demoSelection')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined">home</span><span class="text-[10px] mt-1">Home</span>
        </div>
        <div class="flex flex-col items-center text-primary">
          <span class="material-symbols-outlined">explore</span><span class="text-[10px] mt-1 font-bold">Events</span>
        </div>
        <div onclick="showScreen('educationHub')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined">school</span><span class="text-[10px] mt-1">Learn</span>
        </div>
        <div onclick="showScreen('rewardsCredits')" class="flex flex-col items-center text-gray-400 cursor-pointer">
          <span class="material-symbols-outlined">redeem</span><span class="text-[10px] mt-1">Rewards</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    function ceTab(btn, tab) {
      ['education','social'].forEach(function(t){
        var el = document.getElementById('ce-tab-'+t);
        if (t === tab) {
          el.className = 'flex-1 py-2 text-sm font-bold rounded-lg bg-white shadow-sm text-primary transition-all';
        } else {
          el.className = 'flex-1 py-2 text-sm font-semibold text-[#706189] transition-all';
        }
      });
    }
  </script>

  <!-- ============================================
       SCREEN 8: REWARDS & CREDITS
       ============================================ -->
  <div id="rewardsCredits" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light overflow-y-auto">
      <!-- Header -->
      <header class="sticky top-0 z-20 bg-white/80 backdrop-blur-md border-b border-gray-100">
        <div class="flex items-center p-4 justify-between">
          <button onclick="showScreen('educationHub')" class="text-primary flex size-10 items-center justify-center rounded-full hover:bg-primary/10 transition-colors">
            <span class="material-symbols-outlined">arrow_back_ios_new</span>
          </button>
          <h2 class="text-lg font-bold leading-tight tracking-tight flex-1 text-center">Rewards &amp; Credits</h2>
          <div class="size-10"></div>
        </div>
      </header>

      <main class="flex-1 pb-32">
        <!-- Balance -->
        <section class="bg-white px-4 pt-8 pb-6 text-center shadow-sm">
          <h1 class="tracking-tight text-[44px] font-extrabold leading-tight">$45.00</h1>
          <p class="text-[#756189] text-sm font-medium mt-1">Total Rental Credits</p>
          <a onclick="showScreen('educationHub')" class="inline-flex items-center gap-1 text-primary text-sm font-semibold mt-4 cursor-pointer hover:opacity-80 transition-opacity">
            <span class="material-symbols-outlined text-[18px]">info</span>
            <span class="underline underline-offset-4">How to earn more</span>
          </a>
        </section>

        <!-- Ways to Earn -->
        <section class="px-4 pt-8">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold">Ways to Earn</h3>
            <span class="text-xs font-bold text-primary uppercase tracking-wider">New</span>
          </div>
          <div class="grid grid-cols-1 gap-4">
            <!-- Attend Workshop -->
            <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-transform cursor-pointer">
              <div class="size-12 bg-primary/10 rounded-full flex items-center justify-center text-primary">
                <span class="material-symbols-outlined text-[28px]">school</span>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-bold">Attend a Workshop</h4>
                  <span class="text-primary font-bold">+$10</span>
                </div>
                <div class="mt-2 w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                  <div class="bg-primary h-full w-0"></div>
                </div>
                <p class="text-[11px] text-gray-500 mt-1 font-medium">0/1 Complete</p>
              </div>
              <span class="material-symbols-outlined text-gray-300">chevron_right</span>
            </div>

            <!-- Safety Quiz -->
            <div onclick="showScreen('safetyTrainingScreen')" class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-transform cursor-pointer">
              <div class="size-12 bg-primary/10 rounded-full flex items-center justify-center text-primary">
                <span class="material-symbols-outlined text-[28px]">quiz</span>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-bold">Safety Training Modules</h4>
                  <span class="text-primary font-bold">+$55</span>
                </div>
                <div class="mt-2 w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                  <div class="bg-primary h-full" style="width: 40%"></div>
                </div>
                <p class="text-[11px] text-gray-500 mt-1 font-medium">In progress</p>
              </div>
              <span class="material-symbols-outlined text-gray-300">chevron_right</span>
            </div>

            <!-- Group Ride -->
            <div onclick="showScreen('rideSupportTraining')" class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-transform cursor-pointer">
              <div class="size-12 bg-primary/10 rounded-full flex items-center justify-center text-primary">
                <span class="material-symbols-outlined text-[28px]">group</span>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <h4 class="font-bold">Support a Group Ride</h4>
                  <span class="text-primary font-bold">+$15</span>
                </div>
                <div class="mt-2 w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                  <div class="bg-primary h-full w-0"></div>
                </div>
                <p class="text-[11px] text-gray-500 mt-1 font-medium">Available next Sat</p>
              </div>
              <span class="material-symbols-outlined text-gray-300">chevron_right</span>
            </div>
          </div>
        </section>

        <!-- Recent Earnings -->
        <section class="px-4 pt-10">
          <h3 class="text-lg font-bold mb-4">Recent Earnings</h3>
          <div class="bg-white rounded-xl overflow-hidden border border-gray-100">
            <div class="flex items-center justify-between p-4 border-b border-gray-50">
              <div class="flex items-center gap-3">
                <div class="size-10 bg-green-50 rounded-lg flex items-center justify-center text-green-600">
                  <span class="material-symbols-outlined text-[20px]">check_circle</span>
                </div>
                <div>
                  <p class="text-sm font-bold">Safety Quiz Completed</p>
                  <p class="text-xs text-gray-400">Oct 24, 2023</p>
                </div>
              </div>
              <span class="text-green-600 font-bold">+$5.00</span>
            </div>
            <div class="flex items-center justify-between p-4 border-b border-gray-50">
              <div class="flex items-center gap-3">
                <div class="size-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                  <span class="material-symbols-outlined text-[20px]">person_add</span>
                </div>
                <div>
                  <p class="text-sm font-bold">Referral Bonus</p>
                  <p class="text-xs text-gray-400">Oct 20, 2023</p>
                </div>
              </div>
              <span class="text-primary font-bold">+$10.00</span>
            </div>
            <div class="flex items-center justify-between p-4">
              <div class="flex items-center gap-3">
                <div class="size-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                  <span class="material-symbols-outlined text-[20px]">pedal_bike</span>
                </div>
                <div>
                  <p class="text-sm font-bold">Ride Streak Reward</p>
                  <p class="text-xs text-gray-400">Oct 15, 2023</p>
                </div>
              </div>
              <span class="text-primary font-bold">+$30.00</span>
            </div>
          </div>
          <button class="w-full text-center text-primary text-sm font-bold mt-4 py-2">View All Activity</button>
        </section>
      </main>

      <!-- Fixed Bottom Action -->
      <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-lg border-t border-gray-100 z-30">
        <div class="max-w-[430px] mx-auto">
          <button onclick="showScreen('paidCheckout')" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/25 active:scale-[0.97] transition-all flex items-center justify-center gap-2">
            <span class="material-symbols-outlined text-[20px]">shopping_cart_checkout</span>
            Redeem on Next Rental
          </button>
          <div class="h-4"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN 9: QUIZ (ONLINE ESSENTIALS)
       ============================================ -->
  <div id="quizScreen" class="fixed inset-0 z-30 bg-white flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-white">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between border-b border-gray-100/30">
        <div onclick="showScreen('educationHub')" class="flex size-12 shrink-0 items-center justify-center cursor-pointer">
          <span class="material-symbols-outlined">arrow_back_ios</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Online Essentials</h2>
      </div>

      <!-- Progress -->
      <div class="flex flex-col gap-3 p-6">
        <div class="flex gap-6 justify-between">
          <p class="text-base font-medium leading-normal">Question 3 of 10</p>
          <p class="text-[#706189] text-sm font-normal leading-normal">30% Complete</p>
        </div>
        <div class="rounded-full bg-gray-200 h-2.5 overflow-hidden">
          <div class="h-full rounded-full bg-primary" style="width: 30%;"></div>
        </div>
      </div>

      <!-- Question -->
      <div class="px-6 py-2">
        <h3 class="tracking-light text-2xl font-bold leading-tight text-left">
          What is the correct hand signal for a right turn while cycling in Sydney?
        </h3>
        <p class="text-[#706189] text-sm mt-2">Select the most appropriate road safety signal according to NSW regulations.</p>
      </div>

      <!-- Answer Options -->
      <div class="flex flex-col gap-4 p-6 grow" style="--radio-dot-svg: url('data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(124,59,237)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3ccircle cx=%278%27 cy=%278%27 r=%274%27/%3e%3c/svg%3e');">
        <label class="flex items-center gap-4 rounded-xl border-2 border-solid border-primary bg-primary/5 p-4 flex-row-reverse cursor-pointer">
          <input checked name="quiz-option" type="radio" class="h-6 w-6 border-2 border-gray-200 bg-transparent text-transparent checked:border-primary checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-primary"/>
          <div class="flex size-10 items-center justify-center rounded-lg bg-primary text-white shrink-0">
            <span class="material-symbols-outlined">back_hand</span>
          </div>
          <div class="flex grow flex-col">
            <p class="text-sm font-semibold leading-normal">Extend right arm horizontally</p>
            <p class="text-[#706189] text-xs font-normal leading-normal">Standard legal signal for right turns</p>
          </div>
        </label>

        <label class="flex items-center gap-4 rounded-xl border border-solid border-gray-200 p-4 flex-row-reverse cursor-pointer hover:bg-gray-50 transition-colors">
          <input name="quiz-option" type="radio" class="h-6 w-6 border-2 border-gray-200 bg-transparent text-transparent checked:border-primary checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-primary"/>
          <div class="flex size-10 items-center justify-center rounded-lg bg-gray-200 text-[#706189] shrink-0">
            <span class="material-symbols-outlined">front_hand</span>
          </div>
          <div class="flex grow flex-col">
            <p class="text-sm font-medium leading-normal">Raise left arm with elbow bent</p>
            <p class="text-[#706189] text-xs font-normal leading-normal">Used primarily for stopping</p>
          </div>
        </label>

        <label class="flex items-center gap-4 rounded-xl border border-solid border-gray-200 p-4 flex-row-reverse cursor-pointer hover:bg-gray-50 transition-colors">
          <input name="quiz-option" type="radio" class="h-6 w-6 border-2 border-gray-200 bg-transparent text-transparent checked:border-primary checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-primary"/>
          <div class="flex size-10 items-center justify-center rounded-lg bg-gray-200 text-[#706189] shrink-0">
            <span class="material-symbols-outlined">south</span>
          </div>
          <div class="flex grow flex-col">
            <p class="text-sm font-medium leading-normal">Point towards the ground</p>
            <p class="text-[#706189] text-xs font-normal leading-normal">Indicates hazards on the road</p>
          </div>
        </label>

        <label class="flex items-center gap-4 rounded-xl border border-solid border-gray-200 p-4 flex-row-reverse cursor-pointer hover:bg-gray-50 transition-colors">
          <input name="quiz-option" type="radio" class="h-6 w-6 border-2 border-gray-200 bg-transparent text-transparent checked:border-primary checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-primary"/>
          <div class="flex size-10 items-center justify-center rounded-lg bg-gray-200 text-[#706189] shrink-0">
            <span class="material-symbols-outlined">pan_tool</span>
          </div>
          <div class="flex grow flex-col">
            <p class="text-sm font-medium leading-normal">Wave both hands above head</p>
            <p class="text-[#706189] text-xs font-normal leading-normal">Emergency signal for help</p>
          </div>
        </label>
      </div>

      <!-- Submit Button -->
      <div class="flex flex-col px-6 py-6 border-t border-gray-100/30 bg-white">
        <button onclick="showScreen('rewardsCredits'); showToast('+$5 credits earned!')" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 px-5 bg-primary text-white text-base font-bold leading-normal shadow-lg shadow-primary/30 active:scale-[0.98] transition-transform">
          <span class="truncate">Submit Answer</span>
        </button>
        <p class="text-center text-[#706189] text-xs mt-4">Micro2Move &bull; Cycling Safety Course</p>
      </div>
      <div class="h-8 bg-white"></div>
    </div>
  </div>

  <!-- ============================================
       SCREEN 10: RIDE SUPPORT TRAINING
       ============================================ -->
  <div id="rideSupportTraining" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] flex-col overflow-x-hidden shadow-2xl bg-background-light overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center bg-white p-4 pb-2 justify-between sticky top-0 z-50 border-b border-gray-100">
        <div onclick="showScreen('educationHub')" class="flex size-12 shrink-0 items-center justify-start cursor-pointer">
          <span class="material-symbols-outlined">arrow_back</span>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">Ride Support Training</h2>
        <div class="size-12"></div>
      </div>

      <!-- Title -->
      <div class="px-4 pt-5 pb-2">
        <h3 class="tracking-light text-2xl font-bold leading-tight">Support a Community Ride</h3>
      </div>
      <div class="px-4 pt-1 pb-3">
        <p class="text-[#706189] text-base font-normal leading-normal">Volunteer for beginner-friendly rides to gain experience and earn mentor points. Help grow our community by guiding new riders.</p>
      </div>

      <!-- Upcoming Rides -->
      <div class="px-4 pt-4 pb-2">
        <h3 class="text-lg font-bold leading-tight tracking-[-0.015em]">Upcoming Beginner Rides</h3>
      </div>

      <div class="p-4 flex flex-col gap-4">
        <!-- Ride 1 -->
        <div class="flex flex-col items-stretch justify-start rounded-xl shadow-sm bg-white overflow-hidden border border-gray-100">
          <div class="w-full bg-center bg-no-repeat aspect-video bg-cover" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDbVyweifT8CTChazcgL37USJiYjAWKtO4jSvRUTubFuI1qsX_qpiwerMaCFaQNSUPn8ugy22bkoLdScVPobz-6YezgYm0ebXwCP5vhXG42OpBC-I34d_HWZE2BYU72zm9o-bQfftNBX-ol1zEVbLkH2luZv5qwPfG8CWHT4t4MXYAZ97MCr-Kx2RCWiWIkUbJhRPGBMXKbAyPp8Rgx_unqFVGf09mY8CnSyLOSzgobnrsqfEvUV2E6Xbq3h01IhL3tKmdak7CvKH0z");'></div>
          <div class="flex w-full grow flex-col items-stretch justify-center gap-1 py-4 px-4">
            <div class="flex justify-between items-start">
              <p class="text-lg font-bold leading-tight tracking-[-0.015em]">Riverside Morning Loop</p>
              <span class="bg-primary/10 text-primary text-xs font-bold px-2 py-1 rounded-full">+100 pts</span>
            </div>
            <div class="flex items-end gap-3 justify-between mt-2">
              <div class="flex flex-col gap-1">
                <p class="text-primary text-sm font-semibold leading-normal uppercase tracking-wider">Level: Beginner</p>
                <p class="text-[#706189] text-sm font-normal leading-tight">Join us to support first-time riders on this flat 5km route.</p>
              </div>
              <button onclick="showToast('Volunteered! +100 pts')" class="flex min-w-[100px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-semibold leading-normal hover:bg-primary/90 transition-colors">
                <span class="truncate">Volunteer</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Ride 2 -->
        <div class="flex flex-col items-stretch justify-start rounded-xl shadow-sm bg-white overflow-hidden border border-gray-100">
          <div class="w-full bg-center bg-no-repeat aspect-video bg-cover" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAmTzdYUwm8WgpLDiUepsaTA05Z30w9Jfmog88qlAqnKJduhJYpVNKOyLLfMDrpcS4gqiXw56vI0HJlYW0CWb8cpdpDED1oUk-SGLO23r__2vGEbSU9tUPSkkZsGfAeW0yzX8hZucaJaKuqFHdj7dFH9IMkfo1vc5rR50rpoMhGo9SnYj51LmQbZ4y5Hfp8E4dEdJkE0Sw-NR5b-NBHQ5BgK9GQmUR3Sryo5C5n_2b2-Ja7QElGx7rYwhTToEvf2Rhh3LgG_7VVFP5g");'></div>
          <div class="flex w-full grow flex-col items-stretch justify-center gap-1 py-4 px-4">
            <div class="flex justify-between items-start">
              <p class="text-lg font-bold leading-tight tracking-[-0.015em]">Urban Explorer Intro</p>
              <span class="bg-primary/10 text-primary text-xs font-bold px-2 py-1 rounded-full">+150 pts</span>
            </div>
            <div class="flex items-end gap-3 justify-between mt-2">
              <div class="flex flex-col gap-1">
                <p class="text-primary text-sm font-semibold leading-normal uppercase tracking-wider">Level: Beginner</p>
                <p class="text-[#706189] text-sm font-normal leading-tight">Help navigate bike lanes and traffic signals in the downtown core.</p>
              </div>
              <button onclick="showToast('Volunteered! +150 pts')" class="flex min-w-[100px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-semibold leading-normal hover:bg-primary/90 transition-colors">
                <span class="truncate">Volunteer</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Mentor Guidelines -->
      <div class="px-4 pt-6 pb-2">
        <h3 class="text-lg font-bold leading-tight tracking-[-0.015em]">Mentor Guidelines</h3>
      </div>
      <div class="px-4 pb-8">
        <div class="bg-primary/5 rounded-xl p-4 border border-primary/20">
          <ul class="space-y-4">
            <li class="flex gap-3">
              <span class="material-symbols-outlined text-primary text-xl">verified_user</span>
              <div>
                <p class="font-bold text-sm">Safety First</p>
                <p class="text-sm text-[#706189]">Always wear high-visibility gear and ensure all trainees have helmets.</p>
              </div>
            </li>
            <li class="flex gap-3">
              <span class="material-symbols-outlined text-primary text-xl">forum</span>
              <div>
                <p class="font-bold text-sm">Patience &amp; Communication</p>
                <p class="text-sm text-[#706189]">Use clear hand signals and voice commands. Encourage struggling riders.</p>
              </div>
            </li>
            <li class="flex gap-3">
              <span class="material-symbols-outlined text-primary text-xl">map</span>
              <div>
                <p class="font-bold text-sm">Know the Route</p>
                <p class="text-sm text-[#706189]">Arrive 15 minutes early to review the route and identify potential hazards.</p>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="h-10"></div>
    </div>
  </div>

  <!-- ============================================
       COMMUNITY - PROFILE PERSONALIZATION FLOW (4 Steps)
       ============================================ -->
  <div id="community" class="fixed inset-0 z-30 bg-white flex flex-col hidden">

    <!-- Step 1: About You -->
    <div id="profileStep1" class="flex flex-col min-h-screen bg-white">
      <!-- Header -->
      <div class="sticky top-0 z-20 flex items-center bg-white/90 backdrop-blur-md p-4 pb-2 justify-between">
        <button onclick="showWelcomeHub()" class="text-primary">
          <span class="material-symbols-outlined text-2xl">arrow_back_ios</span>
        </button>
        <h2 class="text-[#1a1624] text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">Step 1 of 4</h2>
        <div class="flex w-12 items-center justify-end">
          <p onclick="showProfileStep(4)" class="text-primary text-base font-bold leading-normal tracking-[0.015em] shrink-0 cursor-pointer">Skip</p>
        </div>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-6">
        <div class="h-1.5 w-10 rounded-full bg-primary"></div>
        <div class="h-1.5 w-1.5 rounded-full bg-[#e5e1eb]"></div>
        <div class="h-1.5 w-1.5 rounded-full bg-[#e5e1eb]"></div>
        <div class="h-1.5 w-1.5 rounded-full bg-[#e5e1eb]"></div>
      </div>

      <!-- Profile Photo Section -->
      <div class="flex p-4">
        <div class="flex w-full flex-col gap-4 items-center">
          <div class="flex gap-4 flex-col items-center">
            <div class="relative">
              <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-[140px] w-[140px] border-4 border-white shadow-xl bg-[#F0E6D8] flex items-center justify-center overflow-hidden">
                <span class="material-symbols-outlined text-5xl text-white/60">person</span>
              </div>
              <div class="absolute bottom-1 right-1 bg-primary p-2.5 rounded-full border-4 border-white shadow-lg flex items-center justify-center cursor-pointer">
                <span class="material-symbols-outlined text-white text-[20px]">photo_camera</span>
              </div>
            </div>
            <div class="flex flex-col items-center justify-center">
              <p class="text-[#1a1624] text-[28px] font-bold leading-tight tracking-[-0.025em] text-center font-display">About You</p>
              <p class="text-[#6b6675] text-base font-normal leading-normal text-center">Upload a photo to personalize your profile</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Fields -->
      <div class="px-6 space-y-6 pt-2 pb-44">
        <div class="flex flex-col">
          <p class="text-[#1a1624] text-[15px] font-bold leading-normal pb-2 px-1">First Name</p>
          <input id="profileFirstName" class="flex w-full rounded-2xl text-[#1a1624] focus:outline-0 focus:ring-2 focus:ring-primary/20 focus:border-primary border border-[#e5e1eb] bg-white h-14 px-4 text-base font-normal transition-all" placeholder="Enter first name"/>
        </div>
        <div class="flex flex-col">
          <p class="text-[#1a1624] text-[15px] font-bold leading-normal pb-2 px-1">Last Name</p>
          <input id="profileLastName" class="flex w-full rounded-2xl text-[#1a1624] focus:outline-0 focus:ring-2 focus:ring-primary/20 focus:border-primary border border-[#e5e1eb] bg-white h-14 px-4 text-base font-normal transition-all" placeholder="Enter last name"/>
        </div>
        <div class="flex flex-col">
          <p class="text-[#1a1624] text-[15px] font-bold leading-normal pb-2 px-1">Public Display Name</p>
          <input id="profileDisplayName" class="flex w-full rounded-2xl text-[#1a1624] focus:outline-0 focus:ring-2 focus:ring-primary/20 focus:border-primary border border-[#e5e1eb] bg-white h-14 px-4 text-base font-normal transition-all" placeholder="How others see you"/>
        </div>
      </div>

      <!-- Bottom Buttons -->
      <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-[#f0f0f0] p-6 pb-10 flex flex-col gap-3">
        <button onclick="showProfileStep(2)" class="w-full bg-primary hover:bg-purple-800 text-white font-bold py-4 rounded-2xl shadow-xl shadow-primary/25 flex items-center justify-center gap-2 transition-all active:scale-[0.98] h-14">
          <span>Next</span>
          <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
        </button>
        <button onclick="showWelcomeHub()" class="w-full bg-[#f3f0f7] text-[#1a1624] font-bold py-4 rounded-2xl active:bg-purple-100 transition-colors h-14">
          Save & Continue Later
        </button>
      </div>
    </div>

    <!-- Step 2: Cycling Experience -->
    <div id="profileStep2" class="flex flex-col min-h-screen bg-[#F9FAFB] hidden">
      <!-- Header -->
      <div class="sticky top-0 z-30 flex items-center bg-[#F9FAFB]/80 backdrop-blur-md p-4 justify-between border-b border-gray-100">
        <button onclick="showProfileStep(1)" class="p-2 -ml-2">
          <span class="material-symbols-outlined text-gray-600">chevron_left</span>
        </button>
        <h2 class="text-lg font-bold flex-1 text-center pr-8 font-display">Personalize</h2>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-6">
        <div class="h-2.5 w-2.5 rounded-full bg-primary/20"></div>
        <div class="h-2.5 w-10 rounded-full bg-primary shadow-sm"></div>
        <div class="h-2.5 w-2.5 rounded-full bg-primary/20"></div>
        <div class="h-2.5 w-2.5 rounded-full bg-primary/20"></div>
      </div>

      <!-- Title -->
      <div class="px-6 pt-2 pb-6">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 font-display">Your cycling background</h1>
        <p class="mt-2 text-gray-500">Select the experience level that best describes your current journey.</p>
      </div>

      <!-- Experience Options -->
      <div class="px-6 space-y-4 pb-44">
        <!-- New to Cycling -->
        <label class="relative flex items-center p-5 bg-white border border-gray-200 rounded-xl cursor-pointer shadow-sm transition-all has-[:checked]:border-2 has-[:checked]:border-primary">
          <input class="sr-only peer" name="experience" type="radio" value="new"/>
          <div class="flex items-center w-full gap-4 relative z-10">
            <div class="h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center peer-checked:bg-primary/10">
              <span class="material-symbols-outlined text-gray-500 peer-checked:text-primary">child_care</span>
            </div>
            <div class="flex-1">
              <p class="font-bold text-lg leading-tight">New to Cycling</p>
              <p class="text-sm text-gray-500">Starting from scratch</p>
            </div>
            <div class="h-6 w-6 border-2 border-gray-300 rounded-full flex items-center justify-center peer-checked:border-primary peer-checked:bg-primary transition-colors">
              <div class="w-2.5 h-2.5 bg-white rounded-full opacity-0 peer-checked:opacity-100"></div>
            </div>
          </div>
        </label>

        <!-- Casual Rider (Default Selected) -->
        <label class="relative flex items-center p-5 bg-white border-2 border-primary rounded-xl cursor-pointer shadow-sm transition-all">
          <input checked class="sr-only peer" name="experience" type="radio" value="casual"/>
          <div class="flex items-center w-full gap-4 relative z-10">
            <div class="h-12 w-12 bg-primary/10 rounded-full flex items-center justify-center">
              <span class="material-symbols-outlined text-primary">pedal_bike</span>
            </div>
            <div class="flex-1">
              <p class="font-bold text-lg leading-tight">Casual Rider</p>
              <p class="text-sm text-gray-500">Weekends and park trails</p>
            </div>
            <div class="h-6 w-6 border-2 border-primary bg-primary rounded-full flex items-center justify-center">
              <div class="w-2.5 h-2.5 bg-white rounded-full"></div>
            </div>
          </div>
        </label>

        <!-- Regular Cyclist -->
        <label class="relative flex items-center p-5 bg-white border border-gray-200 rounded-xl cursor-pointer shadow-sm transition-all has-[:checked]:border-2 has-[:checked]:border-primary">
          <input class="sr-only peer" name="experience" type="radio" value="regular"/>
          <div class="flex items-center w-full gap-4 relative z-10">
            <div class="h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center">
              <span class="material-symbols-outlined text-gray-500">directions_bike</span>
            </div>
            <div class="flex-1">
              <p class="font-bold text-lg leading-tight">Regular Cyclist</p>
              <p class="text-sm text-gray-500">Weekly commutes or exercise</p>
            </div>
            <div class="h-6 w-6 border-2 border-gray-300 rounded-full flex items-center justify-center">
              <div class="w-2.5 h-2.5 bg-white rounded-full opacity-0"></div>
            </div>
          </div>
        </label>

        <!-- Experienced Rider -->
        <label class="relative flex items-center p-5 bg-white border border-gray-200 rounded-xl cursor-pointer shadow-sm transition-all has-[:checked]:border-2 has-[:checked]:border-primary">
          <input class="sr-only peer" name="experience" type="radio" value="experienced"/>
          <div class="flex items-center w-full gap-4 relative z-10">
            <div class="h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center">
              <span class="material-symbols-outlined text-gray-500">electric_bolt</span>
            </div>
            <div class="flex-1">
              <p class="font-bold text-lg leading-tight">Experienced Rider</p>
              <p class="text-sm text-gray-500">Long distance or daily Pro</p>
            </div>
            <div class="h-6 w-6 border-2 border-gray-300 rounded-full flex items-center justify-center">
              <div class="w-2.5 h-2.5 bg-white rounded-full opacity-0"></div>
            </div>
          </div>
        </label>

        <!-- Matching Info -->
        <div class="mt-8">
          <div class="bg-primary/5 border border-primary/20 p-4 rounded-xl flex items-center gap-4">
            <div class="h-10 w-10 bg-primary rounded-lg flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-white text-xl">auto_awesome</span>
            </div>
            <div>
              <p class="text-sm font-bold text-primary">12 e-bikes match this experience</p>
              <p class="text-[11px] text-primary/70">Refining your recommendations...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Buttons -->
      <div class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-gray-100 p-6 pb-10">
        <div class="flex gap-4">
          <button onclick="showProfileStep(1)" class="flex-1 py-4 border-2 border-primary/20 text-primary font-bold rounded-xl active:bg-primary/5 transition-colors">
            Back
          </button>
          <button onclick="showProfileStep(3)" class="flex-[2] py-4 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/20 flex items-center justify-center gap-2 active:scale-[0.98] transition-all">
            <span>Next Step</span>
            <span class="material-symbols-outlined text-base">arrow_forward</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Step 3: Interests -->
    <div id="profileStep3" class="flex flex-col min-h-screen bg-[#FDFCFE] hidden">
      <!-- Header -->
      <div class="sticky top-0 z-20 flex items-center bg-[#FDFCFE]/90 backdrop-blur-md px-4 py-4 justify-between">
        <button onclick="showProfileStep(2)" class="flex items-center text-primary font-medium">
          <span class="material-symbols-outlined text-2xl">chevron_left</span>
          <span>Back</span>
        </button>
        <h2 class="text-base font-bold absolute left-1/2 -translate-x-1/2 font-display">Step 3 of 4</h2>
        <div class="flex items-center">
          <p onclick="showProfileStep(4)" class="text-primary text-base font-medium cursor-pointer">Skip</p>
        </div>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-6">
        <div class="h-2 w-2 rounded-full bg-primary/20"></div>
        <div class="h-2 w-2 rounded-full bg-primary/20"></div>
        <div class="h-2 w-8 rounded-full bg-primary shadow-[0_0_8px_rgba(107,33,168,0.4)]"></div>
        <div class="h-2 w-2 rounded-full bg-primary/20"></div>
      </div>

      <!-- Title -->
      <div class="px-6 pt-2 pb-6 text-center">
        <h1 class="text-2xl font-bold tracking-tight mb-2 font-display">What interests you?</h1>
        <p class="text-gray-500 text-sm">Select one or more to personalize your feed and discover relevant rides.</p>
      </div>

      <!-- Interest Grid -->
      <div class="px-6 grid grid-cols-2 gap-4 pb-52">
        <!-- Demo E-bikes (Selected) -->
        <div onclick="toggleInterest(this)" class="interest-card selected relative group cursor-pointer bg-primary/5 border-2 border-primary p-5 rounded-xl flex flex-col items-center text-center gap-4 transition-all duration-200">
          <div class="check-mark absolute top-2 right-2 h-5 w-5 bg-primary rounded-full flex items-center justify-center">
            <span class="material-symbols-outlined text-white text-[14px] font-bold">check</span>
          </div>
          <div class="h-16 w-16 bg-primary/10 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-primary text-4xl">electric_rickshaw</span>
          </div>
          <p class="text-sm font-bold text-primary">Demo E-bikes</p>
        </div>

        <!-- Join Group Rides (Selected) -->
        <div onclick="toggleInterest(this)" class="interest-card selected relative group cursor-pointer bg-primary/5 border-2 border-primary p-5 rounded-xl flex flex-col items-center text-center gap-4 transition-all duration-200">
          <div class="check-mark absolute top-2 right-2 h-5 w-5 bg-primary rounded-full flex items-center justify-center">
            <span class="material-symbols-outlined text-white text-[14px] font-bold">check</span>
          </div>
          <div class="h-16 w-16 bg-primary/10 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-primary text-4xl">groups</span>
          </div>
          <p class="text-sm font-bold text-primary">Join Group Rides</p>
        </div>

        <!-- New Routes -->
        <div onclick="toggleInterest(this)" class="interest-card cursor-pointer bg-white border border-gray-200 p-5 rounded-xl flex flex-col items-center text-center gap-4 hover:border-primary/50 transition-all duration-200">
          <div class="check-mark hidden absolute top-2 right-2 h-5 w-5 bg-primary rounded-full items-center justify-center">
            <span class="material-symbols-outlined text-white text-[14px] font-bold">check</span>
          </div>
          <div class="h-16 w-16 bg-gray-50 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-gray-400 text-4xl">explore</span>
          </div>
          <p class="text-sm font-bold text-gray-700">New Routes</p>
        </div>

        <!-- Daily Commute -->
        <div onclick="toggleInterest(this)" class="interest-card cursor-pointer bg-white border border-gray-200 p-5 rounded-xl flex flex-col items-center text-center gap-4 hover:border-primary/50 transition-all duration-200">
          <div class="check-mark hidden absolute top-2 right-2 h-5 w-5 bg-primary rounded-full items-center justify-center">
            <span class="material-symbols-outlined text-white text-[14px] font-bold">check</span>
          </div>
          <div class="h-16 w-16 bg-gray-50 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-gray-400 text-4xl">commute</span>
          </div>
          <p class="text-sm font-bold text-gray-700">Daily Commute</p>
        </div>

        <!-- Tech & Gear -->
        <div onclick="toggleInterest(this)" class="interest-card cursor-pointer bg-white border border-gray-200 p-5 rounded-xl flex flex-col items-center text-center gap-4 hover:border-primary/50 transition-all duration-200">
          <div class="check-mark hidden absolute top-2 right-2 h-5 w-5 bg-primary rounded-full items-center justify-center">
            <span class="material-symbols-outlined text-white text-[14px] font-bold">check</span>
          </div>
          <div class="h-16 w-16 bg-gray-50 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-gray-400 text-4xl">electric_bolt</span>
          </div>
          <p class="text-sm font-bold text-gray-700">Tech & Gear</p>
        </div>

        <!-- Perks & Deals -->
        <div onclick="toggleInterest(this)" class="interest-card cursor-pointer bg-white border border-gray-200 p-5 rounded-xl flex flex-col items-center text-center gap-4 hover:border-primary/50 transition-all duration-200">
          <div class="check-mark hidden absolute top-2 right-2 h-5 w-5 bg-primary rounded-full items-center justify-center">
            <span class="material-symbols-outlined text-white text-[14px] font-bold">check</span>
          </div>
          <div class="h-16 w-16 bg-gray-50 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-gray-400 text-4xl">savings</span>
          </div>
          <p class="text-sm font-bold text-gray-700">Perks & Deals</p>
        </div>
      </div>

      <!-- Floating Info Pill -->
      <div class="fixed bottom-36 inset-x-0 flex justify-center px-6 z-10 pointer-events-none">
        <div class="bg-white/90 backdrop-blur-md p-3 px-4 rounded-full shadow-xl border border-primary/20 flex gap-3 items-center pointer-events-auto">
          <div class="bg-primary p-1.5 rounded-full flex items-center justify-center">
            <span class="material-symbols-outlined text-white text-xs">auto_awesome</span>
          </div>
          <p class="text-[12px] font-bold text-primary whitespace-nowrap">24 local events found for your interests</p>
        </div>
      </div>

      <!-- Bottom Buttons -->
      <div class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t border-gray-200 px-6 py-6 pb-10 flex gap-4">
        <button onclick="showProfileStep(2)" class="flex-1 bg-gray-100 text-gray-900 font-bold py-4 rounded-xl shadow-sm">
          Back
        </button>
        <button onclick="showProfileStep(4)" class="flex-[2] bg-primary text-white font-bold py-4 rounded-xl shadow-[0_4px_14px_0_rgba(107,33,168,0.39)] flex items-center justify-center gap-2">
          <span>Next Step</span>
          <span class="material-symbols-outlined text-lg">arrow_forward</span>
        </button>
      </div>
    </div>

    <!-- Step 4: Final Setup -->
    <div id="profileStep4" class="flex flex-col min-h-screen bg-[#FDFCFE] hidden">
      <!-- Header -->
      <div class="sticky top-0 z-20 flex items-center bg-[#FDFCFE]/90 backdrop-blur-md px-4 py-4 justify-between">
        <button onclick="showProfileStep(3)" class="flex items-center text-primary font-medium">
          <span class="material-symbols-outlined text-2xl">chevron_left</span>
          <span>Back</span>
        </button>
        <h2 class="text-base font-bold absolute left-1/2 -translate-x-1/2 font-display">Step 4 of 4</h2>
        <div class="w-16"></div>
      </div>

      <!-- Progress Dots -->
      <div class="flex w-full flex-row items-center justify-center gap-3 py-4">
        <div class="h-2 w-2 rounded-full bg-primary"></div>
        <div class="h-2 w-2 rounded-full bg-primary"></div>
        <div class="h-2 w-2 rounded-full bg-primary"></div>
        <div class="h-2 w-8 rounded-full bg-primary shadow-[0_0_8px_rgba(107,33,168,0.4)]"></div>
      </div>

      <div class="flex-1 overflow-y-auto pb-48">
        <!-- Title -->
        <div class="px-6 pt-2 pb-6 text-center">
          <h1 class="text-2xl font-bold tracking-tight mb-2 font-display">Final Setup</h1>
          <p class="text-gray-500 text-sm">Configure your preferences and community settings to complete your profile.</p>
        </div>

        <!-- Riding Frequency Section -->
        <div class="px-6 mb-6">
          <h3 class="text-base font-bold text-gray-900 mb-3">Riding Frequency</h3>
          <div class="flex gap-3">
            <button onclick="selectFrequency(this, 'daily')" class="freq-btn flex-1 py-4 rounded-xl font-bold transition-all border-2 border-primary bg-primary text-white shadow-lg shadow-primary/20">
              Daily
            </button>
            <button onclick="selectFrequency(this, 'weekly')" class="freq-btn flex-1 py-4 rounded-xl font-bold transition-all border-2 border-gray-200 bg-white text-gray-700 hover:border-primary/50">
              Weekly
            </button>
          </div>
        </div>

        <!-- Preferred Areas Section -->
        <div class="px-6 mb-6">
          <h3 class="text-base font-bold text-gray-900 mb-3">Preferred Areas</h3>
          <div class="flex flex-wrap gap-3">
            <button onclick="toggleAreaTag(this)" class="area-tag selected px-5 py-2.5 rounded-full font-medium text-sm transition-all bg-primary text-white">
              🌊 Ocean
            </button>
            <button onclick="toggleAreaTag(this)" class="area-tag selected px-5 py-2.5 rounded-full font-medium text-sm transition-all bg-primary text-white">
              🌳 Park
            </button>
            <button onclick="toggleAreaTag(this)" class="area-tag px-5 py-2.5 rounded-full font-medium text-sm transition-all bg-gray-100 text-gray-700 hover:bg-primary/10">
              🏙️ City
            </button>
            <button onclick="toggleAreaTag(this)" class="area-tag px-5 py-2.5 rounded-full font-medium text-sm transition-all bg-gray-100 text-gray-700 hover:bg-primary/10">
              📚 Education
            </button>
            <button onclick="toggleAreaTag(this)" class="area-tag px-5 py-2.5 rounded-full font-medium text-sm transition-all bg-gray-100 text-gray-700 hover:bg-primary/10">
              🛠️ Workshop
            </button>
          </div>
        </div>

        <!-- Privacy & Visibility Section -->
        <div class="px-6 mb-6">
          <h3 class="text-base font-bold text-gray-900 mb-3">Privacy & Visibility</h3>
          <div class="space-y-3">
            <!-- Public Profile Toggle -->
            <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-200 shadow-sm">
              <div class="flex items-center gap-3">
                <div class="size-10 bg-primary/10 rounded-full flex items-center justify-center">
                  <span class="material-symbols-outlined text-primary text-xl">person</span>
                </div>
                <div>
                  <p class="font-semibold text-gray-900">Public Profile</p>
                  <p class="text-xs text-gray-500">Allow others to see your profile</p>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" checked class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>

            <!-- Share Ride Stats Toggle -->
            <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-200 shadow-sm">
              <div class="flex items-center gap-3">
                <div class="size-10 bg-primary/10 rounded-full flex items-center justify-center">
                  <span class="material-symbols-outlined text-primary text-xl">bar_chart</span>
                </div>
                <div>
                  <p class="font-semibold text-gray-900">Share Ride Stats</p>
                  <p class="text-xs text-gray-500">Show your cycling achievements</p>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>
          </div>
        </div>

        <!-- Ready Banner -->
        <div class="px-6 mt-4">
          <div class="bg-accent-green/10 border border-accent-green/20 p-4 rounded-xl flex items-center gap-4">
            <div class="h-10 w-10 bg-accent-green rounded-lg flex items-center justify-center shrink-0">
              <span class="material-symbols-outlined text-white text-xl">check_circle</span>
            </div>
            <div>
              <p class="text-sm font-bold text-accent-green">You're all set!</p>
              <p class="text-[11px] text-accent-green/70">Complete your profile to join the community</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Buttons -->
      <div class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-gray-100 px-6 py-6 pb-10">
        <div class="flex flex-col gap-3">
          <button onclick="completeProfile()" class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/25 flex items-center justify-center gap-2 active:scale-[0.98] transition-all">
            <span class="material-symbols-outlined text-lg">check_circle</span>
            <span>Complete Profile</span>
          </button>
          <button onclick="showWelcomeHub()" class="w-full bg-gray-100 text-gray-700 font-bold py-4 rounded-xl active:bg-gray-200 transition-colors">
            Save & Finish Later
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- ============================================
       COMMUNITY HUB - WAZE-LIKE FEATURES
       ============================================ -->
  <div id="communityHub" class="fixed inset-0 z-30 bg-background-light flex flex-col hidden">
    <div class="relative flex h-full min-h-screen w-full max-w-[430px] mx-auto flex-col bg-background-light overflow-hidden shadow-2xl">

      <!-- Header -->
      <header class="sticky top-0 z-50 bg-background-light/95 backdrop-blur-md px-6 pt-12 pb-4 border-b border-gray-100">
        <div class="flex items-center justify-between mb-3">
          <button onclick="showWelcomeHub()" class="flex items-center gap-1 text-primary font-medium">
            <span class="material-symbols-outlined text-2xl">chevron_left</span>
          </button>
          <h1 class="text-xl font-bold font-display text-[#131118]">Community Hub</h1>
          <button onclick="openReportModal()" class="bg-red-500 p-2 rounded-full flex items-center justify-center shadow-lg shadow-red-500/30">
            <span class="material-symbols-outlined text-white text-xl">warning</span>
          </button>
        </div>

        <!-- Tab Navigation -->
        <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-1">
          <button onclick="showHubTab('feed')" class="hub-tab active px-4 py-2 rounded-full text-sm font-bold bg-primary text-white whitespace-nowrap transition-all">
            Feed
          </button>
          <button onclick="showHubTab('reports')" class="hub-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 whitespace-nowrap transition-all">
            ⚠️ Reports
          </button>
          <button onclick="showHubTab('infrastructure')" class="hub-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 whitespace-nowrap transition-all">
            🚴 Infrastructure
          </button>
          <button onclick="showHubTab('charging')" class="hub-tab px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-600 whitespace-nowrap transition-all">
            ⚡ Charging
          </button>
        </div>
      </header>

      <!-- Tab Content -->
      <div class="flex-1 overflow-y-auto pb-28">

        <!-- FEED TAB -->
        <div id="hubFeed" class="hub-content px-4 py-4 space-y-4">
          <!-- Pinned Alert -->
          <div class="bg-gradient-to-r from-red-500 to-orange-500 p-4 rounded-2xl text-white">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-outlined">campaign</span>
              <span class="font-bold text-sm">LIVE ALERT</span>
            </div>
            <p class="text-sm opacity-90">Glass debris reported on Bourke Street bike lane near Oxford St. Use caution!</p>
            <div class="flex items-center justify-between mt-3">
              <span class="text-xs opacity-70">12 mins ago • 23 confirmations</span>
              <button class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold">Confirm</button>
            </div>
          </div>

          <!-- Feed Items -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-500 to-pink-500 flex items-center justify-center">
                <span class="text-white text-sm font-bold">AM</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-1">
                  <span class="font-bold text-[#131118]">Alex M.</span>
                  <span class="material-symbols-outlined text-primary text-sm">verified</span>
                </div>
                <span class="text-xs text-gray-500">Eastern Suburbs • 2h ago</span>
              </div>
            </div>
            <p class="text-sm text-gray-700 mb-3">Great protected lane on Bourke St, perfect for morning commutes! The new infrastructure is really making a difference. 🚴‍♂️</p>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-gray-500 hover:text-green-500 transition-colors">
                  <span class="material-symbols-outlined text-xl">thumb_up</span>
                  <span class="text-sm font-bold">45</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500 hover:text-red-500 transition-colors">
                  <span class="material-symbols-outlined text-xl">thumb_down</span>
                  <span class="text-sm font-bold">2</span>
                </button>
                <button class="flex items-center gap-1 text-gray-500">
                  <span class="material-symbols-outlined text-xl">chat_bubble</span>
                  <span class="text-sm font-bold">8</span>
                </button>
              </div>
              <button class="text-primary text-sm font-bold">Reply</button>
            </div>
          </div>

          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-green-500 to-teal-500 flex items-center justify-center">
                <span class="text-white text-sm font-bold">SK</span>
              </div>
              <div class="flex-1">
                <span class="font-bold text-[#131118]">Sam K.</span>
                <span class="text-xs text-gray-500 block">Parramatta • 4h ago</span>
              </div>
            </div>
            <p class="text-sm text-gray-700 mb-3">Just joined the Parra-Bike Hub group ride yesterday. Amazing community! Really welcoming for new riders. 💪</p>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-gray-500 hover:text-green-500 transition-colors">
                  <span class="material-symbols-outlined text-xl">thumb_up</span>
                  <span class="text-sm font-bold">32</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500 hover:text-red-500 transition-colors">
                  <span class="material-symbols-outlined text-xl">thumb_down</span>
                  <span class="text-sm font-bold">0</span>
                </button>
                <button class="flex items-center gap-1 text-gray-500">
                  <span class="material-symbols-outlined text-xl">chat_bubble</span>
                  <span class="text-sm font-bold">5</span>
                </button>
              </div>
              <button class="text-primary text-sm font-bold">Reply</button>
            </div>
          </div>

          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-500 flex items-center justify-center">
                <span class="text-white text-sm font-bold">JT</span>
              </div>
              <div class="flex-1">
                <span class="font-bold text-[#131118]">Jamie T.</span>
                <span class="text-xs text-gray-500 block">Northern Beaches • 6h ago</span>
              </div>
            </div>
            <p class="text-sm text-gray-700 mb-3">PSA: The new veloway section from Dee Why is now open! Smooth ride all the way to Narrabeen. Game changer for beach commuters 🏖️</p>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-green-500">
                  <span class="material-symbols-outlined text-xl">thumb_up</span>
                  <span class="text-sm font-bold">89</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500 hover:text-red-500 transition-colors">
                  <span class="material-symbols-outlined text-xl">thumb_down</span>
                  <span class="text-sm font-bold">1</span>
                </button>
                <button class="flex items-center gap-1 text-gray-500">
                  <span class="material-symbols-outlined text-xl">chat_bubble</span>
                  <span class="text-sm font-bold">14</span>
                </button>
              </div>
              <button class="text-primary text-sm font-bold">Reply</button>
            </div>
          </div>
        </div>

        <!-- REPORTS TAB -->
        <div id="hubReports" class="hub-content px-4 py-4 space-y-3 hidden">
          <div class="flex items-center justify-between mb-2">
            <h2 class="font-bold text-lg">Active Reports Near You</h2>
            <span class="text-xs text-gray-500">Last updated: 3 mins ago</span>
          </div>

          <!-- Near Miss Report -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-red-500">
            <div class="flex items-start gap-3">
              <div class="bg-red-100 p-2 rounded-xl">
                <span class="text-2xl">⚠️</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-bold text-[#131118]">Near Miss</span>
                  <span class="text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700 font-bold">HIGH</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">Close pass by delivery truck near King St intersection. Driver didn't check bike lane.</p>
                <div class="flex items-center gap-4 text-xs text-gray-500">
                  <span>📍 King St & George St</span>
                  <span>🕐 25 mins ago</span>
                </div>
              </div>
            </div>
            <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
              <div class="flex items-center gap-3">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-gray-500 hover:text-green-500">
                  <span class="material-symbols-outlined">thumb_up</span>
                  <span class="font-bold">14</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500 hover:text-red-500">
                  <span class="material-symbols-outlined">thumb_down</span>
                  <span class="font-bold">1</span>
                </button>
              </div>
              <span class="text-xs text-green-600 font-bold">✓ 12 confirmations</span>
            </div>
          </div>

          <!-- Glass Report -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-orange-500">
            <div class="flex items-start gap-3">
              <div class="bg-orange-100 p-2 rounded-xl">
                <span class="text-2xl">🔶</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-bold text-[#131118]">Glass on Road</span>
                  <span class="text-xs px-2 py-0.5 rounded-full bg-orange-100 text-orange-700 font-bold">MEDIUM</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">Broken glass covering bike lane for about 20m. Council notified.</p>
                <div class="flex items-center gap-4 text-xs text-gray-500">
                  <span>📍 Bourke St near Oxford</span>
                  <span>🕐 1 hour ago</span>
                </div>
              </div>
            </div>
            <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
              <div class="flex items-center gap-3">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-green-500">
                  <span class="material-symbols-outlined">thumb_up</span>
                  <span class="font-bold">23</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500">
                  <span class="material-symbols-outlined">thumb_down</span>
                  <span class="font-bold">0</span>
                </button>
              </div>
              <span class="text-xs text-blue-600 font-bold">🔄 Under review</span>
            </div>
          </div>

          <!-- Construction Report -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-yellow-500">
            <div class="flex items-start gap-3">
              <div class="bg-yellow-100 p-2 rounded-xl">
                <span class="text-2xl">🚧</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-bold text-[#131118]">Roadworks</span>
                  <span class="text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-bold">VERIFIED</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">Bike lane blocked near Town Hall. Use alternate route via Pitt St.</p>
                <div class="flex items-center gap-4 text-xs text-gray-500">
                  <span>📍 George St, Town Hall</span>
                  <span>🕐 3 hours ago</span>
                </div>
              </div>
            </div>
            <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
              <div class="flex items-center gap-3">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-green-500">
                  <span class="material-symbols-outlined">thumb_up</span>
                  <span class="font-bold">31</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500">
                  <span class="material-symbols-outlined">thumb_down</span>
                  <span class="font-bold">1</span>
                </button>
              </div>
              <span class="text-xs text-green-600 font-bold">✓ Official report</span>
            </div>
          </div>

          <!-- Pothole Report -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-gray-400">
            <div class="flex items-start gap-3">
              <div class="bg-gray-100 p-2 rounded-xl">
                <span class="text-2xl">🕳️</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-bold text-[#131118]">Pothole</span>
                  <span class="text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-bold">RESOLVED</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">Large pothole patched by council. Safe to ride now!</p>
                <div class="flex items-center gap-4 text-xs text-gray-500">
                  <span>📍 Cleveland St</span>
                  <span>🕐 Fixed yesterday</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- INFRASTRUCTURE TAB -->
        <div id="hubInfrastructure" class="hub-content px-4 py-4 space-y-3 hidden">
          <div class="flex items-center justify-between mb-2">
            <h2 class="font-bold text-lg">Rate Infrastructure</h2>
            <span class="text-xs text-primary font-bold">Your votes matter!</span>
          </div>

          <!-- Good Infrastructure -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl">✨</span>
              <div class="flex-1">
                <h3 class="font-bold text-[#131118]">Bourke Street Cycleway</h3>
                <p class="text-xs text-gray-500">Protected bike lane • Eastern Suburbs</p>
              </div>
              <div class="flex items-center gap-1 bg-green-100 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-green-600 text-sm">thumb_up</span>
                <span class="text-xs font-bold text-green-700">92%</span>
              </div>
            </div>
            <p class="text-sm text-gray-600 mb-3">Fully separated bike lane with barriers. Well maintained and clearly marked.</p>
            <div class="flex items-center gap-2 mb-3 flex-wrap">
              <span class="text-xs px-2 py-1 rounded-full bg-primary/10 text-primary">Protected</span>
              <span class="text-xs px-2 py-1 rounded-full bg-primary/10 text-primary">Well-lit</span>
              <span class="text-xs px-2 py-1 rounded-full bg-primary/10 text-primary">Smooth surface</span>
            </div>
            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
              <div class="flex items-center gap-4">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-green-50 text-green-600 font-bold text-sm hover:bg-green-100 transition-colors">
                  <span class="material-symbols-outlined text-lg">thumb_up</span>
                  <span>Works Great</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-100 text-gray-500 font-bold text-sm hover:bg-red-50 hover:text-red-500 transition-colors">
                  <span class="material-symbols-outlined text-lg">thumb_down</span>
                  <span>Needs Work</span>
                </button>
              </div>
              <button class="text-primary font-bold text-sm">Details</button>
            </div>
          </div>

          <!-- Mixed Infrastructure -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl">🛤️</span>
              <div class="flex-1">
                <h3 class="font-bold text-[#131118]">King Street Bike Lane</h3>
                <p class="text-xs text-gray-500">Painted lane • Newtown</p>
              </div>
              <div class="flex items-center gap-1 bg-yellow-100 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-yellow-600 text-sm">balance</span>
                <span class="text-xs font-bold text-yellow-700">68%</span>
              </div>
            </div>
            <p class="text-sm text-gray-600 mb-3">Paint-only lane, often blocked by parked cars and delivery vehicles. Door zone risk.</p>
            <div class="flex items-center gap-2 mb-3 flex-wrap">
              <span class="text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-700">Painted only</span>
              <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-700">Door zone</span>
              <span class="text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-700">Often blocked</span>
            </div>
            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
              <div class="flex items-center gap-4">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-100 text-gray-500 font-bold text-sm hover:bg-green-50 hover:text-green-600 transition-colors">
                  <span class="material-symbols-outlined text-lg">thumb_up</span>
                  <span>Works Great</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-red-50 text-red-500 font-bold text-sm hover:bg-red-100 transition-colors">
                  <span class="material-symbols-outlined text-lg">thumb_down</span>
                  <span>Needs Work</span>
                </button>
              </div>
              <button class="text-primary font-bold text-sm">Details</button>
            </div>
          </div>

          <!-- Poor Infrastructure -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl">⚠️</span>
              <div class="flex-1">
                <h3 class="font-bold text-[#131118]">Broadway Corridor</h3>
                <p class="text-xs text-gray-500">Shared lane • Glebe</p>
              </div>
              <div class="flex items-center gap-1 bg-red-100 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-red-600 text-sm">thumb_down</span>
                <span class="text-xs font-bold text-red-700">34%</span>
              </div>
            </div>
            <p class="text-sm text-gray-600 mb-3">No dedicated infrastructure. Sharrow only. High traffic volume makes cycling stressful.</p>
            <div class="flex items-center gap-2 mb-3 flex-wrap">
              <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-700">No protection</span>
              <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-700">High traffic</span>
              <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-700">Stressful</span>
            </div>
            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
              <div class="flex items-center gap-4">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-100 text-gray-500 font-bold text-sm hover:bg-green-50 hover:text-green-600 transition-colors">
                  <span class="material-symbols-outlined text-lg">thumb_up</span>
                  <span>Works Great</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-red-50 text-red-500 font-bold text-sm">
                  <span class="material-symbols-outlined text-lg">thumb_down</span>
                  <span>Needs Work</span>
                </button>
              </div>
              <button class="text-primary font-bold text-sm">Details</button>
            </div>
          </div>
        </div>

        <!-- CHARGING TAB -->
        <div id="hubCharging" class="hub-content px-4 py-4 space-y-3 hidden">
          <div class="flex items-center justify-between mb-2">
            <h2 class="font-bold text-lg">E-Bike Charging Stations</h2>
            <span class="text-xs text-gray-500">Live availability</span>
          </div>

          <!-- Charging Station 1 -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex justify-between items-start mb-3">
              <div class="flex items-center gap-3">
                <span class="text-3xl">⚡</span>
                <div>
                  <h3 class="font-bold text-[#131118]">Circular Quay Hub</h3>
                  <p class="text-xs text-gray-500">Alfred St, Circular Quay</p>
                </div>
              </div>
              <span class="text-sm px-3 py-1 rounded-full bg-green-100 text-green-700 font-bold">8/12 free</span>
            </div>
            <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-3">
              <div class="h-full bg-green-500 rounded-full" style="width: 66%"></div>
            </div>
            <div class="flex items-center gap-2 mb-3 flex-wrap">
              <span class="text-xs px-2 py-1 rounded-full bg-gray-100">☕ Cafe</span>
              <span class="text-xs px-2 py-1 rounded-full bg-gray-100">🚿 Showers</span>
              <span class="text-xs px-2 py-1 rounded-full bg-gray-100">🔒 Secure</span>
            </div>
            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-yellow-500">star</span>
                <span class="font-bold">4.7</span>
                <span class="text-xs text-gray-500">(89 reviews)</span>
              </div>
              <div class="flex items-center gap-3">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-gray-500 hover:text-green-500">
                  <span class="material-symbols-outlined">thumb_up</span>
                  <span class="font-bold text-sm">156</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500 hover:text-red-500">
                  <span class="material-symbols-outlined">thumb_down</span>
                  <span class="font-bold text-sm">12</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Charging Station 2 -->
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex justify-between items-start mb-3">
              <div class="flex items-center gap-3">
                <span class="text-3xl">⚡</span>
                <div>
                  <h3 class="font-bold text-[#131118]">Central Station Plaza</h3>
                  <p class="text-xs text-gray-500">Eddy Ave, Haymarket</p>
                </div>
              </div>
              <span class="text-sm px-3 py-1 rounded-full bg-orange-100 text-orange-700 font-bold">2/8 free</span>
            </div>
            <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-3">
              <div class="h-full bg-orange-500 rounded-full" style="width: 25%"></div>
            </div>
            <div class="flex items-center gap-2 mb-3 flex-wrap">
              <span class="text-xs px-2 py-1 rounded-full bg-gray-100">🔧 Repair</span>
              <span class="text-xs px-2 py-1 rounded-full bg-gray-100">🔒 Secure</span>
            </div>
            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
              <div class="flex items-center gap-1">
                <span class="material-symbols-outlined text-yellow-500">star</span>
                <span class="font-bold">4.3</span>
                <span class="text-xs text-gray-500">(62 reviews)</span>
              </div>
              <div class="flex items-center gap-3">
                <button onclick="voteItem(this, 'up')" class="flex items-center gap-1 text-gray-500 hover:text-green-500">
                  <span class="material-symbols-outlined">thumb_up</span>
                  <span class="font-bold text-sm">98</span>
                </button>
                <button onclick="voteItem(this, 'down')" class="flex items-center gap-1 text-gray-500 hover:text-red-500">
                  <span class="material-symbols-outlined">thumb_down</span>
                  <span class="font-bold text-sm">8</span>
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Floating Add Post Button -->
      <button onclick="showAddPostModal()" class="fixed bottom-28 right-6 bg-primary p-4 rounded-full shadow-xl shadow-primary/40 text-white flex items-center justify-center z-40 active:scale-95 transition-transform max-w-[430px]">
        <span class="material-symbols-outlined text-2xl">add</span>
      </button>

      <!-- Bottom Tab Bar -->
      <nav class="fixed bottom-0 w-full max-w-[430px] bg-white/95 backdrop-blur-lg border-t border-gray-100 px-8 pt-3 pb-8 flex justify-between items-center z-50" style="box-shadow: 0 -2px 10px rgba(0,0,0,0.05);">
        <button onclick="showWelcomeHub()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl">home</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Home</span>
        </button>
        <button class="flex flex-col items-center gap-1 text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl font-bold">groups</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Community</span>
        </button>
        <button onclick="openReportModal()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-red-500 transition-colors">
          <span class="material-symbols-outlined text-2xl">warning</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Report</span>
        </button>
        <button onclick="showScreen('findEbike')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-primary transition-colors">
          <span class="material-symbols-outlined text-2xl">electric_bike</span>
          <span class="text-[10px] font-bold uppercase tracking-wider">Rides</span>
        </button>
      </nav>

    </div>
  </div>

  <!-- ============================================
       REPORT ISSUE MODAL
       ============================================ -->
  <div id="reportModal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden">
    <div class="absolute inset-0 bg-black/50" onclick="closeReportModal()"></div>
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 relative z-10">
      <button onclick="closeReportModal()" class="absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
        <span class="material-symbols-outlined text-gray-500">close</span>
      </button>

      <h2 class="text-xl font-bold mb-4">Report an Issue</h2>

      <div class="grid grid-cols-4 gap-2 mb-6">
        <button onclick="selectReportType(this, 'glass')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-orange-50 hover:border-orange-300 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">🔶</span>
          <span class="text-[10px] font-medium">Glass</span>
        </button>
        <button onclick="selectReportType(this, 'pothole')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-gray-100 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">🕳️</span>
          <span class="text-[10px] font-medium">Pothole</span>
        </button>
        <button onclick="selectReportType(this, 'construction')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-yellow-50 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">🚧</span>
          <span class="text-[10px] font-medium">Works</span>
        </button>
        <button onclick="selectReportType(this, 'hazard')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-red-50 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">⚠️</span>
          <span class="text-[10px] font-medium">Hazard</span>
        </button>
      </div>

      <div class="grid grid-cols-4 gap-2 mb-6">
        <button onclick="selectReportType(this, 'nearmiss')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-red-50 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">🚗</span>
          <span class="text-[10px] font-medium">Near Miss</span>
        </button>
        <button onclick="selectReportType(this, 'blocked')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-orange-50 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">🚫</span>
          <span class="text-[10px] font-medium">Blocked</span>
        </button>
        <button onclick="selectReportType(this, 'lighting')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-gray-100 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">💡</span>
          <span class="text-[10px] font-medium">Lighting</span>
        </button>
        <button onclick="selectReportType(this, 'good')" class="report-type-btn flex flex-col items-center p-3 rounded-xl bg-gray-50 hover:bg-green-50 border-2 border-transparent transition-all">
          <span class="text-2xl mb-1">✨</span>
          <span class="text-[10px] font-medium">Good Infra</span>
        </button>
      </div>

      <textarea id="reportDescription" class="w-full p-3 rounded-xl bg-gray-50 border-2 border-gray-200 focus:border-primary focus:ring-0 text-sm placeholder-gray-400 resize-none transition-colors" rows="3" placeholder="Describe the issue (optional)..."></textarea>

      <button onclick="submitReport()" class="w-full mt-4 bg-primary text-white font-bold py-4 rounded-2xl shadow-lg shadow-primary/30 hover:bg-primary/90 transition-colors flex items-center justify-center gap-2">
        <span class="material-symbols-outlined">send</span>
        Submit Report
      </button>
    </div>
  </div>

  <!-- ============================================
       SCREEN 11: AI ROUTE PLANNER
       ============================================ -->
  <div id="aiRoutePlanner" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full w-full max-w-[430px] flex-col overflow-hidden shadow-2xl bg-background-light">

      <!-- Top Nav -->
      <nav class="h-14 px-4 flex items-center justify-between border-b border-primary/10 bg-white z-50">
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
            <span class="material-icons-round text-white text-xl">directions_bike</span>
          </div>
          <span class="font-bold text-lg tracking-tight font-display">Micro2Move</span>
        </div>
        <div class="flex items-center gap-3">
          <button class="w-9 h-9 flex items-center justify-center rounded-full bg-primary/10 text-primary">
            <span class="material-icons-round text-lg">notifications_active</span>
          </button>
          <div class="w-8 h-8 rounded-full overflow-hidden border-2 border-primary bg-primary/20 flex items-center justify-center">
            <span class="material-icons-round text-primary text-lg">person</span>
          </div>
        </div>
      </nav>

      <!-- Map Area (top 40%) -->
      <div class="relative" style="height: 38%;">
        <div id="aiPlannerMap" class="w-full h-full bg-slate-200"></div>

        <!-- Map Controls -->
        <div class="absolute top-4 right-4 flex flex-col gap-2">
          <button class="w-10 h-10 bg-white rounded-xl shadow-lg flex items-center justify-center text-slate-600">
            <span class="material-icons-round text-lg">layers</span>
          </button>
          <button onclick="centerAiMap()" class="w-10 h-10 bg-white rounded-xl shadow-lg flex items-center justify-center text-primary">
            <span class="material-icons-round text-lg">my_location</span>
          </button>
        </div>

        <!-- Legend -->
        <div class="absolute bottom-4 right-4 p-3 bg-white/90 backdrop-blur-sm rounded-xl shadow-sm border border-white/50 text-[10px] font-medium space-y-1.5">
          <div class="flex items-center gap-2">
            <span class="w-3 h-1 bg-primary rounded-full"></span>
            <span class="text-slate-600">Separated</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-1 bg-blue-500 rounded-full"></span>
            <span class="text-slate-600">Shared</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-1 bg-orange-500 rounded-full"></span>
            <span class="text-slate-600">On-road</span>
          </div>
        </div>
      </div>

      <!-- Bottom Sheet -->
      <div class="flex-1 bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col -mt-4 z-10 relative">
        <div class="w-full py-3 flex justify-center">
          <div class="w-12 h-1.5 bg-slate-200 rounded-full"></div>
        </div>

        <div class="flex-1 overflow-y-auto px-5 pb-28">
          <header class="mb-5">
            <h1 class="text-2xl font-bold text-slate-900 font-display">Plan your ride</h1>
            <p class="text-sm text-slate-500 mt-1">Sydney's community cycling companion.</p>
          </header>

          <!-- AI Description Prompt -->
          <div class="mb-5">
            <label class="block text-xs font-semibold text-primary uppercase tracking-wider mb-2">Description</label>
            <textarea id="aiRoutePrompt" class="w-full bg-background-light border-none rounded-xl p-4 text-sm focus:ring-2 focus:ring-primary placeholder:text-slate-400" placeholder="e.g., 'A coastal ride with many bubblers'" rows="2"></textarea>
          </div>

          <!-- Scenery & Utilities -->
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-semibold text-primary uppercase tracking-wider mb-2">Scenery</label>
              <select id="aiScenery" class="w-full bg-background-light border-none rounded-xl py-3 px-4 text-sm font-medium focus:ring-2 focus:ring-primary appearance-none">
                <option disabled selected value="">Select...</option>
                <option value="coastal">Coastal</option>
                <option value="parkland">Parkland</option>
                <option value="urban">Urban</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-semibold text-primary uppercase tracking-wider mb-2">Utilities</label>
              <select id="aiUtilities" class="w-full bg-background-light border-none rounded-xl py-3 px-4 text-sm font-medium focus:ring-2 focus:ring-primary appearance-none">
                <option disabled selected value="">Select...</option>
                <option value="water">Water Bubblers</option>
                <option value="bathrooms">Public Bathrooms</option>
                <option value="charging">Charging Stations</option>
              </select>
            </div>
          </div>

          <!-- Start Location -->
          <div class="mb-5">
            <div class="relative">
              <div class="absolute left-3 top-1/2 -translate-y-1/2 text-primary">
                <span class="material-icons-round text-sm">radio_button_checked</span>
              </div>
              <input id="aiStartLocation" class="w-full pl-10 pr-12 py-3 bg-background-light border-none rounded-xl text-sm font-medium" type="text" value="Circular Quay, Sydney"/>
              <button class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">
                <span class="material-icons-round text-lg">gps_fixed</span>
              </button>
            </div>
          </div>

          <!-- Target Distance -->
          <div class="mb-6">
            <div class="flex justify-between items-end mb-3">
              <label class="text-xs font-semibold text-primary uppercase tracking-wider">Target Distance</label>
              <span id="distanceDisplay" class="text-xl font-bold text-slate-800">25 <span class="text-sm font-normal text-slate-400">km</span></span>
            </div>
            <input id="distanceSlider" class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-primary" max="80" min="5" type="range" value="25" oninput="document.getElementById('distanceDisplay').innerHTML = this.value + ' <span class=\'text-sm font-normal text-slate-400\'>km</span>'"/>
            <div class="flex justify-between mt-2 text-[10px] text-slate-400 font-medium">
              <span>5 km</span>
              <span>80 km</span>
            </div>
          </div>

          <!-- Ride Type -->
          <div class="mb-6">
            <label class="block text-xs font-semibold text-primary uppercase tracking-wider mb-3">Ride Type</label>
            <div class="flex gap-2 overflow-x-auto hide-scrollbar">
              <button onclick="selectRideType(this)" class="flex-none px-5 py-2.5 rounded-full bg-primary text-white text-sm font-medium shadow-md shadow-primary/20">Commute</button>
              <button onclick="selectRideType(this)" class="flex-none px-5 py-2.5 rounded-full bg-background-light text-slate-600 text-sm font-medium">Training</button>
              <button onclick="selectRideType(this)" class="flex-none px-5 py-2.5 rounded-full bg-background-light text-slate-600 text-sm font-medium">Cruise</button>
              <button onclick="selectRideType(this)" class="flex-none px-5 py-2.5 rounded-full bg-background-light text-slate-600 text-sm font-medium">Family</button>
            </div>
          </div>

          <!-- Preference Sliders -->
          <div class="space-y-5 mb-8">
            <div>
              <div class="flex justify-between text-xs font-medium mb-2">
                <span class="text-slate-500">Safety Priority</span>
                <span class="text-primary font-bold">High</span>
              </div>
              <input id="safetySlider" class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-primary" type="range" value="90"/>
            </div>
            <div>
              <div class="flex justify-between text-xs font-medium mb-2">
                <span class="text-slate-500">Maximum Shade</span>
                <span class="text-slate-400">Neutral</span>
              </div>
              <input class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-primary" type="range" value="50"/>
            </div>
            <div>
              <div class="flex justify-between text-xs font-medium mb-2">
                <span class="text-slate-500">Hills Frequency</span>
                <span class="text-orange-400">Avoid</span>
              </div>
              <input class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-orange-400" type="range" value="20"/>
            </div>
            <div>
              <div class="flex justify-between text-xs font-medium mb-2">
                <span class="text-slate-500">Community Boost</span>
                <span class="text-primary font-bold">Boosted</span>
              </div>
              <input class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-primary" type="range" value="80"/>
            </div>
          </div>
        </div>

        <!-- Generate Button -->
        <div class="absolute bottom-0 inset-x-0 p-5 bg-white/80 backdrop-blur-md border-t border-slate-100">
          <button onclick="generateAiRoute()" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center gap-3 active:scale-[0.98] transition-all shadow-lg shadow-primary/30">
            <span class="material-icons-round">route</span>
            <span>Generate Route</span>
          </button>
        </div>
      </div>

      <!-- Bottom Tab Bar -->
      <nav class="fixed bottom-0 w-full max-w-[430px] bg-white border-t border-slate-100 px-6 py-2 pb-6 flex items-center justify-around z-50">
        <button class="flex flex-col items-center gap-1 text-primary">
          <span class="material-icons-round text-2xl">explore</span>
          <span class="text-[10px] font-medium">Planner</span>
        </button>
        <button onclick="showScreen('aiRouteResults')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-icons-round text-2xl">map</span>
          <span class="text-[10px] font-medium">My Routes</span>
        </button>
        <button onclick="showScreen('communityReports')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-icons-round text-2xl">report_problem</span>
          <span class="text-[10px] font-medium">Reports</span>
        </button>
        <button onclick="showScreen('cyclingCommunities')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-icons-round text-2xl">settings</span>
          <span class="text-[10px] font-medium">Settings</span>
        </button>
      </nav>
    </div>
  </div>

  <!-- ============================================
       SCREEN 12: AI ROUTE RESULTS
       ============================================ -->
  <div id="aiRouteResults" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full w-full max-w-[430px] flex-col overflow-hidden shadow-2xl bg-background-light">

      <!-- Header -->
      <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md px-4 py-3 flex items-center justify-between border-b border-primary/10">
        <div class="flex items-center gap-3">
          <button onclick="showScreen('aiRoutePlanner')" class="p-2 hover:bg-primary/10 rounded-full transition-colors">
            <span class="material-icons-round text-primary">arrow_back</span>
          </button>
          <div>
            <h1 class="font-bold text-lg leading-tight font-display">Route Results</h1>
            <p class="text-xs text-slate-500 font-medium" id="routeSubtitle">Sydney CBD to Pyrmont</p>
          </div>
        </div>
        <button onclick="showScreen('aiRouteRefine')" class="p-2 bg-primary/10 rounded-full text-primary">
          <span class="material-icons-round text-sm">auto_awesome</span>
        </button>
      </header>

      <!-- Map Area (60%) -->
      <div class="relative flex-grow" style="height: 55%;">
        <div id="aiResultsMap" class="w-full h-full bg-slate-200"></div>

        <!-- Map Controls -->
        <div class="absolute right-4 top-4 flex flex-col gap-2">
          <button class="p-3 bg-white rounded-xl shadow-lg text-slate-700">
            <span class="material-icons-round">add</span>
          </button>
          <button class="p-3 bg-white rounded-xl shadow-lg text-slate-700">
            <span class="material-icons-round">remove</span>
          </button>
          <button class="p-3 bg-primary text-white rounded-xl shadow-lg mt-2">
            <span class="material-icons-round">my_location</span>
          </button>
        </div>
      </div>

      <!-- Bottom Sheet -->
      <section class="relative z-10 bg-white rounded-t-xl -mt-6 flex-shrink-0 flex flex-col overflow-hidden" style="height: 45%;">
        <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto my-3"></div>

        <div class="flex-1 overflow-y-auto px-5 pb-28">
          <!-- Route Quick Stats -->
          <div class="grid grid-cols-4 gap-2 mb-5">
            <div class="bg-primary/5 p-3 rounded-lg text-center">
              <p class="text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-1">Dist</p>
              <p id="routeDist" class="font-bold text-slate-900">8.4<span class="text-xs font-normal">km</span></p>
            </div>
            <div class="bg-primary/5 p-3 rounded-lg text-center">
              <p class="text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-1">Time</p>
              <p id="routeTime" class="font-bold text-slate-900">24<span class="text-xs font-normal">m</span></p>
            </div>
            <div class="bg-primary/5 p-3 rounded-lg text-center">
              <p class="text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-1">Ascent</p>
              <p id="routeAscent" class="font-bold text-slate-900">42<span class="text-xs font-normal">m</span></p>
            </div>
            <div class="bg-primary/10 p-3 rounded-lg text-center border border-primary/20">
              <p class="text-[10px] uppercase tracking-wider text-primary font-bold mb-1">Safety</p>
              <p id="routeSafety" class="font-bold text-primary">92%</p>
            </div>
          </div>

          <!-- Badges -->
          <div class="flex gap-2 mb-5 overflow-x-auto">
            <span class="flex-shrink-0 px-3 py-1.5 bg-green-100 text-green-600 rounded-full text-xs font-bold flex items-center gap-1">
              <span class="material-icons-round text-sm">verified_user</span> High Safety
            </span>
            <span class="flex-shrink-0 px-3 py-1.5 bg-sky-100 text-sky-600 rounded-full text-xs font-bold flex items-center gap-1">
              <span class="material-icons-round text-sm">wb_sunny</span> 80% Shaded
            </span>
            <span class="flex-shrink-0 px-3 py-1.5 bg-purple-100 text-purple-600 rounded-full text-xs font-bold flex items-center gap-1">
              <span class="material-icons-round text-sm">bolt</span> Efficient
            </span>
          </div>

          <!-- AI Insights -->
          <div class="bg-background-light p-4 rounded-xl border border-slate-200 mb-5">
            <div class="flex items-center gap-2 mb-2 text-primary">
              <span class="material-icons-round text-sm">auto_awesome</span>
              <h3 class="font-bold text-sm">AI Route Insight</h3>
            </div>
            <p id="aiInsightText" class="text-sm text-slate-600 leading-relaxed">
              This route prioritizes the <span class="text-green-600 font-semibold">Harbour Bridge Cycleway</span>. We've bypassed the steep Kent St incline in favor of Sussex St's protected lanes, adding only 2 mins while increasing shade by 40%.
            </p>
          </div>

          <!-- Route Segments -->
          <h3 class="font-bold text-slate-900 mb-4 flex items-center gap-2">
            <span class="material-icons-round text-primary text-xl">route</span>
            Route Details
          </h3>
          <div id="routeSegments" class="space-y-4">
            <!-- Segment 1 -->
            <div class="flex gap-4">
              <div class="flex flex-col items-center">
                <div class="w-3 h-3 rounded-full bg-green-500 ring-4 ring-green-500/20"></div>
                <div class="w-0.5 h-full bg-slate-200 mt-1"></div>
              </div>
              <div class="flex-grow pb-4 border-b border-slate-100">
                <div class="flex justify-between items-start">
                  <div>
                    <p class="font-bold text-slate-900 text-sm">Sussex Street Cycleway</p>
                    <p class="text-xs text-slate-500">2.1 km &bull; Protected Lane</p>
                  </div>
                  <span class="material-icons-round text-sky-400 text-lg">park</span>
                </div>
              </div>
            </div>
            <!-- Segment 2 -->
            <div class="flex gap-4">
              <div class="flex flex-col items-center">
                <div class="w-3 h-3 rounded-full bg-blue-500 ring-4 ring-blue-500/20"></div>
                <div class="w-0.5 h-full bg-slate-200 mt-1"></div>
              </div>
              <div class="flex-grow pb-4 border-b border-slate-100">
                <div class="flex justify-between items-start">
                  <div>
                    <p class="font-bold text-slate-900 text-sm">Pyrmont Bridge</p>
                    <p class="text-xs text-slate-500">0.4 km &bull; Shared Path</p>
                  </div>
                  <span class="material-icons-round text-amber-400 text-lg">groups</span>
                </div>
              </div>
            </div>
            <!-- Segment 3 -->
            <div class="flex gap-4">
              <div class="flex flex-col items-center">
                <div class="w-3 h-3 rounded-full bg-orange-500 ring-4 ring-orange-500/20"></div>
              </div>
              <div class="flex-grow">
                <div class="flex justify-between items-start">
                  <div>
                    <p class="font-bold text-slate-900 text-sm">Union Street</p>
                    <p class="text-xs text-slate-500">0.3 km &bull; Mixed Traffic</p>
                  </div>
                  <span class="material-icons-round text-red-500 text-lg">warning</span>
                </div>
                <div class="mt-2 p-2 bg-red-50 rounded-lg border border-red-100 flex items-center gap-2">
                  <span class="material-icons-round text-red-500 text-xs">info</span>
                  <span class="text-[10px] text-red-500 font-semibold uppercase">Caution: Heavy vehicle traffic during peak</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Bar -->
        <div class="absolute bottom-0 inset-x-0 bg-white border-t border-slate-200 px-4 pt-3 pb-8 z-50 flex items-center gap-3">
          <button class="flex-grow bg-primary text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 active:scale-95 transition-all shadow-lg shadow-primary/20">
            <span class="material-icons-round">directions_bike</span>
            Start Navigation
          </button>
          <button class="p-3 bg-slate-100 text-slate-700 rounded-xl">
            <span class="material-icons-round">bookmark_border</span>
          </button>
          <button class="p-3 bg-slate-100 text-slate-700 rounded-xl">
            <span class="material-icons-round">share</span>
          </button>
        </div>
      </section>
    </div>
  </div>

  <!-- ============================================
       SCREEN 13: COMMUNITY DATA & REPORTING
       ============================================ -->
  <div id="communityReports" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full w-full max-w-[430px] flex-col overflow-hidden shadow-2xl bg-background-light">

      <!-- Header -->
      <header class="bg-white border-b border-primary/10 px-4 py-3 flex items-center justify-between z-50">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white">
            <span class="material-icons-round text-lg">electric_scooter</span>
          </div>
          <h1 class="font-bold text-lg tracking-tight font-display">Micro<span class="text-primary">2</span>Move</h1>
        </div>
        <div class="flex items-center gap-3">
          <button class="text-slate-500">
            <span class="material-icons-round">search</span>
          </button>
          <div class="w-8 h-8 rounded-full bg-primary/20 border-2 border-primary/30 flex items-center justify-center">
            <span class="material-icons-round text-primary text-lg">person</span>
          </div>
        </div>
      </header>

      <!-- Category Tabs -->
      <nav class="bg-white px-4 py-2 border-b border-primary/5 flex items-center gap-2 overflow-x-auto">
        <button class="whitespace-nowrap px-4 py-2 rounded-full bg-primary text-white text-sm font-medium">Issues & damage</button>
        <button class="whitespace-nowrap px-4 py-2 rounded-full bg-slate-100 text-slate-600 text-sm font-medium">Bubblers & bathrooms</button>
        <button class="whitespace-nowrap px-4 py-2 rounded-full bg-slate-100 text-slate-600 text-sm font-medium">Shading feedback</button>
      </nav>

      <!-- Main Content -->
      <main class="flex-1 overflow-y-auto flex flex-col">
        <!-- Map Preview -->
        <section class="relative h-56 flex-shrink-0">
          <div id="reportsMap" class="w-full h-full bg-slate-200"></div>
          <div class="absolute bottom-4 right-4 flex flex-col gap-2">
            <button class="w-10 h-10 bg-white rounded-lg shadow-lg flex items-center justify-center text-slate-700">
              <span class="material-icons-round">layers</span>
            </button>
            <button class="w-10 h-10 bg-white rounded-lg shadow-lg flex items-center justify-center text-primary">
              <span class="material-icons-round">my_location</span>
            </button>
          </div>
        </section>

        <!-- Reports Section -->
        <section class="flex-1 bg-background-light p-4 space-y-4 rounded-t-xl -mt-4 z-10">
          <button class="w-full bg-primary text-white font-semibold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-primary/20 active:scale-[0.98] transition-all">
            <span class="material-icons-round">add_circle</span>
            Report an issue
          </button>

          <div class="flex items-center justify-between pt-2">
            <h3 class="font-bold text-slate-900">Nearby Reports</h3>
            <button class="text-primary text-xs font-semibold flex items-center gap-1">
              See all <span class="material-icons-round text-sm">arrow_forward</span>
            </button>
          </div>

          <!-- Report Items -->
          <div class="space-y-3">
            <!-- Report 1 - High -->
            <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center text-red-600">
                    <span class="material-icons-round">error_outline</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-sm">Deep Pothole</h4>
                    <p class="text-xs text-slate-500">Pyrmont St, Ultimo</p>
                  </div>
                </div>
                <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-red-100 text-red-700">High</span>
              </div>
              <div class="flex items-center justify-between mt-4 pt-3 border-t border-slate-100">
                <div class="flex gap-2">
                  <span class="text-[10px] px-2 py-0.5 rounded-full border border-primary text-primary font-medium">Open</span>
                  <span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-500">250m away</span>
                </div>
                <button class="text-slate-400"><span class="material-icons-round text-lg">more_horiz</span></button>
              </div>
            </div>

            <!-- Report 2 - Medium -->
            <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600">
                    <span class="material-icons-round">report_problem</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-sm">Glass on path</h4>
                    <p class="text-xs text-slate-500">George St Greenway</p>
                  </div>
                </div>
                <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-orange-100 text-orange-700">Med</span>
              </div>
              <div class="flex items-center justify-between mt-4 pt-3 border-t border-slate-100">
                <div class="flex gap-2">
                  <span class="text-[10px] px-2 py-0.5 rounded-full border border-primary text-primary font-medium">Open</span>
                  <span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-500">800m away</span>
                </div>
                <button class="text-slate-400"><span class="material-icons-round text-lg">more_horiz</span></button>
              </div>
            </div>

            <!-- Report 3 - Fixed -->
            <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm opacity-75">
              <div class="flex justify-between items-start mb-2">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600">
                    <span class="material-icons-round">check_circle</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-sm">Uneven pavement</h4>
                    <p class="text-xs text-slate-500">Pitt Street Mall</p>
                  </div>
                </div>
                <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-green-100 text-green-700">Low</span>
              </div>
              <div class="flex items-center justify-between mt-4 pt-3 border-t border-slate-100">
                <div class="flex gap-2">
                  <span class="text-[10px] px-2 py-0.5 rounded-full bg-green-600 text-white font-medium">Fixed</span>
                  <span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-500">1.2km away</span>
                </div>
                <button class="text-slate-400"><span class="material-icons-round text-lg">more_horiz</span></button>
              </div>
            </div>
          </div>

          <!-- AI Info Banner -->
          <div class="bg-primary/5 border border-primary/10 p-4 rounded-xl mt-4">
            <div class="flex gap-3">
              <span class="material-icons-round text-primary">info</span>
              <p class="text-xs text-slate-600 leading-relaxed">
                Micro2Move uses this data to improve <span class="font-semibold text-primary">AI routing</span> and avoid unsafe segments for your personalized routes.
              </p>
            </div>
          </div>

          <div class="h-20"></div>
        </section>
      </main>

      <!-- Bottom Nav -->
      <nav class="bg-white/80 backdrop-blur-xl border-t border-slate-200 px-6 py-3 pb-8 flex items-center justify-between fixed bottom-0 w-full max-w-[430px] z-50">
        <button onclick="showScreen('aiRoutePlanner')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-icons-round">directions_bike</span>
          <span class="text-[10px] font-medium">Routes</span>
        </button>
        <button class="flex flex-col items-center gap-1 text-primary">
          <span class="material-icons-round">analytics</span>
          <span class="text-[10px] font-medium">Reports</span>
        </button>
        <button onclick="showScreen('cyclingCommunities')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-icons-round">explore</span>
          <span class="text-[10px] font-medium">Explore</span>
        </button>
        <button onclick="showScreen('welcomeHub')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-icons-round">settings</span>
          <span class="text-[10px] font-medium">Settings</span>
        </button>
      </nav>
    </div>
  </div>

  <!-- ============================================
       SCREEN 14: AI ROUTE REFINEMENT
       ============================================ -->
  <div id="aiRouteRefine" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="relative flex h-full w-full max-w-[430px] flex-col overflow-hidden shadow-2xl">

      <!-- Map Background -->
      <div class="absolute inset-0 z-0">
        <div id="refineMap" class="w-full h-full bg-slate-200"></div>
        <!-- Top controls over map -->
        <div class="absolute top-12 left-4 right-4 flex justify-between items-start pointer-events-none z-10">
          <button onclick="showScreen('aiRouteResults')" class="bg-white p-2 rounded-full shadow-lg pointer-events-auto">
            <span class="material-icons-round text-primary">arrow_back</span>
          </button>
          <div class="bg-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 pointer-events-auto">
            <span class="material-icons-round text-primary text-sm">search</span>
            <span class="text-sm font-medium text-slate-700">Route Refinement</span>
          </div>
        </div>
      </div>

      <!-- AI Refinement Drawer -->
      <div class="absolute inset-x-0 bottom-0 z-10 flex flex-col bg-white rounded-t-xl shadow-2xl border-t border-slate-200" style="height: 82%;">
        <!-- Drag Handle -->
        <div class="flex flex-col items-center pt-3 pb-2">
          <div class="w-12 h-1.5 bg-slate-200 rounded-full mb-3"></div>
          <h1 class="text-xl font-bold text-slate-800 px-6 w-full font-display">Refine this ride with AI</h1>
        </div>

        <div class="flex-1 overflow-y-auto px-6 pb-28">
          <!-- Compact Summary -->
          <div class="bg-primary/5 border border-primary/20 rounded-lg p-4 mb-5">
            <div class="grid grid-cols-4 gap-2 text-center">
              <div class="flex flex-col items-center">
                <span class="material-icons-round text-primary text-lg mb-1">directions_bike</span>
                <span class="text-xs text-slate-500">Distance</span>
                <span class="text-sm font-semibold text-slate-800">24km</span>
              </div>
              <div class="flex flex-col items-center border-l border-primary/10">
                <span class="material-icons-round text-primary text-lg mb-1">schedule</span>
                <span class="text-xs text-slate-500">Time</span>
                <span class="text-sm font-semibold text-slate-800">1h 15m</span>
              </div>
              <div class="flex flex-col items-center border-l border-primary/10">
                <span class="material-icons-round text-primary text-lg mb-1">terrain</span>
                <span class="text-xs text-slate-500">Ascent</span>
                <span class="text-sm font-semibold text-slate-800">120m</span>
              </div>
              <div class="flex flex-col items-center border-l border-primary/10">
                <span class="material-icons-round text-primary text-lg mb-1">verified_user</span>
                <span class="text-xs text-slate-500">Safe</span>
                <span class="text-sm font-semibold text-slate-800">95%</span>
              </div>
            </div>
          </div>

          <!-- Natural Language Prompt -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-slate-600 mb-2">How can I improve this route?</label>
            <div class="relative">
              <textarea id="refinePrompt" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-4 pr-12 text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none" placeholder="Make it flatter with more shade near the river..." rows="3"></textarea>
              <button onclick="refineRouteWithAi()" class="absolute bottom-3 right-3 bg-primary text-white p-2 rounded-lg active:scale-95 transition-all">
                <span class="material-icons-round text-sm">auto_awesome</span>
              </button>
            </div>
          </div>

          <!-- Suggestion Chips -->
          <div class="mb-6">
            <div class="flex overflow-x-auto gap-2 pb-2">
              <button onclick="applyRefineChip(this, 'Make the route safer')" class="flex-shrink-0 px-4 py-2 bg-primary/10 border border-primary/20 text-primary rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-1">
                <span class="material-icons-round text-base">shield</span> Safer
              </button>
              <button onclick="applyRefineChip(this, 'Make the route flatter')" class="flex-shrink-0 px-4 py-2 bg-slate-100 border border-slate-200 text-slate-700 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-1">
                <span class="material-icons-round text-base">trending_down</span> Flatter
              </button>
              <button onclick="applyRefineChip(this, 'Add more shade')" class="flex-shrink-0 px-4 py-2 bg-slate-100 border border-slate-200 text-slate-700 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-1">
                <span class="material-icons-round text-base">forest</span> More shade
              </button>
              <button onclick="applyRefineChip(this, 'Include water bubblers')" class="flex-shrink-0 px-4 py-2 bg-slate-100 border border-slate-200 text-slate-700 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-1">
                <span class="material-icons-round text-base">water_drop</span> Bubblers
              </button>
              <button onclick="applyRefineChip(this, 'Avoid busy roads')" class="flex-shrink-0 px-4 py-2 bg-slate-100 border border-slate-200 text-slate-700 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-1">
                <span class="material-icons-round text-base">block</span> Avoid roads
              </button>
            </div>
          </div>

          <!-- Trade-off Sliders -->
          <div class="mb-8">
            <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wider mb-5">Trade-offs</h3>
            <div class="mb-6">
              <div class="flex justify-between text-xs font-semibold text-slate-500 mb-3">
                <span class="flex items-center gap-1"><span class="material-icons-round text-[14px]">shield</span> SAFETY</span>
                <span class="flex items-center gap-1">DIRECTNESS <span class="material-icons-round text-[14px]">straighten</span></span>
              </div>
              <input class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-primary" max="100" min="0" type="range" value="75"/>
            </div>
            <div class="mb-4">
              <div class="flex justify-between text-xs font-semibold text-slate-500 mb-3">
                <span class="flex items-center gap-1"><span class="material-icons-round text-[14px]">wb_sunny</span> SHADE</span>
                <span class="flex items-center gap-1">SPEED <span class="material-icons-round text-[14px]">bolt</span></span>
              </div>
              <input class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-primary" max="100" min="0" type="range" value="30"/>
            </div>
          </div>

          <div class="text-center px-4 mb-4">
            <p class="text-[10px] leading-relaxed text-slate-400">
              Micro2Move uses your preferences and community data to re-plan this ride. AI routes are generated dynamically and may vary based on real-time traffic.
            </p>
          </div>
        </div>

        <!-- Sticky Actions -->
        <div class="absolute bottom-0 inset-x-0 p-5 bg-white/80 backdrop-blur-md border-t border-slate-100">
          <button onclick="refineRouteWithAi()" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-primary/20 active:scale-[0.98] transition-all mb-2">
            <span class="material-icons-round">auto_awesome</span>
            Update route with AI
          </button>
          <button onclick="showScreen('aiRouteResults')" class="w-full py-2 text-slate-500 text-sm font-medium">
            Reset to original
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN: E-BIKE PRODUCT PAGE
       ============================================ -->
  <div id="ebikeProduct" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="w-full max-w-md overflow-y-auto pb-24">
      <!-- Top Nav -->
      <nav class="sticky top-0 z-50 flex items-center justify-between bg-white/80 backdrop-blur-md px-4 py-3 border-b border-primary/10">
        <div class="flex items-center gap-2">
          <button onclick="showScreen('findEbike')" class="p-1">
            <span class="material-symbols-outlined text-slate-700">arrow_back</span>
          </button>
          <span class="font-bold text-lg tracking-tight">Micro2Move</span>
        </div>
        <div class="flex items-center gap-3">
          <button class="relative p-2">
            <span class="material-symbols-outlined text-slate-700">shopping_bag</span>
          </button>
        </div>
      </nav>

      <!-- Hero Image -->
      <div class="relative w-full aspect-[4/5] bg-slate-200 overflow-hidden">
        <img alt="Hokus City X E-bike" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBxYKzKInffkmTtfi_7lkpXiftr69-1GmIJPF9233SLiwB14RUMap8Ty5_HVN3s7mlDB9vfjRrWqP0z0tzUYu6YvD7V9aWVe9oVSbwxWkvBSVw9-5zyY-X3Q9b6JeKxmmHKNDMqmUsy_jXUws_kCzitYds22mqEy8kxZ_OnJ7f3B44duW3HM76yRG-gSN9KZ1mjOMqTqBLdf8LMmVg-5_15dAaqC2YgZ7Ab2-Tz-HrVqKQ56UMQJu95ZEpZrSgOVCOQI5ECkR5AIWMJ"/>
        <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-1.5">
          <div class="w-8 h-1 rounded-full bg-primary"></div>
          <div class="w-4 h-1 rounded-full bg-white/50"></div>
          <div class="w-4 h-1 rounded-full bg-white/50"></div>
        </div>
      </div>

      <!-- Product Info -->
      <section class="px-5 pt-6 pb-4">
        <div class="flex justify-between items-start mb-2">
          <div>
            <h1 class="text-3xl font-bold tracking-tight">Hokus City X</h1>
            <p class="text-slate-500 font-medium">Urban Performance Series</p>
          </div>
          <div class="bg-primary/10 px-3 py-1 rounded-full">
            <span class="text-primary font-bold text-sm">NEW</span>
          </div>
        </div>
        <p class="text-slate-600 leading-relaxed mt-4">
          Redefining the daily commute. The Hokus City X combines raw power with a lightweight frame, perfect for Sydney's diverse terrain and busy streets.
        </p>
      </section>

      <!-- Specs Grid -->
      <section class="px-5 py-6">
        <div class="grid grid-cols-3 gap-3">
          <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm flex flex-col items-center text-center">
            <span class="material-symbols-outlined text-primary mb-2">bolt</span>
            <span class="text-xs text-slate-400 uppercase font-bold tracking-wider">Motor</span>
            <span class="text-lg font-bold">250W</span>
          </div>
          <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm flex flex-col items-center text-center">
            <span class="material-symbols-outlined text-primary mb-2">distance</span>
            <span class="text-xs text-slate-400 uppercase font-bold tracking-wider">Range</span>
            <span class="text-lg font-bold">80km</span>
          </div>
          <div class="bg-white p-4 rounded-xl border border-primary/5 shadow-sm flex flex-col items-center text-center">
            <span class="material-symbols-outlined text-primary mb-2">weight</span>
            <span class="text-xs text-slate-400 uppercase font-bold tracking-wider">Weight</span>
            <span class="text-lg font-bold">18kg</span>
          </div>
        </div>
      </section>

      <!-- Purchase Card -->
      <section class="px-5 py-4 space-y-4">
        <div class="bg-primary p-6 rounded-2xl text-white shadow-lg shadow-primary/20">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">Own the City</h3>
            <span class="text-2xl font-bold">$2,499</span>
          </div>
          <p class="text-white/80 mb-6 text-sm">Full ownership with 2-year premium warranty and first service included.</p>
          <button onclick="showScreen('ebikeCheckout')" class="w-full bg-white text-primary font-bold py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-50 transition-colors">
            Buy Now
            <span class="material-symbols-outlined text-lg">arrow_forward</span>
          </button>
        </div>

        <!-- Demo Card -->
        <div class="bg-white p-6 rounded-2xl border-2 border-primary shadow-sm">
          <h3 class="text-xl font-bold text-slate-900 mb-2">Book a Free Demo</h3>
          <p class="text-slate-500 mb-6 text-sm">Not sure yet? Take it for a 30-minute spin around Sydney's best bike paths.</p>
          <button onclick="showScreen('ebikeDemoSchedule')" class="w-full bg-transparent border-2 border-primary text-primary font-bold py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-primary/5 transition-colors">
            <span class="material-symbols-outlined text-lg">event_available</span>
            Schedule Test Ride
          </button>
        </div>
      </section>

      <!-- Store Availability -->
      <section class="px-5 py-8">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-bold tracking-tight">Store Availability</h2>
          <div class="flex items-center gap-1 text-primary text-sm font-bold">
            <span class="material-symbols-outlined text-sm">location_on</span>
            Sydney, NSW
          </div>
        </div>
        <div class="space-y-3">
          <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-100">
            <div class="flex items-center gap-3">
              <div class="size-10 bg-slate-100 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-slate-400">store</span>
              </div>
              <div>
                <p class="font-bold text-slate-900">PedL Surry Hills</p>
                <p class="text-xs text-slate-500">2.4km • Open until 6PM</p>
              </div>
            </div>
            <span class="inline-flex items-center gap-1 text-green-500 text-xs font-bold bg-green-50 px-2 py-1 rounded">
              <span class="size-1.5 rounded-full bg-green-500"></span> In Stock
            </span>
          </div>
          <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-100">
            <div class="flex items-center gap-3">
              <div class="size-10 bg-slate-100 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-slate-400">store</span>
              </div>
              <div>
                <p class="font-bold text-slate-900">99 Bikes Alexandria</p>
                <p class="text-xs text-slate-500">4.1km • Open until 7PM</p>
              </div>
            </div>
            <span class="inline-flex items-center gap-1 text-amber-500 text-xs font-bold bg-amber-50 px-2 py-1 rounded">
              <span class="size-1.5 rounded-full bg-amber-500"></span> Low Stock
            </span>
          </div>
          <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-100">
            <div class="flex items-center gap-3">
              <div class="size-10 bg-slate-100 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-slate-400">store</span>
              </div>
              <div>
                <p class="font-bold text-slate-900">Micro2Move Bondi</p>
                <p class="text-xs text-slate-500">7.8km • By Appointment</p>
              </div>
            </div>
            <span class="inline-flex items-center gap-1 text-green-500 text-xs font-bold bg-green-50 px-2 py-1 rounded">
              <span class="size-1.5 rounded-full bg-green-500"></span> In Stock
            </span>
          </div>
        </div>
      </section>

      <!-- Bottom Nav -->
      <div class="fixed bottom-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-md border-t border-slate-200 px-6 pb-6 pt-3 flex items-center justify-between">
        <button onclick="showWelcomeHub()" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-symbols-outlined">home</span>
          <p class="text-[10px] font-bold uppercase tracking-wider">Home</p>
        </button>
        <button onclick="showScreen('findEbike')" class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-symbols-outlined">explore</span>
          <p class="text-[10px] font-bold uppercase tracking-wider">Explore</p>
        </button>
        <div class="relative -top-8 size-14 bg-primary rounded-full flex items-center justify-center text-white shadow-xl shadow-primary/40 border-4 border-white">
          <span class="material-symbols-outlined text-2xl">pedal_bike</span>
        </div>
        <button class="flex flex-col items-center gap-1 text-primary">
          <span class="material-symbols-outlined">shopping_bag</span>
          <p class="text-[10px] font-bold uppercase tracking-wider">Shop</p>
        </button>
        <button class="flex flex-col items-center gap-1 text-slate-400">
          <span class="material-symbols-outlined">person</span>
          <p class="text-[10px] font-bold uppercase tracking-wider">Profile</p>
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN: DEMO RIDE SCHEDULING
       ============================================ -->
  <div id="ebikeDemoSchedule" class="fixed inset-0 z-30 bg-slate-900/60 flex justify-center hidden">
    <div class="w-full max-w-md flex flex-col justify-end h-full">
      <div class="bg-white w-full max-h-[92%] rounded-t-[2.5rem] shadow-2xl flex flex-col">
        <!-- Handle -->
        <div class="flex h-6 w-full items-center justify-center shrink-0">
          <div class="h-1.5 w-12 rounded-full bg-slate-200"></div>
        </div>
        <!-- Header -->
        <div class="px-6 py-2 flex items-center justify-between border-b border-slate-100">
          <button onclick="showScreen('ebikeProduct')" class="w-10 h-10 flex items-center justify-start text-slate-400">
            <span class="material-symbols-outlined">close</span>
          </button>
          <h2 class="text-lg font-bold text-slate-900">Schedule Your Demo</h2>
          <div class="w-10 h-10 flex items-center justify-end text-primary">
            <span class="material-symbols-outlined">help</span>
          </div>
        </div>
        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto px-6 py-4 space-y-8 pb-32">
          <!-- Date Picker -->
          <section>
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-base font-semibold text-slate-900">Select a Date</h3>
              <div class="flex items-center gap-1 text-primary text-sm font-medium" id="demoMonthLabel">
                February 2026
                <span class="material-symbols-outlined text-sm">expand_more</span>
              </div>
            </div>
            <div class="flex gap-3 overflow-x-auto pb-2" id="demoDayPicker" style="-ms-overflow-style:none;scrollbar-width:none;">
              <div onclick="selectDemoDay(this)" class="flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer" data-day="Mon" data-date="24">
                <span class="text-xs text-slate-400 font-medium">Mon</span>
                <span class="text-lg font-bold text-slate-600">24</span>
              </div>
              <div onclick="selectDemoDay(this)" class="flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer" data-day="Tue" data-date="25">
                <span class="text-xs text-slate-400 font-medium">Tue</span>
                <span class="text-lg font-bold text-slate-600">25</span>
              </div>
              <div onclick="selectDemoDay(this)" class="flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-primary shadow-lg shadow-primary/30 ring-2 ring-primary ring-offset-2 cursor-pointer" data-day="Wed" data-date="26">
                <span class="text-xs text-white/80 font-medium">Wed</span>
                <span class="text-lg font-bold text-white">26</span>
              </div>
              <div onclick="selectDemoDay(this)" class="flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer" data-day="Thu" data-date="27">
                <span class="text-xs text-slate-400 font-medium">Thu</span>
                <span class="text-lg font-bold text-slate-600">27</span>
              </div>
              <div onclick="selectDemoDay(this)" class="flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer" data-day="Fri" data-date="28">
                <span class="text-xs text-slate-400 font-medium">Fri</span>
                <span class="text-lg font-bold text-slate-600">28</span>
              </div>
              <div onclick="selectDemoDay(this)" class="flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer" data-day="Sat" data-date="01">
                <span class="text-xs text-slate-400 font-medium">Sat</span>
                <span class="text-lg font-bold text-slate-600">01</span>
              </div>
            </div>
          </section>

          <!-- Time Slots -->
          <section>
            <h3 class="text-base font-semibold text-slate-900 mb-4">Select a Time</h3>
            <div class="space-y-6">
              <div>
                <div class="flex items-center gap-2 mb-3">
                  <span class="material-symbols-outlined text-orange-400 text-lg">light_mode</span>
                  <span class="text-xs font-bold uppercase tracking-wider text-slate-400">Morning</span>
                </div>
                <div class="grid grid-cols-3 gap-3" id="demoTimeMorning">
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600">09:00 AM</button>
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600">10:30 AM</button>
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-primary bg-primary/5 text-sm font-bold text-primary">11:00 AM</button>
                </div>
              </div>
              <div>
                <div class="flex items-center gap-2 mb-3">
                  <span class="material-symbols-outlined text-yellow-500 text-lg">sunny</span>
                  <span class="text-xs font-bold uppercase tracking-wider text-slate-400">Afternoon</span>
                </div>
                <div class="grid grid-cols-3 gap-3">
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600">01:30 PM</button>
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600">03:00 PM</button>
                  <button class="py-3 rounded-xl bg-slate-100 text-sm font-medium text-slate-300 cursor-not-allowed">04:30 PM</button>
                </div>
              </div>
              <div>
                <div class="flex items-center gap-2 mb-3">
                  <span class="material-symbols-outlined text-indigo-400 text-lg">dark_mode</span>
                  <span class="text-xs font-bold uppercase tracking-wider text-slate-400">Evening</span>
                </div>
                <div class="grid grid-cols-3 gap-3">
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600">06:00 PM</button>
                  <button onclick="selectDemoTime(this)" class="py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600">07:30 PM</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Checklist -->
          <section class="bg-primary/5 rounded-2xl p-4 border border-primary/10">
            <h3 class="text-sm font-bold text-slate-900 mb-3 flex items-center gap-2">
              <span class="material-symbols-outlined text-primary text-xl">assignment_turned_in</span>
              What to Bring
            </h3>
            <ul class="space-y-3">
              <li class="flex items-start gap-3">
                <div class="w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center shrink-0 mt-0.5">
                  <span class="material-symbols-outlined text-[14px] text-primary font-bold">check</span>
                </div>
                <div>
                  <p class="text-sm font-medium text-slate-700">Valid Photo ID</p>
                  <p class="text-xs text-slate-500">Required for insurance purposes.</p>
                </div>
              </li>
              <li class="flex items-start gap-3">
                <div class="w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center shrink-0 mt-0.5">
                  <span class="material-symbols-outlined text-[14px] text-primary font-bold">check</span>
                </div>
                <div>
                  <p class="text-sm font-medium text-slate-700">Your Own Helmet (Optional)</p>
                  <p class="text-xs text-slate-500">Don't worry, we provide sanitized ones too!</p>
                </div>
              </li>
            </ul>
          </section>
        </div>

        <!-- Footer Action -->
        <div class="absolute bottom-0 left-0 right-0 p-6 bg-white/90 backdrop-blur-md border-t border-slate-100">
          <button onclick="confirmDemoSchedule()" class="w-full bg-primary hover:bg-primary/90 text-white h-14 rounded-2xl font-bold text-lg shadow-xl shadow-primary/20 flex items-center justify-center gap-2">
            Confirm Demo Ride
            <span class="material-symbols-outlined">arrow_forward</span>
          </button>
          <p class="text-center text-[10px] text-slate-400 mt-3 font-medium uppercase tracking-[0.1em]">
            Free cancellation up to 2 hours before
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================
       SCREEN: E-BIKE CHECKOUT WITH CREDITS
       ============================================ -->
  <div id="ebikeCheckout" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="w-full max-w-md flex flex-col h-full">
      <!-- Header -->
      <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-primary/10">
        <div class="flex items-center justify-between px-4 py-4">
          <button onclick="showScreen('ebikeProduct')" class="flex items-center justify-center size-10 rounded-full hover:bg-primary/10 transition-colors">
            <span class="material-symbols-outlined text-slate-900">arrow_back</span>
          </button>
          <h1 class="text-lg font-bold tracking-tight">Checkout</h1>
          <div class="size-10"></div>
        </div>
        <div class="w-full bg-primary/10 h-1">
          <div class="bg-primary h-full w-3/4"></div>
        </div>
      </header>

      <main class="flex-1 overflow-y-auto pb-32">
        <div class="px-4 py-6 space-y-6">
          <!-- Order Review -->
          <section>
            <h2 class="text-sm font-semibold uppercase tracking-wider text-slate-500 mb-3 ml-1">Order Review</h2>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-primary/5 flex gap-4">
              <div class="w-24 h-24 bg-primary/5 rounded-lg overflow-hidden flex-shrink-0">
                <img alt="E-bike" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDBn22ILVS0Psh3cZb9AQusBYVpehpgquXlfex9iPqjFBqYzDPnw11IJk-Do-DDQ2QPhBE3iz3gSl7uVnYPvtFTsw9orjIIZIVyx4UaPxE3gk-fcqRh_IMDnoPonLnCE1pO7tl275585hzZy06vLjM-vmfZdS64bF6A6Bkv61S51N8in7xqlxNUddQMYlir-Cc5KY5s8si8Uf6UE_rmliXsUeEx876Gi6DWt1Fa6rVtX5G0fx-Z952zJBCy_OcQbc5WcP3KH8tTbyGj"/>
              </div>
              <div class="flex flex-col justify-center">
                <h3 class="font-bold text-base leading-tight">Hokus City X</h3>
                <p class="text-sm text-slate-500 mt-1">Matte Black | 250W Motor</p>
                <p class="text-primary font-bold mt-2">$2,499.00</p>
              </div>
            </div>
          </section>

          <!-- Credit Redemption -->
          <section>
            <div class="bg-primary/5 border-2 border-primary/20 rounded-xl p-5 relative overflow-hidden">
              <div class="absolute -right-4 -top-4 size-24 bg-primary/10 rounded-full blur-2xl"></div>
              <div class="flex items-start justify-between gap-4">
                <div class="flex flex-col gap-1 z-10">
                  <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary" style="font-variation-settings:'FILL' 1">stars</span>
                    <h3 class="text-base font-bold text-slate-900">Education Credits</h3>
                  </div>
                  <p class="text-slate-600 text-sm mt-2 leading-relaxed">
                    You have <span class="font-bold text-primary" id="checkoutCredits">200 credits</span> available.
                    Apply for a <span class="font-bold text-primary">$20.00 discount</span>?
                  </p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked id="applyCreditsToggle" onchange="toggleCreditDiscount()" class="sr-only peer">
                  <div class="w-11 h-6 bg-slate-200 peer-checked:bg-primary rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                </label>
              </div>
            </div>
          </section>

          <!-- Price Breakdown -->
          <section class="bg-white rounded-xl p-5 shadow-sm border border-primary/5">
            <h2 class="text-sm font-semibold uppercase tracking-wider text-slate-500 mb-4">Price Breakdown</h2>
            <div class="space-y-3">
              <div class="flex justify-between text-sm">
                <span class="text-slate-600">Subtotal</span>
                <span class="font-medium">$2,499.00</span>
              </div>
              <div class="flex justify-between text-sm" id="creditDiscountRow">
                <div class="flex items-center gap-1 text-emerald-600">
                  <span class="material-symbols-outlined text-xs">loyalty</span>
                  <span>Education Credit Discount</span>
                </div>
                <span class="font-medium text-emerald-600">-$150.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600">Shipping</span>
                <span class="font-medium text-emerald-600">FREE</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600">Estimated Tax</span>
                <span class="font-medium" id="checkoutTax">$187.92</span>
              </div>
              <div class="pt-4 border-t border-slate-100 flex justify-between items-end">
                <span class="text-base font-bold">Total</span>
                <div class="text-right">
                  <p class="text-2xl font-bold text-primary tracking-tight" id="checkoutTotal">$2,536.92</p>
                  <p class="text-[10px] text-slate-400 uppercase" id="checkoutSavings">Includes $150 credit savings</p>
                </div>
              </div>
            </div>
          </section>

          <!-- Trust Badges -->
          <div class="flex flex-wrap justify-center gap-6 py-4 opacity-60">
            <div class="flex flex-col items-center gap-1">
              <span class="material-symbols-outlined text-2xl">verified_user</span>
              <span class="text-[10px] font-medium uppercase tracking-tighter">Secure SSL</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <span class="material-symbols-outlined text-2xl">local_shipping</span>
              <span class="text-[10px] font-medium uppercase tracking-tighter">Fast Delivery</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <span class="material-symbols-outlined text-2xl">lock</span>
              <span class="text-[10px] font-medium uppercase tracking-tighter">PCI Compliant</span>
            </div>
          </div>
        </div>
      </main>

      <!-- Bottom Action -->
      <footer class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-slate-100 px-4 pt-4 pb-8 z-50">
        <div class="space-y-4">
          <button onclick="completePurchase()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/25 flex items-center justify-center gap-2 transition-transform active:scale-[0.98]">
            <span class="material-symbols-outlined">shopping_cart_checkout</span>
            Complete Purchase
          </button>
          <div class="flex justify-center gap-4 text-slate-400">
            <span class="material-symbols-outlined text-2xl">credit_card</span>
            <span class="material-symbols-outlined text-2xl">account_balance_wallet</span>
            <span class="material-symbols-outlined text-2xl">phone_iphone</span>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- ============================================
       SCREEN: PURCHASE SUCCESS
       ============================================ -->
  <div id="purchaseSuccess" class="fixed inset-0 z-30 bg-background-light flex justify-center hidden">
    <div class="w-full max-w-md flex flex-col h-full overflow-y-auto">
      <!-- Header -->
      <div class="flex items-center px-4 pt-6 pb-2 justify-between">
        <button onclick="showWelcomeHub()" class="text-slate-900 flex size-10 shrink-0 items-center justify-center rounded-full bg-white shadow-sm">
          <span class="material-symbols-outlined">close</span>
        </button>
        <h2 class="text-slate-900 text-lg font-bold leading-tight tracking-tight flex-1 text-center pr-10">Order Confirmed</h2>
      </div>

      <!-- Success Hero -->
      <div class="flex flex-col items-center px-6 pt-10 pb-6 text-center">
        <div class="mb-6 flex h-24 w-24 items-center justify-center rounded-full bg-primary/10 text-primary">
          <span class="material-symbols-outlined text-6xl">check_circle</span>
        </div>
        <h1 class="text-slate-900 tracking-tight text-3xl font-bold leading-tight">Congratulations!</h1>
        <p class="text-slate-500 mt-2 text-base">Your Micro2Move e-bike is ready for its first journey.</p>
      </div>

      <!-- Achievement Badge -->
      <div class="mx-4 mb-6 overflow-hidden rounded-xl bg-gradient-to-br from-primary via-primary/90 to-indigo-600 p-[1px]">
        <div class="flex items-center gap-4 bg-white p-4 rounded-[11px]">
          <div class="flex size-16 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary">
            <span class="material-symbols-outlined text-4xl" style="font-variation-settings:'FILL' 1">verified_user</span>
          </div>
          <div class="flex flex-col">
            <span class="text-xs font-bold uppercase tracking-widest text-primary">Achievement Unlocked</span>
            <h3 class="text-lg font-bold text-slate-900 leading-tight">Certified Rider Badge</h3>
            <p class="text-xs text-slate-500">Education path 100% complete</p>
          </div>
          <div class="ml-auto">
            <span class="material-symbols-outlined text-primary">share</span>
          </div>
        </div>
      </div>

      <!-- Order Details -->
      <div class="mx-4 flex flex-col gap-4 rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
        <div class="flex justify-between items-start border-b border-slate-100 pb-3">
          <div>
            <p class="text-xs font-medium text-slate-400 uppercase tracking-wider">Order Number</p>
            <p class="text-lg font-bold text-slate-900" id="orderNumber">#M2M-882942</p>
          </div>
          <div class="rounded-lg bg-slate-100 px-3 py-1 text-sm font-semibold text-slate-600">Paid</div>
        </div>
        <div class="flex flex-col gap-3">
          <div class="flex gap-3">
            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary">
              <span class="material-symbols-outlined">store</span>
            </div>
            <div>
              <p class="text-sm font-bold text-slate-900">Pickup Location</p>
              <p class="text-xs text-slate-500">PedL Surry Hills</p>
              <p class="text-xs text-slate-500">123 Crown St, Surry Hills NSW</p>
            </div>
          </div>
          <div class="flex gap-3">
            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary">
              <span class="material-symbols-outlined">schedule</span>
            </div>
            <div>
              <p class="text-sm font-bold text-slate-900">Pickup Window</p>
              <p class="text-xs text-slate-500">Today, 2:00 PM - 6:00 PM</p>
              <p class="text-[10px] text-primary font-medium mt-0.5">Bring your digital QR code for verification</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-auto p-4 flex flex-col gap-3 pb-8">
        <button onclick="showWelcomeHub()" class="flex w-full items-center justify-center gap-2 rounded-xl bg-primary px-4 py-4 text-base font-bold text-white shadow-lg active:scale-95 transition-transform">
          Go to Dashboard
        </button>
        <button onclick="showScreen('aiRoutePlanner')" class="flex w-full items-center justify-center gap-2 rounded-xl border-2 border-primary/20 bg-transparent px-4 py-4 text-base font-bold text-primary active:bg-primary/5 transition-colors">
          <span class="material-symbols-outlined">map</span>
          View My Routes
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================
       JAVASCRIPT
       ============================================ -->
  <script src="js/config.js"></script>
  <script>
    // Track if TNC has been completed
    var tncCompleted = false;
    var profileCompleted = localStorage.getItem('profileCompleted') === 'true';

    // Hide all screens
    function hideAllScreens() {
      document.getElementById('splashScreen').classList.add('hidden');
      document.getElementById('signInScreen').classList.add('hidden');
      document.getElementById('signUpScreen').classList.add('hidden');
      document.getElementById('welcomeHub').classList.add('hidden');
      document.getElementById('cyclingCommunities').classList.add('hidden');
      document.getElementById('findEbike').classList.add('hidden');
      document.getElementById('bookDemo').classList.add('hidden');
      document.getElementById('demoSelection').classList.add('hidden');
      document.getElementById('scheduleDemo').classList.add('hidden');
      document.getElementById('demoAgreement').classList.add('hidden');
      document.getElementById('paidCheckout').classList.add('hidden');
      document.getElementById('educationHub').classList.add('hidden');
      document.getElementById('rewardsCredits').classList.add('hidden');
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('rideSupportTraining').classList.add('hidden');
      document.getElementById('community').classList.add('hidden');
      document.getElementById('communityHub').classList.add('hidden');
      document.getElementById('aiRoutePlanner').classList.add('hidden');
      document.getElementById('aiRouteResults').classList.add('hidden');
      document.getElementById('communityReports').classList.add('hidden');
      document.getElementById('aiRouteRefine').classList.add('hidden');
      document.getElementById('ebikeProduct').classList.add('hidden');
      document.getElementById('ebikeDemoSchedule').classList.add('hidden');
      document.getElementById('ebikeCheckout').classList.add('hidden');
      document.getElementById('purchaseSuccess').classList.add('hidden');
      // ID verification
      document.getElementById('idVerifyScreen').classList.add('hidden');
      // Education & quiz screens
      document.getElementById('safetyTrainingScreen').classList.add('hidden');
      document.getElementById('quizDetailScreen').classList.add('hidden');
      document.getElementById('videoLessonScreen').classList.add('hidden');
      document.getElementById('communityEventsScreen').classList.add('hidden');
    }

    // Screen navigation
    function showSignIn() {
      hideAllScreens();
      document.getElementById('signInScreen').classList.remove('hidden');
    }

    function showSignUp() {
      hideAllScreens();
      document.getElementById('signUpScreen').classList.remove('hidden');
    }

    function showWelcomeHub() {
      hideAllScreens();
      document.getElementById('welcomeHub').classList.remove('hidden');

      // Show TNC modal if not completed yet
      if (!tncCompleted) {
        showTncModal();
      }
    }

    function showScreen(screenId) {
      hideAllScreens();
      document.getElementById(screenId).classList.remove('hidden');
    }

    // ============================================
    // TNC MODAL FUNCTIONS
    // ============================================
    function showTncModal() {
      document.getElementById('tncModal').classList.remove('hidden');
      showTncStep(1);
    }

    function closeTncModal() {
      document.getElementById('tncModal').classList.add('hidden');
    }

    function showTncStep(step) {
      // Hide all steps
      document.getElementById('tncStep1').classList.add('hidden');
      document.getElementById('tncStep2').classList.add('hidden');
      document.getElementById('tncStep3').classList.add('hidden');
      document.getElementById('tncStep4').classList.add('hidden');

      // Show requested step
      document.getElementById('tncStep' + step).classList.remove('hidden');
    }

    function completeTnc() {
      tncCompleted = true;
      closeTncModal();
    }

    // ============================================
    // PROFILE PERSONALIZATION STEPS
    // ============================================
    function showProfileStep(step) {
      document.getElementById('profileStep1').classList.add('hidden');
      document.getElementById('profileStep2').classList.add('hidden');
      document.getElementById('profileStep3').classList.add('hidden');
      document.getElementById('profileStep4').classList.add('hidden');
      document.getElementById('profileStep' + step).classList.remove('hidden');
    }

    // Toggle interest card selection (Step 3)
    function toggleInterest(element) {
      element.classList.toggle('selected');
      element.classList.toggle('bg-primary/5');
      element.classList.toggle('border-primary');
      element.classList.toggle('bg-white');
      element.classList.toggle('border-gray-200');

      var checkMark = element.querySelector('.check-mark');
      if (checkMark) {
        checkMark.classList.toggle('hidden');
      }

      // Toggle icon colors
      var icon = element.querySelector('.material-symbols-outlined');
      if (icon) {
        icon.classList.toggle('text-primary');
        icon.classList.toggle('text-gray-400');
      }

      // Toggle text color
      var label = element.querySelector('p');
      if (label) {
        label.classList.toggle('text-primary');
        label.classList.toggle('text-gray-700');
      }
    }

    // Select riding frequency (Step 4)
    function selectFrequency(element, value) {
      // Reset all frequency buttons
      var buttons = document.querySelectorAll('.freq-btn');
      buttons.forEach(function(btn) {
        btn.classList.remove('border-primary', 'bg-primary', 'text-white', 'shadow-lg', 'shadow-primary/20');
        btn.classList.add('border-gray-200', 'bg-white', 'text-gray-700');
      });

      // Activate selected button
      element.classList.remove('border-gray-200', 'bg-white', 'text-gray-700');
      element.classList.add('border-primary', 'bg-primary', 'text-white', 'shadow-lg', 'shadow-primary/20');
    }

    // Toggle area tag selection (Step 4)
    function toggleAreaTag(element) {
      element.classList.toggle('selected');

      if (element.classList.contains('selected')) {
        element.classList.remove('bg-gray-100', 'text-gray-700');
        element.classList.add('bg-primary', 'text-white');
      } else {
        element.classList.remove('bg-primary', 'text-white');
        element.classList.add('bg-gray-100', 'text-gray-700');
      }
    }

    // Confirm demo booking and return to welcome
    function confirmDemoBooking() {
      showWelcomeHub();
      showToast('Demo booked successfully!');
    }

    // Complete profile and go to Community Hub
    function completeProfile() {
      localStorage.setItem('profileCompleted', 'true');
      profileCompleted = true;
      showCommunityHub();
    }

    // Show Community Hub (Waze-like features)
    function showCommunityHub() {
      hideAllScreens();
      document.getElementById('communityHub').classList.remove('hidden');
    }

    // Handle Community button click - check if profile is completed
    function handleCommunityClick() {
      if (profileCompleted || localStorage.getItem('profileCompleted') === 'true') {
        showCommunityHub();
      } else {
        showScreen('community'); // Show profile personalization
      }
    }

    // ============================================
    // COMMUNITY HUB TAB FUNCTIONS
    // ============================================
    function showHubTab(tab) {
      // Hide all tab content
      document.querySelectorAll('.hub-content').forEach(function(el) {
        el.classList.add('hidden');
      });

      // Reset all tab buttons
      document.querySelectorAll('.hub-tab').forEach(function(btn) {
        btn.classList.remove('bg-primary', 'text-white');
        btn.classList.add('bg-gray-100', 'text-gray-600');
      });

      // Show selected tab content
      document.getElementById('hub' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('hidden');

      // Activate selected tab button
      event.target.classList.remove('bg-gray-100', 'text-gray-600');
      event.target.classList.add('bg-primary', 'text-white');
    }

    // Vote on items (upvote/downvote)
    function voteItem(button, direction) {
      var countSpan = button.querySelector('span:last-child');
      if (countSpan && !isNaN(parseInt(countSpan.textContent))) {
        var count = parseInt(countSpan.textContent);
        if (direction === 'up') {
          countSpan.textContent = count + 1;
          button.classList.add('text-green-500');
          button.classList.remove('text-gray-500');
        } else {
          countSpan.textContent = count + 1;
          button.classList.add('text-red-500');
          button.classList.remove('text-gray-500');
        }
      }
      showToast(direction === 'up' ? 'Upvoted! 👍' : 'Reported 👎');
    }

    // Report Modal functions
    var selectedReportType = null;

    function openReportModal() {
      document.getElementById('reportModal').classList.remove('hidden');
    }

    function closeReportModal() {
      document.getElementById('reportModal').classList.add('hidden');
      selectedReportType = null;
      // Reset selections
      document.querySelectorAll('.report-type-btn').forEach(function(btn) {
        btn.classList.remove('border-primary', 'bg-primary/10');
        btn.classList.add('border-transparent');
      });
      document.getElementById('reportDescription').value = '';
    }

    function selectReportType(button, type) {
      selectedReportType = type;
      // Reset all buttons
      document.querySelectorAll('.report-type-btn').forEach(function(btn) {
        btn.classList.remove('border-primary', 'bg-primary/10');
        btn.classList.add('border-transparent');
      });
      // Highlight selected
      button.classList.remove('border-transparent');
      button.classList.add('border-primary', 'bg-primary/10');
    }

    function submitReport() {
      if (!selectedReportType) {
        showToast('Please select a report type');
        return;
      }
      showToast('Report submitted! Thanks for helping the community 🙏');
      closeReportModal();
    }

    function showAddPostModal() {
      showToast('Create post coming soon!');
    }

    // Toast notification
    function showToast(message) {
      var toast = document.createElement('div');
      toast.className = 'fixed bottom-32 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-xl z-[100] text-sm font-medium animate-pulse';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(function() {
        toast.remove();
      }, 2000);
    }

    // Toggle between List and Map views in Cycling Communities
    function showCommunityView(view) {
      var listView = document.getElementById('communityListView');
      var mapView = document.getElementById('communityMapView');
      var listBtn = document.getElementById('listTabBtn');
      var mapBtn = document.getElementById('mapTabBtn');

      if (view === 'map') {
        // Show Map, hide List
        listView.classList.add('hidden');
        mapView.classList.remove('hidden');

        // Update tab styling
        listBtn.classList.remove('bg-white', 'text-primary', 'shadow-sm');
        listBtn.classList.add('text-[#706189]');
        listBtn.querySelector('.material-symbols-outlined').classList.add('text-gray-400');

        mapBtn.classList.add('bg-white', 'text-primary', 'shadow-sm');
        mapBtn.classList.remove('text-[#706189]');
        mapBtn.querySelector('.material-symbols-outlined').classList.remove('text-gray-400');
      } else {
        // Show List, hide Map
        mapView.classList.add('hidden');
        listView.classList.remove('hidden');

        // Update tab styling
        mapBtn.classList.remove('bg-white', 'text-primary', 'shadow-sm');
        mapBtn.classList.add('text-[#706189]');
        mapBtn.querySelector('.material-symbols-outlined').classList.add('text-gray-400');

        listBtn.classList.add('bg-white', 'text-primary', 'shadow-sm');
        listBtn.classList.remove('text-[#706189]');
        listBtn.querySelector('.material-symbols-outlined').classList.remove('text-gray-400');
      }
    }

    // ============================================
    // AUTH HANDLERS
    // ============================================
    function handleSignIn(e) {
      e.preventDefault();
      var email = document.getElementById('signInEmail').value;
      var password = document.getElementById('signInPassword').value;

      // Clear previous errors
      document.getElementById('emailError').classList.add('hidden');
      document.getElementById('passwordError').classList.add('hidden');

      if (!email) {
        document.getElementById('emailError').classList.remove('hidden');
        return;
      }

      if (!password || password.length < 6) {
        document.getElementById('passwordError').classList.remove('hidden');
        return;
      }

      // Success - go to Welcome Hub (TNC will show automatically)
      showWelcomeHub();
    }

    function handleSignUp(e) {
      e.preventDefault();
      // Success - go to Welcome Hub (TNC will show automatically)
      showWelcomeHub();
    }

    function resetOnboarding() {
      // Reset TNC state
      tncCompleted = false;

      hideAllScreens();
      closeTncModal();
      document.getElementById('splashScreen').classList.remove('hidden');

      // Restart auto-advance timer
      setTimeout(function() {
        if (!document.getElementById('splashScreen').classList.contains('hidden')) {
          showSignIn();
        }
      }, 3000);
    }

    // Auto-advance splash after 3 seconds
    setTimeout(function() {
      if (!document.getElementById('splashScreen').classList.contains('hidden')) {
        showSignIn();
      }
    }, 3000);

    // ============================================
    // RIDE TYPE SELECTION
    // ============================================
    function selectRideType(btn) {
      var buttons = btn.parentElement.querySelectorAll('button');
      buttons.forEach(function(b) {
        b.classList.remove('bg-primary', 'text-white', 'shadow-md', 'shadow-primary/20');
        b.classList.add('bg-background-light', 'text-slate-600');
      });
      btn.classList.remove('bg-background-light', 'text-slate-600');
      btn.classList.add('bg-primary', 'text-white', 'shadow-md', 'shadow-primary/20');
    }

    // ============================================
    // GOOGLE MAPS INITIALIZATION
    // ============================================
    var aiPlannerMapInstance = null;
    var aiResultsMapInstance = null;
    var reportsMapInstance = null;

    function loadGoogleMaps() {
      if (window.google && window.google.maps) return;
      var key = window.GOOGLE_MAPS_API_KEY || '';
      if (!key || key === 'YOUR_API_KEY') return;
      var script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=' + key + '&libraries=places,geometry&callback=onGoogleMapsLoaded';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    }

    function onGoogleMapsLoaded() {
      console.log('Google Maps loaded');
    }

    function initMapForScreen(screenId) {
      if (!window.google || !window.google.maps) return;

      var sydneyCenter = { lat: -33.8688, lng: 151.2093 };
      var mapStyle = [
        { featureType: 'poi', stylers: [{ visibility: 'off' }] },
        { featureType: 'transit', stylers: [{ visibility: 'simplified' }] }
      ];

      if (screenId === 'aiRoutePlanner' && !aiPlannerMapInstance) {
        var el = document.getElementById('aiPlannerMap');
        if (el) {
          aiPlannerMapInstance = new google.maps.Map(el, {
            center: sydneyCenter, zoom: 14, styles: mapStyle,
            disableDefaultUI: true, zoomControl: false
          });
        }
      }

      if (screenId === 'aiRouteResults' && !aiResultsMapInstance) {
        var el = document.getElementById('aiResultsMap');
        if (el) {
          aiResultsMapInstance = new google.maps.Map(el, {
            center: sydneyCenter, zoom: 14, styles: mapStyle,
            disableDefaultUI: true, zoomControl: false
          });
        }
      }

      if (screenId === 'communityReports' && !reportsMapInstance) {
        var el = document.getElementById('reportsMap');
        if (el) {
          reportsMapInstance = new google.maps.Map(el, {
            center: sydneyCenter, zoom: 13, styles: mapStyle,
            disableDefaultUI: true, zoomControl: false
          });
          // Add report markers
          new google.maps.Marker({ position: { lat: -33.8720, lng: 151.1950 }, map: reportsMapInstance, icon: { path: google.maps.SymbolPath.CIRCLE, fillColor: '#ef4444', fillOpacity: 1, strokeColor: '#fff', strokeWeight: 2, scale: 10 } });
          new google.maps.Marker({ position: { lat: -33.8650, lng: 151.2050 }, map: reportsMapInstance, icon: { path: google.maps.SymbolPath.CIRCLE, fillColor: '#f59e0b', fillOpacity: 1, strokeColor: '#fff', strokeWeight: 2, scale: 10 } });
          new google.maps.Marker({ position: { lat: -33.8700, lng: 151.2100 }, map: reportsMapInstance, icon: { path: google.maps.SymbolPath.CIRCLE, fillColor: '#3b82f6', fillOpacity: 1, strokeColor: '#fff', strokeWeight: 2, scale: 8 } });
        }
      }
    }

    function centerAiMap() {
      if (aiPlannerMapInstance) {
        aiPlannerMapInstance.setCenter({ lat: -33.8688, lng: 151.2093 });
      }
    }

    // Override showScreen to init maps when navigating
    var _originalShowScreen = showScreen;
    showScreen = function(screenId) {
      _originalShowScreen(screenId);
      setTimeout(function() { initMapForScreen(screenId); }, 100);
    };

    // ============================================
    // AI ROUTE GENERATION (Vertex AI via Backend → Gemini fallback)
    // ============================================
    var BACKEND_URL = 'http://' + window.location.hostname + ':8001';
    var lastRouteResult = {};

    function generateAiRoute() {
      var prompt = document.getElementById('aiRoutePrompt').value;
      var scenery = document.getElementById('aiScenery').value;
      var utilities = document.getElementById('aiUtilities').value;
      var startLoc = document.getElementById('aiStartLocation').value;
      var distance = parseInt(document.getElementById('distanceSlider').value);

      showScreen('aiRouteResults');
      document.getElementById('aiInsightText').innerHTML = '<span class="animate-pulse">Generating AI route via Vertex AI...</span>';

      var payload = {
        start_location: startLoc,
        description: prompt,
        scenery: scenery,
        utilities: utilities,
        distance_km: distance,
        ride_type: 'commute',
        safety_priority: 90,
        shade_priority: 50,
        hills_avoid: 20
      };

      // Try backend (Vertex AI) first, fall back to direct Gemini API
      fetch(BACKEND_URL + '/api/v1/routes/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(function(res) {
        if (!res.ok) throw new Error('Backend unavailable');
        return res.json();
      })
      .then(function(data) {
        lastRouteResult = data;
        applyRouteResults(data);
      })
      .catch(function() {
        // Fallback to direct Gemini API
        generateViaGeminiFallback(payload);
      });
    }

    function generateViaGeminiFallback(payload) {
      var geminiKey = window.GEMINI_API_KEY || '';
      if (!geminiKey || geminiKey.indexOf('YOUR') !== -1) {
        document.getElementById('aiInsightText').innerHTML = 'This route prioritizes the <span class="text-green-600 font-semibold">Harbour Bridge Cycleway</span>. We\'ve bypassed the steep Kent St incline in favor of Sussex St\'s protected lanes, adding only 2 mins while increasing shade by 40%.';
        return;
      }

      var aiPrompt = 'You are a Sydney cycling route AI. Generate a brief 2-sentence route insight for a cyclist. ' +
        'Start: ' + payload.start_location + '. Distance: ' + payload.distance_km + 'km. ' +
        (payload.scenery ? 'Scenery preference: ' + payload.scenery + '. ' : '') +
        (payload.utilities ? 'Wants: ' + payload.utilities + '. ' : '') +
        (payload.description ? 'User description: ' + payload.description + '. ' : '') +
        'Mention specific Sydney street names and cycleways. Be concise and helpful.';

      fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + geminiKey, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ contents: [{ parts: [{ text: aiPrompt }] }] })
      })
      .then(function(res) { return res.json(); })
      .then(function(data) {
        var text = data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0] && data.candidates[0].content.parts[0].text;
        if (text) { document.getElementById('aiInsightText').innerHTML = text; }
      })
      .catch(function() {
        document.getElementById('aiInsightText').innerHTML = 'This route prioritizes the <span class="text-green-600 font-semibold">Harbour Bridge Cycleway</span>. We\'ve bypassed the steep Kent St incline in favor of Sussex St\'s protected lanes.';
      });
    }

    function applyRouteResults(data) {
      if (data.insight) document.getElementById('aiInsightText').innerHTML = data.insight;
      if (data.distance_km) document.getElementById('routeDist').innerHTML = data.distance_km + '<span class="text-xs font-normal">km</span>';
      if (data.estimated_minutes) document.getElementById('routeTime').innerHTML = data.estimated_minutes + '<span class="text-xs font-normal">m</span>';
      if (data.elevation_gain_m) document.getElementById('routeAscent').innerHTML = data.elevation_gain_m + '<span class="text-xs font-normal">m</span>';
      if (data.safety_score) document.getElementById('routeSafety').innerHTML = data.safety_score + '%';
      if (data.route_name) document.getElementById('routeSubtitle').textContent = data.route_name;
    }

    // ============================================
    // AI ROUTE REFINEMENT
    // ============================================
    function applyRefineChip(btn, text) {
      document.getElementById('refinePrompt').value = text;
      // Highlight selected chip
      var chips = btn.parentElement.querySelectorAll('button');
      chips.forEach(function(c) {
        c.classList.remove('bg-primary/10', 'border-primary/20', 'text-primary');
        c.classList.add('bg-slate-100', 'border-slate-200', 'text-slate-700');
      });
      btn.classList.remove('bg-slate-100', 'border-slate-200', 'text-slate-700');
      btn.classList.add('bg-primary/10', 'border-primary/20', 'text-primary');
    }

    function refineRouteWithAi() {
      var prompt = document.getElementById('refinePrompt').value;
      if (!prompt) { prompt = 'Make this route safer and more shaded'; }

      showScreen('aiRouteResults');
      document.getElementById('aiInsightText').innerHTML = '<span class="animate-pulse">Refining route via Vertex AI...</span>';

      var payload = {
        current_route: lastRouteResult,
        refinement_prompt: prompt,
        safety_vs_direct: 75,
        shade_vs_speed: 30
      };

      // Try backend (Vertex AI) first, fall back to Gemini
      fetch(BACKEND_URL + '/api/v1/routes/refine', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(function(res) {
        if (!res.ok) throw new Error('Backend unavailable');
        return res.json();
      })
      .then(function(data) {
        lastRouteResult = data;
        applyRouteResults(data);
      })
      .catch(function() {
        // Fallback to direct Gemini
        var geminiKey = window.GEMINI_API_KEY || '';
        if (!geminiKey || geminiKey.indexOf('YOUR') !== -1) {
          document.getElementById('aiInsightText').innerHTML = 'Route refined! We\'ve rerouted via the <span class="text-green-600 font-semibold">Glebe Foreshore path</span> for better shade and safety. Score improved to 96%.';
          return;
        }
        var aiPrompt = 'You are a Sydney cycling route AI. The user wants to refine their route: "' + prompt + '". Give a 2-sentence response with specific Sydney streets. Be concise.';
        fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + geminiKey, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text: aiPrompt }] }] })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
          var text = data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0] && data.candidates[0].content.parts[0].text;
          if (text) { document.getElementById('aiInsightText').innerHTML = text; }
        })
        .catch(function() {
          document.getElementById('aiInsightText').innerHTML = 'Route refined! Rerouted via <span class="text-green-600 font-semibold">Glebe Foreshore</span> for better shade. Safety improved to 96%.';
        });
      });
    }

    // ============================================
    // E-BIKE PURCHASE FLOW FUNCTIONS
    // ============================================

    // Demo day selector
    function selectDemoDay(el) {
      var picker = document.getElementById('demoDayPicker');
      var days = picker.querySelectorAll('[onclick]');
      days.forEach(function(d) {
        d.className = 'flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer';
        d.querySelector('span:first-child').className = 'text-xs text-slate-400 font-medium';
        d.querySelector('span:last-child').className = 'text-lg font-bold text-slate-600';
      });
      el.className = 'flex flex-col items-center justify-center min-w-[56px] h-20 rounded-2xl bg-primary shadow-lg shadow-primary/30 ring-2 ring-primary ring-offset-2 cursor-pointer';
      el.querySelector('span:first-child').className = 'text-xs text-white/80 font-medium';
      el.querySelector('span:last-child').className = 'text-lg font-bold text-white';
    }

    // Demo time selector
    function selectDemoTime(el) {
      var allBtns = el.closest('section').querySelectorAll('button[onclick]');
      allBtns.forEach(function(b) {
        b.className = 'py-3 rounded-xl border border-slate-200 text-sm font-medium text-slate-600';
      });
      el.className = 'py-3 rounded-xl border border-primary bg-primary/5 text-sm font-bold text-primary';
    }

    // Confirm demo schedule
    function confirmDemoSchedule() {
      showToast('Demo ride scheduled! Check your email for confirmation.');
      showWelcomeHub();
    }

    // Toggle credit discount on checkout
    function toggleCreditDiscount() {
      var toggle = document.getElementById('applyCreditsToggle');
      var discountRow = document.getElementById('creditDiscountRow');
      var totalEl = document.getElementById('checkoutTotal');
      var savingsEl = document.getElementById('checkoutSavings');
      var taxEl = document.getElementById('checkoutTax');

      if (toggle.checked) {
        discountRow.style.display = 'flex';
        totalEl.textContent = '$2,536.92';
        taxEl.textContent = '$187.92';
        savingsEl.textContent = 'Includes $150 credit savings';
      } else {
        discountRow.style.display = 'none';
        totalEl.textContent = '$2,686.92';
        taxEl.textContent = '$187.92';
        savingsEl.textContent = '';
      }
    }

    // Complete purchase
    function completePurchase() {
      var orderNum = '#M2M-' + Math.floor(100000 + Math.random() * 900000);
      document.getElementById('orderNumber').textContent = orderNum;
      showScreen('purchaseSuccess');
    }

    // Load Google Maps on startup
    loadGoogleMaps();
  </script>

</body>
</html>
